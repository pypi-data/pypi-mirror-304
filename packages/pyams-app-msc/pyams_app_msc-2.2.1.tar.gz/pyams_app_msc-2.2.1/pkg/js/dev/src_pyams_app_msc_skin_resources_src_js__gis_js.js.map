{"version":3,"file":"src_pyams_app_msc_skin_resources_src_js__gis_js.js","mappings":"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","sources":["webpack://pyams_app_msc/./src/pyams_app_msc/skin/resources/src/js/_gis.js"],"sourcesContent":["import MyAMS from \"./_utils\";\n\n\nconst createMap = (map, config, options, callback) => {\n\n\treturn new Promise((resolve, reject) => {\n\n\t\tconst data = map.data();\n\t\tlet settings = {\n\t\t\tpreferCanvas: data.mapLeafletPreferCanvas || false,\n\t\t\tattributionControl: data.mapLeafletAttributionControl === undefined ?\n\t\t\t\tconfig.attributionControl : data.mapLeafletAttributionControl,\n\t\t\tzoomControl: data.mapLeafletZoomControl === undefined ?\n\t\t\t\tconfig.zoomControl : data.mapLeafletZoomControl,\n\t\t\tcrs: data.mapLeafletCrs || MyAMS.getObject(config.crs) || L.CRS.EPSG3857,\n\t\t\tcenter: data.mapLeafletCenter || config.center,\n\t\t\tzoom: data.mapLeafletZoom || config.zoom,\n\t\t\tgestureHandling: data.mapLeafletWheelZoom === undefined ?\n\t\t\t\t!config.scrollWheelZoom : data.mapLeafletWheelZoom,\n\t\t\tkeyboard: data.mapLeafletKeyboard === undefined ?\n\t\t\t\tconfig.keyboard && !L.Browser.mobile : data.amsLeafletKeyboard\n\t\t};\n\t\tsettings = $.extend({}, settings, options);\n\t\tmap.trigger('map.init', [map, settings, config]);\n\t\tconst\n\t\t\tleafmap = L.map(map.attr('id'), settings),\n\t\t\tlayersConfig = [];\n\t\tif (config.layers) {\n\t\t\tfor (const layerConfig of config.layers) {\n\t\t\t\tmap.trigger('map.layer.init', [map, layerConfig]);\n\t\t\t\tlayersConfig.push(PyAMS_GIS.getLayer(map, leafmap, layerConfig));\n\t\t\t}\n\t\t} else {\n\t\t\tlayersConfig.push(L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n\t\t\t\tname: 'osm',\n\t\t\t\ttitle: 'OpenStreetMap',\n\t\t\t\tmaxZoom: 19,\n\t\t\t\tattribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n\t\t\t}));\n\t\t}\n\t\t$.when.apply($, layersConfig).then((...layers) => {\n\t\t\tfor (const idx in layers) {\n\t\t\t\tlayers[idx].addTo(leafmap);\n\t\t\t}\n\t\t\tif (config.zoomControl && (data.mapLeafletHideZoomControl !== true)) {\n\t\t\t\tL.control.scale().addTo(leafmap);\n\t\t\t}\n\t\t\tif (config.center) {\n\t\t\t\tleafmap.setView(new L.LatLng(config.center.lat, config.center.lon),\n\t\t\t\t\tconfig.zoom || 13);\n\t\t\t} else if (config.bounds) {\n\t\t\t\tleafmap.fitBounds(config.bounds);\n\t\t\t}\n\t\t\tif (config.marker) {\n\t\t\t\tconst icon = L.icon({\n\t\t\t\t\ticonUrl: '/--static--/pyams_gis/img/marker-icon.png',\n\t\t\t\t\ticonSize: [25, 41],\n\t\t\t\t\ticonAnchor: [12, 39]\n\t\t\t\t});\n\t\t\t\tconst marker = L.marker();\n\t\t\t\tmarker.setIcon(icon);\n\t\t\t\tmarker.setLatLng({\n\t\t\t\t\tlon: config.marker.lon,\n\t\t\t\t\tlat: config.marker.lat\n\t\t\t\t});\n\t\t\t\tmarker.addTo(leafmap);\n\t\t\t}\n\t\t\tmap.data('leafmap', leafmap);\n\t\t\tmap.data('leafmap.config', config);\n\t\t\tmap.data('leafmap.layers', layers.reduce((res, layer) => ({\n\t\t\t\t...res,\n\t\t\t\t[layer.options.name]: layer\n\t\t\t}), {}));\n\t\t\tmap.trigger('map.finishing', [map, leafmap, config]);\n\t\t\tif (callback) {\n\t\t\t\tcallback(leafmap, config);\n\t\t\t}\n\t\t\tmap.trigger('map.finished', [map, leafmap, config]);\n\t\t\tresolve(leafmap);\n\t\t});\n\t});\n};\n\n\nconst PyAMS_GIS = {\n\n\t/**\n\t * Map initialization\n\t *\n\t * @param maps: maps elements\n\t * @param options: optional maps configuration settings\n\t * @param callback: maps initialization callback\n\t */\n\tinit: (maps, options, callback) => {\n\n\t\twindow.PyAMS_GIS = PyAMS_GIS;\n\t\tPromise.all([\n\t\t\timport('leaflet'),\n\t\t\timport('leaflet-gesture-handling'),\n\t\t\timport(\"leaflet/dist/leaflet.css\"),\n\t\t\timport(\"leaflet-gesture-handling/dist/leaflet-gesture-handling.css\")\n\t\t]).then(() => {\n\t\t\tconst $maps = $.map(maps, (elt) => {\n\t\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\t\tconst\n\t\t\t\t\t\tmap = $(elt),\n\t\t\t\t\t\tdata = map.data(),\n\t\t\t\t\t\tconfig = data.mapConfiguration;\n\t\t\t\t\tif (config) {\n\t\t\t\t\t\tresolve(createMap(map, config, options, callback));\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$.get(data.mapConfigurationUrl || 'get-map-configuration.json').then((config) => {\n\t\t\t\t\t\t\tcreateMap(map, config, options, callback).then((leafmap) => {\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\t'leafmap': leafmap,\n\t\t\t\t\t\t\t\t\t'config': config\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\t$.when.apply($, $maps).then();\n\t\t});\n\t},\n\n\t/**\n\t * Get layer definition\n\t *\n\t * @param map: source map element\n\t * @param leafmap: current Leaflet map\n\t * @param layer: current layer definition\n\t */\n\tgetLayer: (map, leafmap, layer) => {\n\t\tconst factory = MyAMS.getObject(layer.factory);\n\t\tif (factory !== undefined) {\n\t\t\tdelete layer.factory;\n\t\t\tconst deferred = [];\n\t\t\tif (layer.dependsOn) {\n\t\t\t\tfor (const name in layer.dependsOn) {\n\t\t\t\t\tif (!layer.dependsOn.hasOwnProperty(name)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (MyAMS.getObject(name) === undefined) {\n\t\t\t\t\t\tdeferred.push(MyAMS.getScript(layer.dependsOn[name]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdelete layer.dependsOn;\n\t\t\t}\n\t\t\tif (deferred.length > 0) {\n\t\t\t\t$.when.apply($, deferred);\n\t\t\t}\n\t\t\treturn factory(map, leafmap, layer);\n\t\t}\n\t},\n\n\t/**\n\t * Layers factories\n\t */\n\tfactory: {\n\n\t\tGeoJSON: (map, leafmap, layer) => {\n\t\t\tconst url = layer.url;\n\t\t\tdelete layer.url;\n\t\t\tconst result = L.geoJSON(null, layer);\n\t\t\tmap.on('map.finished', (evt, map, leafmap, config) => {\n\t\t\t\t$.get(url, (data) => {\n\t\t\t\t\tresult.addData(data.geometry, {\n\t\t\t\t\t\tstyle: layer.style\n\t\t\t\t\t});\n\t\t\t\t\tif (config.fitLayer === layer.name) {\n\t\t\t\t\t\tleafmap.fitBounds(result.getBounds());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn result;\n\t\t},\n\n\t\tTileLayer: (map, leafmap, layer) => {\n\t\t\tconst url = layer.url;\n\t\t\tdelete layer.url;\n\t\t\treturn L.tileLayer(url, layer);\n\t\t},\n\n\t\tWMS: function(map, leafmap, layer) {\n\t\t\tconst url = layer.url;\n\t\t\tdelete layer.url;\n\t\t\treturn L.tileLayer.wms(url, layer);\n\t\t},\n\n\t\tGeoportal: {\n\t\t\tWMS: (map, leafmap, layer) => {\n\t\t\t\tMyAMS.getCSS('/--static--/pyams_gis/css/leaflet-gp-3.0.2.min.css', 'geoportal');\n\t\t\t\treturn L.geoportalLayer.WMS(layer);\n\t\t\t}\n\t\t},\n\n\t\tESRI: {\n\t\t\tFeature: (map, leafmap, layer) => {\n\t\t\t\treturn L.esri.featureLayer(layer);\n\t\t\t}\n\t\t},\n\n\t\tGoogle: (map, leafmap, layer) => {\n\t\t\tconst apiKey = layer.apiKey;\n\t\t\tdelete layer.apiKey;\n\t\t\tif (MyAMS.getObject('window.google.maps') === undefined) {\n\t\t\t\tconst script = MyAMS.getScript('https://maps.googleapis.com/maps/api/js?key=' + apiKey);\n\t\t\t\t$.when.apply($, [script]);\n\t\t\t}\n\t\t\treturn L.gridLayer.googleMutant(layer);\n\t\t}\n\t}\n};\n\nexport default PyAMS_GIS;\n"],"names":["MyAMS","createMap","map","config","options","callback","Promise","resolve","reject","data","settings","preferCanvas","mapLeafletPreferCanvas","attributionControl","mapLeafletAttributionControl","undefined","zoomControl","mapLeafletZoomControl","crs","mapLeafletCrs","getObject","L","CRS","EPSG3857","center","mapLeafletCenter","zoom","mapLeafletZoom","gestureHandling","mapLeafletWheelZoom","scrollWheelZoom","keyboard","mapLeafletKeyboard","Browser","mobile","amsLeafletKeyboard","$","extend","trigger","leafmap","attr","layersConfig","layers","_iterator","_createForOfIteratorHelper","_step","s","n","done","layerConfig","value","push","PyAMS_GIS","getLayer","err","e","f","tileLayer","name","title","maxZoom","attribution","when","apply","then","_len","arguments","length","Array","_key","idx","addTo","mapLeafletHideZoomControl","control","scale","setView","LatLng","lat","lon","bounds","fitBounds","marker","icon","iconUrl","iconSize","iconAnchor","setIcon","setLatLng","reduce","res","layer","_objectSpread","_defineProperty","init","maps","window","all","$maps","elt","mapConfiguration","get","mapConfigurationUrl","factory","deferred","dependsOn","hasOwnProperty","getScript","GeoJSON","url","result","geoJSON","on","evt","addData","geometry","style","fitLayer","getBounds","TileLayer","WMS","wms","Geoportal","getCSS","geoportalLayer","ESRI","Feature","esri","featureLayer","Google","apiKey","script","gridLayer","googleMutant"],"sourceRoot":""}