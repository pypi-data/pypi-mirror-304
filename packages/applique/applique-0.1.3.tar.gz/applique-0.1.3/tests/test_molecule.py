"""
Unittests to test molecule object
"""

import unittest
from rdkit import Chem
from rdkit.Chem import (
    rdDepictor,
)  # otherwise it gives import errors during the tests. Strange

import applique as ap
from applique.molecule import Molecule as Mol


class TestMolecule(unittest.TestCase):

    mol_file_benzene = "tests/molecules/benzene.mol"
    mol_file_cyclohexane = "tests/molecules/cyclohexane.mol"
    benzene = Mol()
    benzene = benzene.from_mol(mol_file_benzene)
    cyclohexane = Mol().from_mol(mol_file_cyclohexane)

    def test_from_mol(self):

        assert type(self.benzene.rdmol) == type(
            Chem.rdmolfiles.MolFromMolFile(self.mol_file_benzene)
        )

    def test_struct2D(self):

        ref_benzene = [
            [1.5000000000000004, 7.401486830834377e-17, 0.0],
            [0.7499999999999993, -1.2990381056766587, 0.0],
            [-0.7500000000000006, -1.2990381056766578, 0.0],
            [-1.5, 2.5771188818044677e-16, 0.0],
            [-0.7499999999999996, 1.2990381056766582, 0.0],
            [0.7500000000000006, 1.299038105676658, 0.0],
            [3.0, 2.9605947323337506e-16, 0.0],
            [1.4999999999999996, -2.598076211353318, 0.0],
            [-1.5000000000000007, -2.598076211353315, 0.0],
            [-3.0, 2.9605947323337506e-16, 0.0],
            [-1.4999999999999998, 2.598076211353316, 0.0],
            [1.5000000000000007, 2.598076211353316, 0.0],
        ]

        # case 1
        coordinates = self.benzene.struct2D(self.benzene.rdmol)
        assert coordinates == ref_benzene

        # case 2
        coordinates = self.benzene.struct2D()

        assert coordinates == ref_benzene

    def test_struct3D(self):

        benzene = Mol().from_mol(self.mol_file_benzene)
        cyclohexane = Mol().from_mol(self.mol_file_cyclohexane)

        ref_benzene1 = [
            [1.3450943345819657, -0.3688132490678857, 0.015418984193937732],
            [0.35317071854678866, -1.3493684235286982, 0.003681008182976063],
            [-0.9919236886970124, -0.9805553116234748, -0.011735467397588187],
            [-1.345094563546988, 0.36881322960657625, -0.015414734025988515],
            [-0.35317061836336006, 1.3493687056254713, -0.003685308982120623],
            [0.9919238383624884, 0.9805555159574394, 0.01173437209028455],
            [2.3930770809222546, -0.6561631041414686, 0.027434558370037533],
            [0.6283339759000929, -2.4006813637921787, 0.006545226135124791],
            [-1.7647480729965017, -1.7445192112660388, -0.020881388544513803],
            [-2.393078383671587, 0.6561596464206593, -0.02742969378961074],
            [-0.628331130632013, 2.400682450921035, -0.006555057753962893],
            [1.764746509593872, 1.744521114888543, 0.020887501521429964],
        ]
        ref_benzene2 = [
            [-0.010992221083817958, -1.3942938225848127, 0.0369202923201989],
            [-1.2130131536286053, -0.6884565632086695, -0.012865535167129486],
            [-1.2020206014221246, 0.7058369103419829, -0.04979603029602379],
            [0.010992882995460843, 1.3942933176553562, -0.03694035474979352],
            [1.213014002466435, 0.6884561424263546, 0.012845261835274537],
            [1.2020214436444454, -0.7058375296888078, 0.049776006461011914],
            [-0.01955770127631584, -2.480608562690211, 0.06571308110301495],
            [-2.158091006463371, -1.2248426188868105, -0.022860780525168236],
            [-2.13853398121529, 1.2557656562721673, -0.08856576273822289],
            [0.019556213127864604, 2.480609130852702, -0.06569283270250681],
            [2.1580906041520302, 1.2248437890743664, 0.022880918423080706],
            [2.1385335187033685, -1.255765849563742, 0.0885857360363162],
        ]
        ref_cyclohexane = [
            [0.13601869988578044, 1.397549159372314, -0.3444224022211633],
            [-1.2569509979133149, 0.8337786284457647, -0.056009980394742774],
            [-1.2544264936137637, -0.6556716919496296, 0.29458355765608085],
            [-0.10133296881544865, -1.3933947384556158, -0.37209629800982247],
            [1.2569519421669102, -0.8337767661203186, 0.05600874398711427],
            [1.2197402454634751, 0.6515166519971699, 0.4219348559893923],
            [0.15959039003252554, 2.4645110394818, -0.09551862272812314],
            [0.34186775340120923, 1.3237987372527908, -1.4198232396823731],
            [-1.7179762081675292, 1.3877868108130877, 0.7707474735134278],
            [-1.8939590391426182, 1.0081344849541778, -0.9316913964379185],
            [-2.2115481620720425, -1.103377591677164, 0.004077298335519813],
            [-1.1733846987855665, -0.7722288995798037, 1.3827688979346442],
            [-0.20239308053051555, -1.307094068783521, -1.4614266388563921],
            [-0.1482364852491279, -2.463151663146171, -0.13899211683560425],
            [1.6362867602822262, -1.3975750684405255, 0.9169593358649107],
            [1.975653694751745, -0.9983397092202159, -0.7560174540651192],
            [2.200195550030363, 1.1020192275674607, 0.23043819990595485],
            [1.0339030982756618, 0.7555154574884385, 1.4984797860442232],
        ]

        # case 1
        coordinates = benzene.struct3D(benzene.rdmol)
        assert coordinates == ref_benzene2

        # case 2
        coordinates = benzene.struct3D()
        assert coordinates == ref_benzene1

        # case 3
        coordinates = cyclohexane.struct3D()
        assert coordinates == ref_cyclohexane

    def test_sdfile(self):

        sdfile = "tests/molecules/benzene.sdf"
        benzene = Mol().from_sdf(sdfile)
        ref_benzene1 = [
            [1.2537904914098605, -0.6111862004171138, 0.0001379430301167396],
            [1.156197872904981, 0.7802211542669966, 0.0008245228757204683],
            [0.09759262050491099, -1.3914073843135688, -0.0006866834806471292],
            [-0.09759265286392915, 1.3914074021424616, 0.0006865196192334226],
            [-1.1561979361873167, -0.7802211737190511, -0.0008254118783170804],
            [-1.253790579846969, 0.611186200295849, -0.00013896278461399085],
            [2.230637732858099, -1.087370572282566, 0.00024764480479194597],
            [2.0570090318264005, 1.3881034445410656, 0.001467651571295776],
            [0.17362867025958165, -2.475473925692542, -0.001221650244855152],
            [-0.1736278501586648, 2.4754740424651085, 0.0012225753932446559],
            [-2.057009356865518, -1.3881031543353974, -0.0014671011361125303],
            [-2.230638043841432, 1.0873701670487563, -0.00024704776986530754],
        ]

        coordinates = benzene.struct3D()
        assert coordinates == ref_benzene1
