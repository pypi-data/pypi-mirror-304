"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[1809],{1809:(t,e,s)=>{s.r(e),s.d(e,{IRunningSessionManagers:()=>I,IRunningSessionSidebar:()=>T,RunningSessionManagers:()=>y,RunningSessions:()=>V,SearchableSessions:()=>B,SearchableSessionsList:()=>D});var n=s(63956),i=s(85430),a=s(55947),o=s(20911),l=s(66649),r=s(7258),d=s(21961),h=s(49901),c=s(47392),u=s(2159),g=s(2260),p=s(78156),_=s.n(p);const m="jp-RunningSessions",w="jp-RunningSessions-item",f="jp-RunningSessions-itemLabel",b="jp-RunningSessions-itemDetail",v="jp-RunningSessions-itemShutdown",S="jp-RunningSessions-icon",C="jp-running-sessions",I=new d.Token("@jupyterlab/running:IRunningSessionManagers","A service to add running session managers."),T=new d.Token("@jupyterlab/running:IRunningSessionsSidebar","A token allowing to modify the running sessions sidebar.");class y{constructor(){this._added=new u.Signal(this),this._managers=[]}get added(){return this._added}add(t){return this._managers.push(t),this._added.emit(t),new h.DisposableDelegate((()=>{const e=this._managers.indexOf(t);e>-1&&this._managers.splice(e,1)}))}items(){return this._managers}}function j(t){var e,s;const{runningItem:a}=t,[o,d]=_().useState(!1),h=(0,p.useRef)(!1),c=[w],u=null===(e=a.detail)||void 0===e?void 0:e.call(a),g=a.icon(),m=a.labelTitle?a.labelTitle():"",C=t.translator||l.nullTranslator,I=C.load("jupyterlab"),T=t.shutdownItemIcon||r.closeIcon,y=null!==(s="function"==typeof t.shutdownLabel?t.shutdownLabel(a):t.shutdownLabel)&&void 0!==s?s:I.__("Shut Down"),j=(0,p.useCallback)((t=>{var e;h.current=!0,t.preventDefault(),null===(e=a.shutdown)||void 0===e||e.call(a)}),[a,h]),E=a.children,A=!!(null==E?void 0:E.length),L=(0,p.useCallback)((t=>{if(h.current)return;const e=(0,r.getTreeItemElement)(t.target);t.currentTarget===e&&A&&d(!o)}),[A,o,h]);return t.collapseToggled.connect(((t,e)=>d(e))),a.className&&c.push(a.className),_().createElement(_().Fragment,null,_().createElement(n.k,{className:`${c.join(" ")} jp-TreeItem nested`,onClick:L,"data-context":a.context||"",expanded:!o},g?"string"==typeof g?_().createElement("img",{src:g,className:S,slot:"start"}):_().createElement(g.react,{slot:"start",tag:"span",className:S}):void 0,_().createElement("span",{className:f,title:m,onClick:a.open&&(()=>a.open())},a.label()),u&&_().createElement("span",{className:b},u),a.shutdown&&_().createElement(i.z,{appearance:"stealth",className:v,onClick:j,title:y,slot:"end"},_().createElement(T.react,{tag:null})),E&&_().createElement(x,{runningItems:E,shutdownItemIcon:T,translator:C,collapseToggled:t.collapseToggled})))}function x(t){const e=t.filter,s=e?t.runningItems.map((t=>({item:t,score:e(t)}))).filter((({score:t})=>null!==t)).sort(((t,e)=>t.score.score-e.score.score)).map((({item:t})=>t)):t.runningItems;return _().createElement(_().Fragment,null,s.map(((e,s)=>_().createElement(j,{child:t.child,key:s,runningItem:e,shutdownLabel:t.shutdownLabel,shutdownItemIcon:t.shutdownItemIcon,translator:t.translator,collapseToggled:t.collapseToggled}))))}class E extends r.ReactWidget{constructor(t){super(),this._filterFn=t=>({score:0}),this._filterChanged=new u.Signal(this),this.filter=this.filter.bind(this),this._updateFilter=this._updateFilter.bind(this),this._trans=t.load("jupyterlab"),this.addClass("jp-SearchableSessions-filter")}get filterChanged(){return this._filterChanged}render(){return _().createElement(r.FilterBox,{placeholder:this._trans.__("Search"),updateFilter:this._updateFilter,useFuzzyFilter:!1,caseSensitive:!1})}filter(t){var e;const s=[this._getTextContent(t.label())];for(const n of null!==(e=t.children)&&void 0!==e?e:[])s.push(this._getTextContent(n.label()));return this._filterFn(s.join(" "))}_getTextContent(t){return"string"==typeof t?t:"number"==typeof t||"boolean"==typeof t?""+t:Array.isArray(t)?t.map((t=>this._getTextContent(t))).join(" "):t&&(0,p.isValidElement)(t)?t.props.children.map((t=>this._getTextContent(t))).join(" "):""}_updateFilter(t){this._filterFn=t,this._filterChanged.emit()}}class A extends r.ReactWidget{constructor(t){super(),this._options=t,this._update=new u.Signal(this),t.manager.runningChanged.connect(this._emitUpdate,this),t.filterProvider&&t.filterProvider.filterChanged.connect(this._emitUpdate,this)}get mode(){return this._mode}set mode(t){this._mode!==t&&(this._mode=t,this._update.emit())}dispose(){u.Signal.clearData(this),super.dispose()}onBeforeShow(t){super.onBeforeShow(t),this._update.emit()}render(){const t=this._options;let e=!0;return _().createElement(r.UseSignal,{signal:this._update},(()=>{var s;e?e=!1:t.runningItems=t.manager.running({mode:this.mode});const n=["jp-TreeView"];return"list"===this.mode&&n.push("jp-mod-flat"),_().createElement("div",{className:"jp-RunningSessions-sectionContainer"},_().createElement(a.L,{className:n.join(" ")},_().createElement(x,{runningItems:t.runningItems,shutdownLabel:t.manager.shutdownLabel,shutdownItemIcon:t.manager.shutdownItemIcon,filter:null===(s=t.filterProvider)||void 0===s?void 0:s.filter,translator:t.translator,collapseToggled:t.collapseToggled})))}))}_isAnyHidden(){let t=this.isHidden;if(t)return t;let e=this.parent;for(;null!=e;){if(e.isHidden){t=!0;break}e=e.parent}return t}_emitUpdate(){this._isAnyHidden()||this._update.emit()}}class L extends r.PanelWithToolbar{constructor(t){var e;super(),this._buttons=null,this._listView=!1,this._collapseToggled=new u.Signal(this),this._viewChanged=new u.Signal(this),this._listView="list"===(null!==(e=t.viewMode)&&void 0!==e?e:"tree"),this._manager=t.manager,this._filterProvider=t.filterProvider;const s=t.translator||l.nullTranslator;this._trans=s.load("jupyterlab"),this.addClass("jp-RunningSessions-section"),this.title.label=t.manager.name,this._manager.runningChanged.connect(this._onListChanged,this),t.filterProvider&&t.filterProvider.filterChanged.connect(this._onListChanged,this),this._updateEmptyClass();const n=t.manager.running({mode:t.manager.supportsMultipleViews&&!this._listView?"tree":"list"});!1!==t.showToolbar&&this._initializeToolbar(n),this._listWidget=new A({runningItems:n,collapseToggled:this._collapseToggled,...t}),this._listWidget.mode=t.manager.supportsMultipleViews&&!this._listView?"tree":"list",this.addWidget(this._listWidget)}toggleListView(t){const e=void 0!==t?t:!this._listView;this._listView=e,this._buttons&&(this._buttons["switch-view"].pressed=e),this._collapseToggled.emit(!1),void 0===this._manager.supportsMultipleViews&&this.toggleClass("jp-mod-running-list-view",e),this._updateButtons(),this._listWidget.mode=this._manager.supportsMultipleViews&&!this._listView?"tree":"list",this._viewChanged.emit({mode:e?"list":"tree"})}dispose(){this.isDisposed||(u.Signal.clearData(this),super.dispose())}get _shutdownAllLabel(){return this._manager.shutdownAllLabel||this._trans.__("Shut Down All")}_initializeToolbar(t){const e=t.length>0,s=this._shutdownAllLabel,n=`${s}?`,i=new r.ToolbarButton({label:s,className:"jp-RunningSessions-shutdownAll"+(e?"":" jp-mod-disabled"),enabled:e,onClick:(()=>{var t;const e=null!==(t="function"==typeof this._manager.shutdownAllConfirmationText?this._manager.shutdownAllConfirmationText():this._manager.shutdownAllConfirmationText)&&void 0!==t?t:`${s} ${this._manager.name}`;(0,o.showDialog)({title:n,body:e,buttons:[o.Dialog.cancelButton(),o.Dialog.warnButton({label:s})]}).then((t=>{t.button.accept&&this._manager.shutdownAll()}))}).bind(this)}),a=new r.ToolbarButton({className:"jp-RunningSessions-viewButton",enabled:e,icon:r.tableRowsIcon,pressedIcon:r.treeViewIcon,onClick:()=>this.toggleListView(),tooltip:this._trans.__("Switch to List View"),pressedTooltip:this._trans.__("Switch to Tree View")}),l=new r.ToolbarButton({className:"jp-RunningSessions-collapseButton",enabled:e,icon:r.collapseAllIcon,pressedIcon:r.expandAllIcon,onClick:()=>{const t=!l.pressed;this._collapseToggled.emit(t),l.pressed=t},tooltip:this._trans.__("Collapse All"),pressedTooltip:this._trans.__("Expand All")});this._buttons={"switch-view":a,"collapse-expand":l,"shutdown-all":i},this._updateButtons(),this._manager.runningChanged.connect(this._updateButtons,this),this._manager.toolbarButtons&&this._manager.toolbarButtons.forEach((t=>this.toolbar.addItem(t instanceof r.CommandToolbarButton?t.commandId:t.id,t)));for(const t of["collapse-expand","switch-view","shutdown-all"])this.toolbar.addItem(t,this._buttons[t]);this.toolbar.addClass("jp-RunningSessions-toolbar")}_onListChanged(){this._updateButtons(),this._updateEmptyClass()}_updateEmptyClass(){this._filterProvider&&(0===this._manager.running({mode:this._manager.supportsMultipleViews&&!this._listView?"tree":"list"}).filter(this._filterProvider.filter).length?this.node.classList.toggle("jp-mod-empty",!0):this.node.classList.toggle("jp-mod-empty",!1))}get viewChanged(){return this._viewChanged}_updateButtons(){if(!this._buttons)return;let t=this._manager.running({mode:this._manager.supportsMultipleViews&&!this._listView?"tree":"list"});const e=t.length>0,s=void 0===this._manager.supportsMultipleViews?0!==t.filter((t=>t.children)).length:this._manager.supportsMultipleViews,n=s&&!this._buttons["switch-view"].pressed;this._buttons["switch-view"].node.style.display=s?"flex":"none",this._buttons["collapse-expand"].node.style.display=n?"flex":"none",this._buttons["collapse-expand"].enabled=e,this._buttons["switch-view"].enabled=e,this._buttons["shutdown-all"].enabled=e}}class V extends r.SidePanel{constructor(t,e,s){super(),this.managers=t,this._stateDB=null!=s?s:null,this.translator=null!=e?e:l.nullTranslator;const n=this.translator.load("jupyterlab");this.addClass(m),this.toolbar.addItem("refresh",new r.ToolbarButton({tooltip:n.__("Refresh List"),icon:r.refreshIcon,onClick:()=>t.items().forEach((t=>t.refreshRunning()))})),t.items().forEach((e=>this.addSection(t,e))),t.added.connect(this.addSection,this)}dispose(){this.isDisposed||(this.managers.added.disconnect(this.addSection,this),super.dispose())}async addSection(t,e){const s=new L({manager:e,translator:this.translator});this.addWidget(s);const n=(await this._getState()).listViewSections,i=e.name;n&&n.includes(i)&&s.toggleListView(!0),s.viewChanged.connect((async(t,e)=>{await this._updateState(i,e.mode)}))}async _updateState(t,e){var s;let n=null!==(s=(await this._getState()).listViewSections)&&void 0!==s?s:[];"list"!==e||n.includes(t)?n=n.filter((e=>e!==t)):n.push(t);const i={listViewSections:n};this._stateDB&&await this._stateDB.save(C,i)}async _getState(){var t;return this._stateDB&&null!==(t=await this._stateDB.fetch(C))&&void 0!==t?t:{}}}class R extends L{constructor(t){super(t);const e=document.createElement("h3");e.className="jp-SearchableSessions-title";const s=e.appendChild(document.createElement("span"));s.className="jp-SearchableSessions-titleLabel",s.textContent=this.title.label,this.node.insertAdjacentElement("afterbegin",e)}}class k extends g.Widget{constructor(t){super();const e=t.load("jupyterlab");this.addClass("jp-SearchableSessions-emptyIndicator"),this.node.textContent=e.__("No matches")}}class B extends g.Panel{constructor(t,e){super(),this._activeIndex=0,this._translator=null!=e?e:l.nullTranslator,this.addClass(m),this.addClass("jp-SearchableSessions"),this._filterWidget=new E(this._translator),this.addWidget(this._filterWidget),this._list=new D(t,this._filterWidget,e),this.addWidget(this._list),this._filterWidget.filterChanged.connect((()=>{this._activeIndex=0,this._updateActive(0)}),this)}dispose(){this.isDisposed||(u.Signal.clearData(this),super.dispose())}getValue(){const t=[...this.node.querySelectorAll("."+f)];t[Math.min(Math.max(this._activeIndex,0),t.length-1)].click()}handleEvent(t){"keydown"===t.type&&this._evtKeydown(t)}onAfterAttach(t){this._forceFocusInput(),this.node.addEventListener("keydown",this),setTimeout((()=>{this._updateActive(0)}),0)}onAfterDetach(t){this.node.removeEventListener("keydown",this)}_forceFocusInput(){var t;null===(t=this._filterWidget.renderPromise)||void 0===t||t.then((()=>{var t;const e=this._filterWidget.node.querySelector("jp-search"),s=null===(t=null==e?void 0:e.shadowRoot)||void 0===t?void 0:t.querySelector("input");s?s.focus():console.warn("Input element not found, cannot focus")})).catch(console.warn)}_evtKeydown(t){if("ArrowDown"===t.key||"ArrowUp"===t.key){const e="ArrowDown"===t.key?1:-1;this._updateActive(e)&&t.preventDefault()}}_updateActive(t){const e=[...this.node.querySelectorAll("."+w)].filter((t=>t.checkVisibility()));if(!e.length)return!1;for(const t of e)t.classList.contains("jp-mod-active")&&t.classList.toggle("jp-mod-active",!1);const s=this._activeIndex;let n=null;return n=-1===s?1===t?0:e.length-1:Math.min(Math.max(s+t,0),e.length-1),null!==n&&(e[n].classList.add("jp-mod-active"),c.ElementExt.scrollIntoViewIfNeeded(this._list.node,e[n]),this._activeIndex=n,!0)}}class D extends g.Panel{constructor(t,e,s){super(),this._managers=t,this._translator=null!=s?s:l.nullTranslator,this._filterWidget=e,this.addClass("jp-SearchableSessions-list"),this._emptyIndicator=new k(this._translator),this.addWidget(this._emptyIndicator),t.items().forEach((e=>this.addSection(t,e))),t.added.connect(this.addSection,this)}dispose(){this.isDisposed||(this._managers.added.disconnect(this.addSection,this),super.dispose())}addSection(t,e){const s=new R({manager:e,translator:this._translator,showToolbar:!1,filterProvider:this._filterWidget,viewMode:"list"});s.toggleListView(!0),this.addWidget(s),this.addWidget(this._emptyIndicator)}}}}]);