{"version":3,"file":"ToolkitEditor.B6Zd2tc1.js","sources":["../../../../../../src/lib/components/workspace/Tools/ToolkitEditor.svelte"],"sourcesContent":["<script>\n\timport { getContext, createEventDispatcher, onMount, tick } from 'svelte';\n\n\tconst i18n = getContext('i18n');\n\n\timport CodeEditor from '$lib/components/common/CodeEditor.svelte';\n\timport { goto } from '$app/navigation';\n\timport ConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\n\timport Badge from '$lib/components/common/Badge.svelte';\n\timport ChevronLeft from '$lib/components/icons/ChevronLeft.svelte';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\n\tconst dispatch = createEventDispatcher();\n\n\tlet formElement = null;\n\tlet loading = false;\n\tlet showConfirm = false;\n\n\texport let edit = false;\n\texport let clone = false;\n\n\texport let id = '';\n\texport let name = '';\n\texport let meta = {\n\t\tdescription: ''\n\t};\n\texport let content = '';\n\tlet _content = '';\n\n\t$: if (content) {\n\t\tupdateContent();\n\t}\n\n\tconst updateContent = () => {\n\t\t_content = content;\n\t};\n\n\t$: if (name && !edit && !clone) {\n\t\tid = name.replace(/\\s+/g, '_').toLowerCase();\n\t}\n\n\tlet codeEditor;\n\tlet boilerplate = `import os\nimport requests\nfrom datetime import datetime\n\n\nclass Tools:\n    def __init__(self):\n        pass\n\n    # Add your custom tools using pure Python code here, make sure to add type hints\n    # Use Sphinx-style docstrings to document your tools, they will be used for generating tools specifications\n    # Please refer to function_calling_filter_pipeline.py file from pipelines project for an example\n\n    def get_user_name_and_email_and_id(self, __user__: dict = {}) -> str:\n        \"\"\"\n        Get the user name, Email and ID from the user object.\n        \"\"\"\n\n        # Do not include :param for __user__ in the docstring as it should not be shown in the tool's specification\n        # The session user object will be passed as a parameter when the function is called\n\n        print(__user__)\n        result = \"\"\n\n        if \"name\" in __user__:\n            result += f\"User: {__user__['name']}\"\n        if \"id\" in __user__:\n            result += f\" (ID: {__user__['id']})\"\n        if \"email\" in __user__:\n            result += f\" (Email: {__user__['email']})\"\n\n        if result == \"\":\n            result = \"User: Unknown\"\n\n        return result\n\n    def get_current_time(self) -> str:\n        \"\"\"\n        Get the current time in a more human-readable format.\n        :return: The current time.\n        \"\"\"\n\n        now = datetime.now()\n        current_time = now.strftime(\"%I:%M:%S %p\")  # Using 12-hour format with AM/PM\n        current_date = now.strftime(\n            \"%A, %B %d, %Y\"\n        )  # Full weekday, month name, day, and year\n\n        return f\"Current Date and Time = {current_date}, {current_time}\"\n\n    def calculator(self, equation: str) -> str:\n        \"\"\"\n        Calculate the result of an equation.\n        :param equation: The equation to calculate.\n        \"\"\"\n\n        # Avoid using eval in production code\n        # https://nedbatchelder.com/blog/201206/eval_really_is_dangerous.html\n        try:\n            result = eval(equation)\n            return f\"{equation} = {result}\"\n        except Exception as e:\n            print(e)\n            return \"Invalid equation\"\n\n    def get_current_weather(self, city: str) -> str:\n        \"\"\"\n        Get the current weather for a given city.\n        :param city: The name of the city to get the weather for.\n        :return: The current weather information or an error message.\n        \"\"\"\n        api_key = os.getenv(\"OPENWEATHER_API_KEY\")\n        if not api_key:\n            return (\n                \"API key is not set in the environment variable 'OPENWEATHER_API_KEY'.\"\n            )\n\n        base_url = \"http://api.openweathermap.org/data/2.5/weather\"\n        params = {\n            \"q\": city,\n            \"appid\": api_key,\n            \"units\": \"metric\",  # Optional: Use 'imperial' for Fahrenheit\n        }\n\n        try:\n            response = requests.get(base_url, params=params)\n            response.raise_for_status()  # Raise HTTPError for bad responses (4xx and 5xx)\n            data = response.json()\n\n            if data.get(\"cod\") != 200:\n                return f\"Error fetching weather data: {data.get('message')}\"\n\n            weather_description = data[\"weather\"][0][\"description\"]\n            temperature = data[\"main\"][\"temp\"]\n            humidity = data[\"main\"][\"humidity\"]\n            wind_speed = data[\"wind\"][\"speed\"]\n\n            return f\"Weather in {city}: {temperature}°C\"\n        except requests.RequestException as e:\n            return f\"Error fetching weather data: {str(e)}\"\n`;\n\n\tconst saveHandler = async () => {\n\t\tloading = true;\n\t\tdispatch('save', {\n\t\t\tid,\n\t\t\tname,\n\t\t\tmeta,\n\t\t\tcontent\n\t\t});\n\t};\n\n\tconst submitHandler = async () => {\n\t\tif (codeEditor) {\n\t\t\tcontent = _content;\n\t\t\tawait tick();\n\n\t\t\tconst res = await codeEditor.formatPythonCodeHandler();\n\t\t\tawait tick();\n\n\t\t\tcontent = _content;\n\t\t\tawait tick();\n\n\t\t\tif (res) {\n\t\t\t\tconsole.log('Code formatted successfully');\n\n\t\t\t\tsaveHandler();\n\t\t\t}\n\t\t}\n\t};\n</script>\n\n<div class=\" flex flex-col justify-between w-full overflow-y-auto h-full\">\n\t<div class=\"mx-auto w-full md:px-0 h-full\">\n\t\t<form\n\t\t\tbind:this={formElement}\n\t\t\tclass=\" flex flex-col max-h-[100dvh] h-full\"\n\t\t\ton:submit|preventDefault={() => {\n\t\t\t\tif (edit) {\n\t\t\t\t\tsubmitHandler();\n\t\t\t\t} else {\n\t\t\t\t\tshowConfirm = true;\n\t\t\t\t}\n\t\t\t}}\n\t\t>\n\t\t\t<div class=\"flex flex-col flex-1 overflow-auto h-0\">\n\t\t\t\t<div class=\"w-full mb-2 flex flex-col gap-0.5\">\n\t\t\t\t\t<div class=\"flex w-full items-center\">\n\t\t\t\t\t\t<div class=\" flex-shrink-0 mr-2\">\n\t\t\t\t\t\t\t<Tooltip content={$i18n.t('Back')}>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"w-full text-left text-sm py-1.5 px-1 rounded-lg dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-gray-850\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tgoto('/workspace/tools');\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<ChevronLeft strokeWidth=\"2.5\" />\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div class=\"flex-1\">\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclass=\"w-full text-2xl font-medium bg-transparent outline-none\"\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tplaceholder={$i18n.t('Toolkit Name (e.g. My ToolKit)')}\n\t\t\t\t\t\t\t\tbind:value={name}\n\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Badge type=\"muted\" content={$i18n.t('Tool')} />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\" flex gap-2 px-1\">\n\t\t\t\t\t\t{#if edit}\n\t\t\t\t\t\t\t<div class=\"text-sm text-gray-500 flex-shrink-0\">\n\t\t\t\t\t\t\t\t{id}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tclass=\"w-full text-sm disabled:text-gray-500 bg-transparent outline-none\"\n\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\tplaceholder={$i18n.t('Toolkit ID (e.g. my_toolkit)')}\n\t\t\t\t\t\t\t\tbind:value={id}\n\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\tdisabled={edit}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclass=\"w-full text-sm bg-transparent outline-none\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tplaceholder={$i18n.t(\n\t\t\t\t\t\t\t\t'Toolkit Description (e.g. A toolkit for performing various operations)'\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\tbind:value={meta.description}\n\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"mb-2 flex-1 overflow-auto h-0 rounded-lg\">\n\t\t\t\t\t<CodeEditor\n\t\t\t\t\t\tbind:this={codeEditor}\n\t\t\t\t\t\tvalue={content}\n\t\t\t\t\t\t{boilerplate}\n\t\t\t\t\t\tlang=\"python\"\n\t\t\t\t\t\ton:change={(e) => {\n\t\t\t\t\t\t\t_content = e.detail.value;\n\t\t\t\t\t\t}}\n\t\t\t\t\t\ton:save={() => {\n\t\t\t\t\t\t\tif (formElement) {\n\t\t\t\t\t\t\t\tformElement.requestSubmit();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"pb-3 flex justify-between\">\n\t\t\t\t\t<div class=\"flex-1 pr-3\">\n\t\t\t\t\t\t<div class=\"text-xs text-gray-500 line-clamp-2\">\n\t\t\t\t\t\t\t<span class=\" font-semibold dark:text-gray-200\">{$i18n.t('Warning:')}</span>\n\t\t\t\t\t\t\t{$i18n.t('Tools are a function calling system with arbitrary code execution')} <br />—\n\t\t\t\t\t\t\t<span class=\" font-medium dark:text-gray-400\"\n\t\t\t\t\t\t\t\t>{$i18n.t(`don't install random tools from sources you don't trust.`)}</span\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full\"\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{$i18n.t('Save')}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n</div>\n\n<ConfirmDialog\n\tbind:show={showConfirm}\n\ton:confirm={() => {\n\t\tsubmitHandler();\n\t}}\n>\n\t<div class=\"text-sm text-gray-500\">\n\t\t<div class=\" bg-yellow-500/20 text-yellow-700 dark:text-yellow-200 rounded-lg px-4 py-3\">\n\t\t\t<div>{$i18n.t('Please carefully review the following warnings:')}</div>\n\n\t\t\t<ul class=\" mt-1 list-disc pl-4 text-xs\">\n\t\t\t\t<li>\n\t\t\t\t\t{$i18n.t('Tools have a function calling system that allows arbitrary code execution.')}\n\t\t\t\t</li>\n\t\t\t\t<li>{$i18n.t('Do not install tools from sources you do not fully trust.')}</li>\n\t\t\t</ul>\n\t\t</div>\n\n\t\t<div class=\"my-3\">\n\t\t\t{$i18n.t(\n\t\t\t\t'I acknowledge that I have read and I understand the implications of my action. I am aware of the risks associated with executing arbitrary code and I have verified the trustworthiness of the source.'\n\t\t\t)}\n\t\t</div>\n\t</div>\n</ConfirmDialog>\n"],"names":["insert_hydration","target","button","anchor","ctx","input","div","div3","append_hydration","div1","div0","ul","li0","li1","div2","set_data","t0","t0_value","t2","t2_value","t4","t4_value","t6","t6_value","t11_value","create_if_block","div12","div11","form","div10","div5","input0","div4","input1","set_input_value","div6","div9","div8","div7","span0","br","span1","dirty","t8","t8_value","current","t11","t13","t13_value","i18n","getContext","dispatch","createEventDispatcher","formElement","showConfirm","edit","$$props","clone","id","name","meta","content","_content","updateContent","$$invalidate","codeEditor","boilerplate","saveHandler","submitHandler","tick","res","goto","$$value","e","value"],"mappings":"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"}