!function(){"use strict";function e(e){const t=JSON.parse(e.dataset.schema);console.log("🧱 schema",t),JSON.parse(e.dataset.uischema);const s=JSON.parse(e.dataset.formdata);console.log("🫐 formData",s);const i=document.getElementById(`id_${e.dataset.name}`),r=new JSONEditor(e,{schema:t,startval:s,max_depth:10,show_errors:"always"});r.on("change",(()=>{i.innerHTML=JSON.stringify(r.getValue())}))}document.addEventListener("DOMContentLoaded",(()=>{JSONEditor.defaults.options.theme="html",JSONEditor.defaults.options.iconlib="fontawesome5",window.JSONEditor.defaults.callbacks={select2:{createQueryParams:function(e,t){return{_q:t.term,page:t.page}},processResultData:function(e,t,s){return{results:t.map((e=>({id:btoa(JSON.stringify(e)),text:e.name}))),pagination:{more:!1}}}}},window.JSONEditor.defaults.editors.select2=class extends window.JSONEditor.defaults.editors.select2{titleFieldsPriority=["__str__","name","title","label","id"];preBuild(){"relation"===this.schema.type&&(this.schema.enum=[]),super.preBuild()}forceAddOption(e,t){this.enum_values.includes(e)||(this.schema.enum.push(e),this.enum_values.push(e),this.enum_options.push(e),this.enum_display.push(t),this.theme.setSelectOptions(this.input,this.enum_options,this.enum_display))}isObject(e){return"object"==typeof e&&!Array.isArray(e)&&null!==e}isString(e){return"string"==typeof e}isArray(e){return Array.isArray(e)}isNumber(e){return"number"==typeof e||!isNaN(e)}isRelationObject(e){return this.isObject(e)&&e.id&&e.model}isB64Encoded(e){return this.isString(e)&&e.match(/^[a-zA-Z0-9-_]+={0,2}$/)}isJSONString(e){try{return this.isString(e)&&this.isObject(JSON.parse(e))}catch(e){return!1}}isb64RelationObject(e){if(this.isB64Encoded(e)){var t=atob(e);return this.isJSONString(t)&&this.isRelationObject(JSON.parse(t))}return!1}decodeB64Object(e){return this.isb64RelationObject(e)?JSON.parse(atob(e)):e}deserializeRelValue(e){return this.schema.multiple&&Array.isArray(e)?e.map((e=>this.deserializeRelValue(e))):this.isRelationObject(e)?e:this.isJSONString(e)?JSON.parse(e):this.isb64RelationObject(e)?this.decodeB64Object(e):e}serializeRelValue(e){if(this.schema.multiple&&Array.isArray(e))return e.map((e=>this.serializeRelValue(e)));if(this.isRelationObject(e)){let t=e[this.titleFieldsPriority.find((t=>e[t]))],s=JSON.stringify(e);return this.forceAddOption(s,t),s}return this.isJSONString(e)?this.serializeRelValue(JSON.parse(e)):(this.isb64RelationObject(e),e)}typecast(e){if("relation"===this.schema.type){if(this.schema.multiple&&Array.isArray(e))return e.map((e=>e&&this.serializeRelValue(e)));if(this.schema.options.select2.allowClear&&null===e)return null}return super.typecast(e)}updateValue(e){return"relation"===this.schema.type?this.schema.options.select2.allowClear&&null===e?(this.value=null,this.value):(this.value=this.serializeRelValue(e),this.value):super.updateValue(e)}getValue(){return"relation"===this.schema.type?this.deserializeRelValue(this.value):super.getValue()}async setValue(e,t){for("relation"===this.schema.type&&(e=this.updateValue(e));!this.select2_instance;)await new Promise((e=>setTimeout(e,100)));return super.setValue(e,t)}afterInputReady(){super.afterInputReady(),"relation"===this.schema.type&&(this.newEnumAllowed=!0,this.control?.querySelector(".select2-container")?.removeAttribute("style"))}},window.JSONEditor.defaults.resolvers.unshift((function(e){if("relation"===e.type&&"select2"===e.format)return"select2"}));const t=document.querySelectorAll(".structured-field-editor");for(let s=0;s<t.length;s++)e(t[s])}))}();
