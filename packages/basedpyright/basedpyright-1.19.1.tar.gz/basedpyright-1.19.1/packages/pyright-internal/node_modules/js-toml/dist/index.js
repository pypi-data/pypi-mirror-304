import { createToken, Lexer, CstParser } from 'chevrotain';
import s from 'xregexp';

var le=class{debug=!1;enableDebug(){this.debug=!0;}isDebug(){return this.debug}},A=new le;var He=/]/,N=createToken({name:"ArrayClose",pattern:He,label:"]",pop_mode:!0});var Ge=/\[/,M=createToken({name:"ArrayOpen",pattern:Ge,label:"[",push_mode:"Array"});var je=/,/,B=createToken({name:"Comma",pattern:je,label:","});var v=createToken({name:"ArrayTableClose",pattern:/]]/,label:"]]",push_mode:"Value"});var R=createToken({name:"ArrayTableOpen",pattern:/\[\[/,label:"[["});var H=new Map,d=(r,e,t)=>{let i=H[e.tokenType.name];if(i)return i(r,e,t)},o=(r,e)=>{H[r.name]=e;};var h=createToken({name:"Boolean",pattern:Lexer.NA});o(h,d);var g=/[ \t]/,b=/[\x80-\uD7FF]|[\uE000-\uFFFF]/,l=/\r\n|\n/,P=/"/,me=/\\/,c=/[0-9]/,pe=s.build("{{digit}}|[A-Fa-f]",{digit:c}),nt=s.build('["\\\\bfnrt]|u{{hexDigit}}{4}|U{{hexDigit}}{8}',{hexDigit:pe}),Z=s.build("{{escape}}{{escapeSeqChar}}",{escape:me,escapeSeqChar:nt}),K=/'/,k=/_/,G=/-/,J=/\+/,ot=/[1-9]/,at=s.build("{{digit1_9}}({{digit}}|{{underscore}}{{digit}})+|{{digit}}",{digit1_9:ot,digit:c,underscore:k}),j=s.build("({{minus}}|{{plus}})?{{unsignedDecimalInteger}}",{minus:G,plus:J,unsignedDecimalInteger:at});var f=class extends Error{constructor(e){super(e),this.name="SyntaxParseError";}},ee=class extends f{errors;constructor(e){super(`Syntax error
`+e.map(t=>t.message).join(`
`)),this.errors=e;}},te=class extends f{errors;constructor(e){super(`Syntax error
`+e.map(t=>t.message).join(`
`)),this.errors=e;}},re=class extends f{constructor(e){super(e);}};var Ue=s.build("{{digit}}{4}",{digit:c}),we=s.build("{{digit}}{2}",{digit:c}),De=s.build("{{digit}}{2}",{digit:c}),Ne=/[Tt ]/,ce=s.build("{{digit}}{2}",{digit:c}),ue=s.build("{{digit}}{2}",{digit:c}),Me=s.build("{{digit}}{2}",{digit:c}),lt=s.build("\\.{{digit}}+",{digit:c}),mt=s.build("[+-]{{timeHour}}:{{timeMinute}}",{timeHour:ce,timeMinute:ue}),pt=s.build("[Zz]|{{timeNumOffset}}",{timeNumOffset:mt}),fe=s.build("{{timeHour}}:{{timeMinute}}:{{timeSecond}}{{timeSecFrac}}?",{timeHour:ce,timeMinute:ue,timeSecond:Me,timeSecFrac:lt}),de=s.build("{{dateFullYear}}-{{dateMonth}}-{{dateMDay}}",{dateFullYear:Ue,dateMonth:we,dateMDay:De}),ct=s.build("{{partialTime}}{{timeOffset}}",{partialTime:fe,timeOffset:pt}),ut=s.build("{{fullDate}}{{timeDelim}}{{fullTime}}",{fullDate:de,timeDelim:Ne,fullTime:ct}),ft=s.build("{{fullDate}}{{timeDelim}}{{partialTime}}",{fullDate:de,timeDelim:Ne,partialTime:fe}),dt=de,Be=fe,ht=s.build("{{offsetDateTime}}|{{localDateTime}}|{{localDate}}|{{localTime}}",{offsetDateTime:ut,localDateTime:ft,localDate:dt,localTime:Be}),S=createToken({name:"DateTime",pattern:ht}),gt=r=>{let e=s.build("({{dateFullYear}})-({{dateMonth}})-({{dateMDay}})",{dateFullYear:Ue,dateMonth:we,dateMDay:De}),t=s.exec(r,e);if(t){let i=Number(t[1]),n=Number(t[2]),a=Number(t[3]),p=new Date(i,n-1,a);return p.getFullYear()===i&&p.getMonth()+1===n&&p.getDate()===a}return !0},bt=r=>{let e=s.build("({{timeHour}}):({{timeMinute}}):({{timeSecond}})",{timeHour:ce,timeMinute:ue,timeSecond:Me}),t=s.exec(r,e);if(t){let i=Number(t[1]),n=Number(t[2]),a=Number(t[3]),p=new Date(0,0,0,i,n,a);return p.getHours()===i&&p.getMinutes()===n&&p.getSeconds()===a}return !0},Tt=r=>gt(r)&&bt(r);o(S,r=>{var t;if(!Tt(r))throw new f(`Invalid date time: ${r}`);return ((t=r.match(Be))==null?void 0:t.index)===0?r:new Date(r)});var F=createToken({name:"DotSeparator",pattern:/\./,label:"."});var O=createToken({name:"ExpressionNewLine",pattern:l});var It=j,ve=s.build("{{digit}}({{digit}}|{{underscore}}{{digit}})*",{digit:c,underscore:k}),Lt=s.build("({{minus}}|{{plus}})?{{zeroPrefixableInt}}",{minus:G,plus:J,zeroPrefixableInt:ve}),kt=s.build("[Ee]{{floatExpPart}}",{floatExpPart:Lt}),Et=/\./,Ct=s.build("{{decimalPoint}}{{zeroPrefixableInt}}",{decimalPoint:Et,zeroPrefixableInt:ve}),At=/inf/,Ot=/nan/,Ut=s.build("({{minus}}|{{plus}})?({{inf}}|{{nan}})",{minus:G,plus:J,inf:At,nan:Ot}),wt=s.build("{{floatIntPart}}({{exp}}|{{frac}}{{exp}}?)|{{specialFloat}}",{floatIntPart:It,exp:kt,frac:Ct,specialFloat:Ut}),y=createToken({name:"Float",pattern:wt}),Dt=r=>r==="inf"||r==="+inf"?1/0:r==="-inf"?-1/0:r==="nan"||r==="+nan"||r==="-nan"?NaN:null;o(y,r=>{let e=Dt(r);if(e!==null)return e;let t=r.replace(/_/g,"");return parseFloat(t)});var Mt=/}/,w=createToken({name:"InlineTableClose",pattern:Mt,label:"}",pop_mode:!0});var vt=/{/,_=createToken({name:"InlineTableOpen",pattern:vt,label:"{",push_mode:"InlineTable"});var Vt=/,/,q=createToken({name:"InlineTableSep",pattern:Vt,label:",",pop_mode:!0,push_mode:"InlineTable"});var T=createToken({name:"Integer",pattern:Lexer.NA});o(T,d);var E=createToken({name:"KeyValueSeparator",pattern:/=/,label:"=",push_mode:"Value"});var X=createToken({name:"Newline",pattern:l,pop_mode:!0});var m=createToken({name:"SimpleKey",pattern:Lexer.NA});o(m,d);var Q=createToken({name:"StdTableClose",pattern:/]/,label:"]",push_mode:"Value"});var Y=createToken({name:"StdTableOpen",pattern:/\[/,label:"["});var u=createToken({name:"String",pattern:Lexer.NA});o(u,d);var Gt=s.build("{{whiteSpaceChar}}+",{whiteSpaceChar:g}),he=createToken({name:"WhiteSpace",pattern:Gt,group:Lexer.SKIPPED});var Jt=s.build("^{{whiteSpaceChar}}*{{newline}}(?:{{whiteSpaceChar}}|{{newline}})*",{whiteSpaceChar:g,newline:l}),jt=r=>{let e=s.exec(r,Jt);return e?e[0].length:0},ie=r=>{let e="";for(let t=0;t<r.length;t++){let i=r[t];if(i==="\\"){t++;let n=jt(r.slice(t));if(n>0){t+=n-1;continue}switch(r[t]){case"b":e+="\b";break;case"t":e+="	";break;case"n":e+=`
`;break;case"f":e+="\f";break;case"r":e+="\r";break;case'"':e+='"';break;case"\\":e+="\\";break;case"u":{let a=r.slice(t+1,t+5),p=parseInt(a,16);if(p>55295&&p<57344)throw new f(`Invalid Unicode code point: \\u${a}`);e+=String.fromCodePoint(p),t+=4;break}case"U":{let a=r.slice(t+1,t+9),p=parseInt(a,16);if(p>1114111)throw new f(`Invalid Unicode code point: \\U${a}`);e+=String.fromCodePoint(p),t+=8;break}case r.match(/^[0-7]{1,3}$/):}}else e+=i;}return e},ne=r=>r.substring(3,r.length-3).replace(/^(\r\n|\n)/,"");var tr=s.build("{{quotationMark}}{3}",{quotationMark:P}),rr=s.build("{{whiteSpaceChar}}|!|[#-\\x5B]|[\\x5D-~]|{{nonAscii}}",{whiteSpaceChar:g,nonAscii:b}),ir=s.build("{{multiLineBasicUnescaped}}|{{escaped}}",{multiLineBasicUnescaped:rr,escaped:Z}),nr=s.build("{{whiteSpaceChar}}*",{whiteSpaceChar:g}),or=s.build("{{escape}}{{whiteSpace}}{{newline}}({{whiteSpaceChar}}|{{newline}})*",{escape:me,whiteSpace:nr,newline:l,whiteSpaceChar:g}),ar=s.build("{{multiLineBasicChar}}|{{newline}}|{{multiLineBasicEscapedNewline}}",{multiLineBasicChar:ir,newline:l,multiLineBasicEscapedNewline:or}),sr=s.build("{{quotationMark}}{1,2}",{quotationMark:P}),lr=s.build("{{multiLineBasicContent}}*({{multiLineBasicQuotes}}{{multiLineBasicContent}}+)*{{multiLineBasicQuotes}}?",{multiLineBasicContent:ar,multiLineBasicQuotes:sr}),ge=createToken({name:"MultiLineBasicString",pattern:s.build("{{multiLineBasicStringDelimiter}}{{newline}}?{{multiLineBasicBody}}{{multiLineBasicStringDelimiter}}",{multiLineBasicStringDelimiter:tr,newline:l,multiLineBasicBody:lr}),label:'"""MultiLineBasicString"""',categories:[u],line_breaks:!0});o(ge,r=>{let e=ne(r);return ie(e)});var pr=s.build("{{apostrophe}}{3}",{apostrophe:K}),cr=s.build("	|[ -&]|[\\x28-~]|{{nonAscii}}",{nonAscii:b}),ur=s.build("{{multiLineLiteralChar}}|{{newline}}",{multiLineLiteralChar:cr,newline:l}),fr=s.build("{{apostrophe}}{1,2}",{apostrophe:K}),dr=s.build("{{multiLineLiteralContent}}*({{multiLineLiteralQuotes}}{{multiLineLiteralContent}}+)*{{multiLineLiteralQuotes}}?",{multiLineLiteralContent:ur,multiLineLiteralQuotes:fr}),be=createToken({name:"MultiLineLiteralString",pattern:s.build("{{multiLineLiteralStringDelimiter}}{{newline}}?{{multiLineLiteralBody}}{{multiLineLiteralStringDelimiter}}",{multiLineLiteralStringDelimiter:pr,newline:l,multiLineLiteralBody:dr}),label:"'''MultiLineLiteralString'''",categories:[u],line_breaks:!0});o(be,ne);var W=createToken({name:"QuotedKey",pattern:Lexer.NA,categories:[m]});o(W,d);var Tr=s.build("{{whiteSpaceChar}}|!|[#-\\x5B]|[\\x5D-~]|{{nonAscii}}",{whiteSpaceChar:g,nonAscii:b}),xr=s.build("{{basicUnescaped}}|{{escaped}}",{basicUnescaped:Tr,escaped:Z}),oe=createToken({name:"BasicString",pattern:s.build("{{quotationMark}}{{basicChar}}*{{quotationMark}}",{quotationMark:P,basicChar:xr}),label:'"BasicString"',categories:[W,u]});o(oe,r=>{let e=r.slice(1,-1);return ie(e)});var yr=s.build("	|[ -&]|[\\x28-~]|{{nonAscii}}",{nonAscii:b}),ae=createToken({name:"LiteralString",pattern:s.build("{{apostrophe}}{{literalChar}}*{{apostrophe}}",{apostrophe:K,literalChar:yr}),label:"'LiteralString'",categories:[W,u]});o(ae,r=>r.slice(1,-1));var Lr=/0x/,kr=/0o/,Er=/0b/,Cr=/[0-7]/,Ar=/[01]/,Or=s.build("{{hexPrefix}}{{hexDigit}}({{hexDigit}}|{{underscore}}{{hexDigit}})*",{hexPrefix:Lr,hexDigit:pe,underscore:k}),Ur=s.build("{{octPrefix}}{{digit0_7}}({{digit0_7}}|{{underscore}}{{digit0_7}})*",{octPrefix:kr,digit0_7:Cr,underscore:k}),wr=s.build("{{binPrefix}}{{digit0_1}}({{digit0_1}}|{{underscore}}{{digit0_1}})*",{binPrefix:Er,digit0_1:Ar,underscore:k}),Dr=s.build("{{hexInteger}}|{{octalInteger}}|{{binaryInteger}}",{hexInteger:Or,octalInteger:Ur,binaryInteger:wr}),xe=createToken({name:"NonDecimalInteger",pattern:Dr,categories:[T]}),Nr=(r,e)=>{let t=BigInt(0);for(let i=0;i<r.length;i++){let n=r[i],a=parseInt(n,e);t=t*BigInt(e)+BigInt(a);}return t},Mr=r=>{if(r.startsWith("0x"))return 16;if(r.startsWith("0o"))return 8;if(r.startsWith("0b"))return 2};o(xe,r=>{let t=r.replace(/_/g,"").slice(2),i=Mr(r),n=parseInt(t,i);return Number.isSafeInteger(n)?n:Nr(t,i)});var Se=createToken({name:"DecimalInteger",pattern:j,categories:[T]});o(Se,r=>{let e=r.replace(/_/g,""),t=parseInt(e);return Number.isSafeInteger(t)?t||0:BigInt(e)});var Vr=/[a-zA-Z]/,Pr=s.build("({{alpha}}|{{digit}}|-|_)+",{alpha:Vr,digit:c}),ye=createToken({name:"UnquotedKey",pattern:Pr,categories:[m]});o(ye,r=>r);var Fr=/#/,_r=s.build("	|[ -~]|{{nonAscii}}",{nonAscii:b}),qr=s.build("{{commentStartChar}}{{nonEol}}*",{commentStartChar:Fr,nonEol:_r}),Ie=createToken({name:"Comment",pattern:qr,group:"comment"});var Qr=/true/,Le=createToken({name:"True",pattern:Qr,label:"true",categories:[h]});o(Le,()=>!0);var Wr=/false/,ke=createToken({name:"False",pattern:Wr,label:"false",categories:[h]});o(ke,()=>!1);var Ke=createToken({name:"IgnoredNewline",pattern:l,group:Lexer.SKIPPED});var Fe=createToken({name:"InlineTableKeyValSep",pattern:/=/,label:"=",push_mode:"Value",pop_mode:!0,categories:[E]});var _e=[he,oe,ae,ye,F,m],qe=[he,ge,be,oe,ae,Le,ke,S,y,xe,Se,M,_,Ie],z={modes:{Key:[Ie,O,E,R,v,Y,Q,..._e],Value:[...qe,X,q,w],Array:[...qe,Ke,B,N],InlineTable:[..._e,Fe,w]},defaultMode:"Key"};var Xe=new Lexer(z,{ensureOptimizations:!0,skipValidations:!A.isDebug(),traceInitPerf:A.isDebug()});var Ee=class extends CstParser{toml=this.RULE("toml",()=>{this.MANY(()=>this.CONSUME(O)),this.MANY1(()=>{this.SUBRULE1(this.expression),this.OPTION2(()=>{this.CONSUME1(X),this.MANY3(()=>this.CONSUME2(O));});});});valueCache;dottedKey=this.RULE("dottedKey",()=>{this.CONSUME(m),this.AT_LEAST_ONE(()=>{this.CONSUME(F),this.CONSUME1(m);});});key=this.RULE("key",()=>{this.OR({MAX_LOOKAHEAD:2,DEF:[{ALT:()=>this.SUBRULE(this.dottedKey)},{ALT:()=>this.CONSUME(m)}]});});inlineTableKeyValues=this.RULE("inlineTableKeyValues",()=>{this.MANY_SEP({SEP:q,DEF:()=>this.SUBRULE(this.keyValue)});});inlineTable=this.RULE("inlineTable",()=>{this.CONSUME(_),this.OPTION(()=>this.SUBRULE(this.inlineTableKeyValues)),this.CONSUME(w);});array=this.RULE("array",()=>{this.CONSUME(M),this.OPTION(()=>this.SUBRULE(this.arrayValues)),this.CONSUME(N);});value=this.RULE("value",()=>{this.OR(this.valueCache||(this.valueCache=[{ALT:()=>this.CONSUME(u)},{ALT:()=>this.CONSUME(h)},{ALT:()=>this.SUBRULE(this.array)},{ALT:()=>this.SUBRULE(this.inlineTable)},{ALT:()=>this.CONSUME(S)},{ALT:()=>this.CONSUME(y)},{ALT:()=>this.CONSUME(T)}]));});keyValue=this.RULE("keyValue",()=>{this.SUBRULE(this.key),this.CONSUME(E),this.SUBRULE(this.value);});arrayValues=this.RULE("arrayValues",()=>{this.SUBRULE(this.value);let e=!0;this.MANY({GATE:()=>e,DEF:()=>{this.CONSUME(B),this.OPTION(()=>this.SUBRULE1(this.value))||(e=!1);}});});stdTable=this.RULE("stdTable",()=>{this.CONSUME(Y),this.SUBRULE(this.key),this.CONSUME(Q);});arrayTable=this.RULE("arrayTable",()=>{this.CONSUME(R),this.SUBRULE(this.key),this.CONSUME(v);});table=this.RULE("table",()=>{this.OR([{ALT:()=>this.SUBRULE(this.stdTable)},{ALT:()=>this.SUBRULE(this.arrayTable)}]);});expression=this.RULE("expression",()=>{this.OR([{ALT:()=>this.SUBRULE(this.keyValue)},{ALT:()=>this.SUBRULE(this.table)}]);});constructor(){super(z,{traceInitPerf:A.isDebug(),maxLookahead:1,skipValidations:!A.isDebug()}),this.performSelfAnalysis();}},C=new Ee;var Qe=r=>r&&r.constructor===Object,Ce=(r,e)=>{try{return r()}catch(t){if(t instanceof I)throw new re(e)}},I=class extends Error{},Jr=C.getBaseCstVisitorConstructor(),Ae=Symbol("explicitlyDeclared"),Ye=Symbol("implicitlyDeclared"),$=Symbol("notEditable"),Oe=class extends Jr{constructor(){super(),this.validateVisitor();}toml(e){var n;let t={},i=t;return (n=e.expression)==null||n.forEach(a=>i=this.visit(a,{current:i,root:t})),this.cleanInternalProperties(t),t}expression(e,{current:t,root:i}){if(e.keyValue)return this.visit(e.keyValue,t),t;if(e.table)return this.visit(e.table,i)}keyValue(e,t){let i=this.visit(e.key),n=this.visit(e.value);Ce(()=>this.assignValue(i,n,t),`Cannot assign value to '${i.join(".")}'`);}key(e){return e.dottedKey?this.visit(e.dottedKey):[this.interpret(e,m)]}dottedKey(e){return this.interpret(e,m)}inlineTableKeyValues(e,t){e.keyValue&&e.keyValue.forEach(i=>this.visit(i,t));}inlineTable(e){let t={[$]:!0};return e.inlineTableKeyValues&&this.visit(e.inlineTableKeyValues,t),t}value(e){return e.array?this.visit(e.array):e.inlineTable?this.visit(e.inlineTable):this.interpret(e,u,y,h,S,T)}arrayValues(e,t){return e.value.forEach(i=>t.push(this.visit(i))),t}array(e){let t=[];return t[$]=!0,e.arrayValues?this.visit(e.arrayValues,t):t}table(e,t){if(e.stdTable)return this.visit(e.stdTable,t);if(e.arrayTable)return this.visit(e.arrayTable,t)}stdTable(e,t){let i=this.visit(e.key);return Ce(()=>this.createTable(i,t),`Cannot create table '${i.join(".")}'`)}arrayTable(e,t){let i=this.visit(e.key);return Ce(()=>{let n=this.getOrCreateArray(i,t);if(n[$])throw new I;let a={};return n.push(a),a},`Cannot create array table '${i.join(".")}'`)}cleanInternalProperties(e){for(let t of Object.getOwnPropertySymbols(e))delete e[t];for(let t in e)typeof e[t]=="object"&&this.cleanInternalProperties(e[t]),Array.isArray(e[t])&&e[t].forEach(i=>this.cleanInternalProperties(i));}interpret(e,...t){for(let i of t)if(e[i.name]){let n=e[i.name].map(a=>H[i.name](a.image,a,i.name));return n.length===1?n[0]:n}}assignPrimitiveValue(e,t,i){if(e in i)throw new I;return Qe(t)&&(t[Ae]=!0),i[e]=t,i}tryCreatingObject(e,t,i,n,a){if(t[e]){if(!Qe(t[e])||!a&&t[e][Ae]||!n&&t[e][Ye]||t[e][$])throw new I}else t[e]={},i&&(t[e][i]=!0);return t[e]}assignValue(e,t,i){let[n,...a]=e;return a.length>0?(this.tryCreatingObject(n,i,Ye,!0,!1),this.assignValue(a,t,i[n])):this.assignPrimitiveValue(n,t,i)}createTable(e,t){let[i,...n]=e;if(n.length>0){if(Array.isArray(t[i])){if(t[i][$])throw new I;let a=t[i][t[i].length-1];return this.createTable(n,a)}return this.tryCreatingObject(i,t,null,!0,!0),this.createTable(n,t[i])}return this.tryCreatingObject(i,t,Ae,!1,!1)}getOrCreateArray(e,t){let[i,...n]=e;if(n.length>0){if(Array.isArray(t[i])){let a=t[i][t[i].length-1];return this.getOrCreateArray(n,a)}return this.tryCreatingObject(i,t,null,!0,!0),this.getOrCreateArray(n,t[i])}if(t[i]&&!Array.isArray(t[i]))throw new I;return t[i]=t[i]||[],t[i]}},We=new Oe;var ze=r=>{let e=Xe.tokenize(r);if(e.errors.length>0)throw new ee(e.errors);C.input=e.tokens;let t=C.toml();if(C.errors.length>0)throw new te(C.errors);return We.visit(t)};

export { f as SyntaxParseError, ze as load };
