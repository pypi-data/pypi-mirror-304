<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>chloride &mdash; rational-rc beta documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            rational-rc
          </a>
              <div class="version">
                0.2.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/features.html">Features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Rational-RC API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/module_index.html">Modules</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/tutorial_index.html">Tutorials</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">rational-rc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">chloride</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for chloride</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">**Summary**</span>

<span class="sd">Analytical solution of Fick’s second law under the advection zone,\n</span>
<span class="sd">modified with material property and exposure environment.</span>

<span class="sd">+ **Resistance**: 	critical chloride content</span>
<span class="sd">+ **Load**: 		chloride content at rebar depth</span>
<span class="sd">+ **limit-state**: 	chloride content at rebar depth &gt;= critical chloride content</span>
<span class="sd">+ **Field data**: 	chloride content profile</span>

<span class="sd">Future TODO: make t input vectorized. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erf</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">rational_rc.math_helper</span> <span class="k">as</span> <span class="nn">mh</span>


<span class="c1"># logger</span>
<span class="c1"># log levels: NOTSET, DEBUG, INFO, WARNING, ERROR, and CRITICAL</span>
<span class="n">LOG_FORMAT</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(asctime)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;mylog.log&quot;</span><span class="p">,</span>
    <span class="c1"># level=logging.DEBUG,</span>
    <span class="nb">format</span><span class="o">=</span><span class="n">LOG_FORMAT</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span>
<span class="p">)</span>  <span class="c1"># set logging level here to work in jupyter notebook where maybe a default setting was there</span>


<span class="c1"># model functions</span>
<div class="viewcode-block" id="chloride_content"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.chloride_content">[docs]</a><span class="k">def</span> <span class="nf">chloride_content</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the chloride content at depth x and time t with Fick&#39;s 2nd law below the advection zone (x &gt; dx).</span>
<span class="sd">    </span>
<span class="sd">    + Caution: The pars instance is mutable, so a deepcopy of the original instance should be used if the calculation is not intended for &quot;inplace&quot;.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : float or int</span>
<span class="sd">        Depth at which chloride content C_x_t is reported [mm].</span>
<span class="sd">    t : float or int</span>
<span class="sd">        Time [year].</span>
<span class="sd">    pars : param object</span>
<span class="sd">        An instance of the Param class, containing material and environmental parameters.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy array</span>
<span class="sd">        Sample of the distribution of the chloride content in concrete at a depth x (surface x=0) at time t [wt-.%/c]</span>
<span class="sd">    </span>
<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Intermediate parameters are calculated and attached to pars:</span>

<span class="sd">    C_0    : initial chloride content of the concrete [wt-.%/cement]</span>
<span class="sd">    C_S_dx : chloride content at a depth dx and a certain point of time t [wt-.%/cement]</span>
<span class="sd">    dx     : depth of the advection zone (concrete layer, up to which the process of chloride penetration differs from Fick’s 2nd law of diffusion) [mm]</span>
<span class="sd">    D_app  : apparent coefficient of chloride diffusion through concrete [mm^2/year]</span>
<span class="sd">    erf    : imported error function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">D_app</span> <span class="o">=</span> <span class="n">D_app</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>
    <span class="n">C_x_t</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_0</span> <span class="o">+</span> <span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">C_S_dx</span> <span class="o">-</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="mi">1</span> <span class="o">-</span> <span class="n">erf</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">pars</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">D_app</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">C_x_t</span></div>


<div class="viewcode-block" id="D_app"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.D_app">[docs]</a><span class="k">def</span> <span class="nf">D_app</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the apparent coefficient of chloride diffusion through concrete D_app[mm^2/year]</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : float, int</span>
<span class="sd">        time [year]</span>
<span class="sd">    pars : instance of param object</span>
<span class="sd">        a wrapper of all material and environmental parameters deep-copied from the raw data</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy array</span>
<span class="sd">        sample of the distribution of the apparent coefficient of chloride diffusion through concrete [mm^2/year]</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    intermediate parameters calculated and attached to pars</span>
<span class="sd">    </span>
<span class="sd">    k_e     : environmental transfer variable [-]</span>
<span class="sd">    D_RCM_0 : chloride migration coefficient [mm^2/year]</span>
<span class="sd">    k_t     : transfer parameter, k_t =1 was set in A_t()[-]</span>
<span class="sd">    A_t     : subfunction considering the &#39;ageing&#39; [-]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">k_e</span> <span class="o">=</span> <span class="n">k_e</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">D_RCM_0</span> <span class="o">=</span> <span class="n">D_RCM_0</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>

    <span class="n">pars</span><span class="o">.</span><span class="n">A_t</span> <span class="o">=</span> <span class="n">A_t</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pars</span><span class="p">)</span>  <span class="c1"># pars.k_t =1 was set in A_t()</span>
    <span class="n">D_app</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">k_e</span> <span class="o">*</span> <span class="n">pars</span><span class="o">.</span><span class="n">D_RCM_0</span> <span class="o">*</span> <span class="n">pars</span><span class="o">.</span><span class="n">k_t</span> <span class="o">*</span> <span class="n">pars</span><span class="o">.</span><span class="n">A_t</span>
    <span class="k">return</span> <span class="n">D_app</span></div>


<div class="viewcode-block" id="k_e"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.k_e">[docs]</a><span class="k">def</span> <span class="nf">k_e</span><span class="p">(</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the environmental transfer variable k_e [-].</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pars : Param</span>
<span class="sd">        An instance of the Param class, containing the following parameters:</span>
<span class="sd">    pars.T_ref : float</span>
<span class="sd">        Standard test temperature 293.[K].</span>
<span class="sd">    pars.T_real : float</span>
<span class="sd">        Temperature of the structural element [K].</span>
<span class="sd">    pars.b_e : float</span>
<span class="sd">        Regression variable [K].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy array</span>
<span class="sd">        Large sample of the distribution of k_e.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">T_ref</span> <span class="o">=</span> <span class="mi">293</span>  <span class="c1"># K (20°C)</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">b_e</span> <span class="o">=</span> <span class="n">b_e</span><span class="p">()</span>
    <span class="n">k_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span> <span class="o">**</span> <span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">b_e</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">pars</span><span class="o">.</span><span class="n">T_ref</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">pars</span><span class="o">.</span><span class="n">T_real</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">k_e</span></div>


<div class="viewcode-block" id="b_e"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.b_e">[docs]</a><span class="k">def</span> <span class="nf">b_e</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide a large sample array of b_e: regression variable [K].&quot;&quot;&quot;</span>
    <span class="n">b_e</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">normal_custom</span><span class="p">(</span><span class="mi">4800</span><span class="p">,</span> <span class="mi">700</span><span class="p">)</span>  <span class="c1"># K</span>
    <span class="k">return</span> <span class="n">b_e</span></div>


<div class="viewcode-block" id="A_t"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.A_t">[docs]</a><span class="k">def</span> <span class="nf">A_t</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate A_t considering the ageing effect.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : int or float</span>
<span class="sd">        Time [year].</span>
<span class="sd">    pars : instance of param object</span>
<span class="sd">        A wrapper of all material and environmental parameters deep-copied from the raw data.</span>
<span class="sd">        </span>
<span class="sd">        pars.concrete_type : string</span>
<span class="sd">            Option:</span>

<span class="sd">            &#39;Portland cement concrete&#39;,</span>

<span class="sd">            &#39;Portland fly ash cement concrete&#39;,</span>

<span class="sd">            &#39;Blast furnace slag cement concrete&#39;</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy array</span>
<span class="sd">        Subfunction considering the &quot;ageing&quot; [-].</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Built-in parameters</span>
<span class="sd">        pars.k_t : transfer parameter, k_t =1 was set for experiment [-]</span>
<span class="sd">        pars.t_0 : reference point of time, 0.0767 [year]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">t_0</span> <span class="o">=</span> <span class="mf">0.0767</span>  <span class="c1"># reference point of time [year]</span>
    <span class="c1"># To carry out the quantification of a, the transfer variable k_t was set to k_t = 1:</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">k_t</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1"># a: aging exponent</span>
    <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">pars</span><span class="o">.</span><span class="n">concrete_type</span> <span class="o">==</span> <span class="s2">&quot;Portland cement concrete&quot;</span><span class="p">:</span>
        <span class="c1"># CEM I; 0.40 ≤ w/c ≤ 0.60</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">beta_custom</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">pars</span><span class="o">.</span><span class="n">concrete_type</span> <span class="o">==</span> <span class="s2">&quot;Portland fly ash cement concrete&quot;</span><span class="p">:</span>
        <span class="c1"># f≥0.20·z;k=0.50; 0.40≤w/c_eqv. ≤0.62</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">beta_custom</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">pars</span><span class="o">.</span><span class="n">concrete_type</span> <span class="o">==</span> <span class="s2">&quot;Blast furnace slag cement concrete&quot;</span><span class="p">:</span>
        <span class="c1"># CEM III/B; 0.40 ≤ w/c ≤ 0.60</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">beta_custom</span><span class="p">(</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.20</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">t_0</span> <span class="o">/</span> <span class="n">t</span><span class="p">)</span> <span class="o">**</span> <span class="n">a</span>
    <span class="k">return</span> <span class="n">A</span></div>


<div class="viewcode-block" id="D_RCM_0"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.D_RCM_0">[docs]</a><span class="k">def</span> <span class="nf">D_RCM_0</span><span class="p">(</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Return the chloride migration coefficient from Rapid chloride migration test [m^2/s] see NT Build 492</span>
<span class="sd">    if the test data is not available from pars, use interpolation of existing empirical data for orientation purpose</span>
<span class="sd">    Pay attention to the units output [mm^2/year], used for the model</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pars : instance of param object</span>
<span class="sd">        a wrapper of all material and environmental parameters deep-copied from the raw data</span>

<span class="sd">    pars.D_RCM_test    : int or float</span>
<span class="sd">                            RCM test results[m^2/s], the mean value from the test is used, and standard deviation is estimated based on mean</span>
<span class="sd">    pars.option.choose : bool</span>
<span class="sd">                            If true interpolation from existing data table is used</span>
<span class="sd">    pars.option.df_D_RCM_0  : pandas.DataFrame</span>
<span class="sd">                            Experimental data table(cement type, and w/c eqv) for interpolation</span>
<span class="sd">    pars.option.cement_type : string</span>
<span class="sd">                            Select cement type for data interpolation of the df_D_RCM_0,</span>
<span class="sd">                            Options:</span>
<span class="sd">                            &#39;CEM_I_42.5_R&#39;\n</span>
<span class="sd">                            &#39;CEM_I_42.5_R+FA&#39;\n</span>
<span class="sd">                            &#39;CEM_I_42.5_R+SF&#39;\n</span>
<span class="sd">                            &#39;CEM_III/B_42.5&#39;</span>
<span class="sd">    pars.option.wc_eqv : float</span>
<span class="sd">                        equivalent water cement ratio considering supplementary cementitious materials</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy array</span>
<span class="sd">         D_RCM_0_final [mm^2/year].</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">D_RCM_test</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">D_RCM_test</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="c1"># though test result [m^2/s]</span>
        <span class="n">D_RCM_0_mean</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">D_RCM_test</span>  <span class="c1"># [m^2/s]</span>
        <span class="n">D_RCM_0_std</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">D_RCM_0_mean</span>
        <span class="n">D_RCM_0_temp</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">normal_custom</span><span class="p">(</span><span class="n">D_RCM_0_mean</span><span class="p">,</span> <span class="n">D_RCM_0_std</span><span class="p">)</span>  <span class="c1"># [m^2/s]</span>
    <span class="k">elif</span> <span class="n">pars</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">choose</span><span class="p">:</span>
        <span class="c1"># print &#39;No test data, interpolate: orientation purpose&#39;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">df_D_RCM_0</span>
        <span class="n">fit_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">pars</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">cement_type</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

        <span class="c1"># Curve fit</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">fit_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">fit_df</span><span class="o">.</span><span class="n">values</span>
        <span class="c1"># [m^2/s] #interp_extrap_f: defined function</span>
        <span class="n">D_RCM_0_mean</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">interp_extrap_f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">pars</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">wc_eqv</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-12</span>
        <span class="n">D_RCM_0_std</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">D_RCM_0_mean</span>  <span class="c1"># [m^2/s]</span>

        <span class="n">D_RCM_0_temp</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">normal_custom</span><span class="p">(</span><span class="n">D_RCM_0_mean</span><span class="p">,</span> <span class="n">D_RCM_0_std</span><span class="p">)</span>  <span class="c1"># [m^2/s]</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;D_RCM_0 calculation failed.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error message&quot;</span><span class="p">)</span>

    <span class="c1"># unit change [m^2/s] -&gt; [mm^2/year]  final model input</span>
    <span class="n">D_RCM_0_final</span> <span class="o">=</span> <span class="mf">1e6</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">365</span> <span class="o">*</span> <span class="n">D_RCM_0_temp</span>
    <span class="k">return</span> <span class="n">D_RCM_0_final</span></div>


<span class="c1"># Built-in Data Table for data interpolation</span>

<span class="c1"># Data table to interpolate/extrapolate</span>
<div class="viewcode-block" id="load_df_D_RCM"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.load_df_D_RCM">[docs]</a><span class="k">def</span> <span class="nf">load_df_D_RCM</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the data table of the Rapid Chloride Migration(RCM) test</span>
<span class="sd">    for D_RCM interpolation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">        Data table from the RCM experiment.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wc_eqv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.60</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.05</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="mf">0.05</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;wc_eqv&quot;</span><span class="p">:</span> <span class="n">wc_eqv</span><span class="p">,</span>
        <span class="s2">&quot;CEM_I_42.5_R&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">15.8</span><span class="p">,</span> <span class="mf">17.9</span><span class="p">,</span> <span class="mf">25.0</span><span class="p">],</span>
        <span class="s2">&quot;CEM_I_42.5_R+FA&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">,</span> <span class="mf">10.9</span><span class="p">,</span> <span class="mf">14.9</span><span class="p">],</span>
        <span class="s2">&quot;CEM_I_42.5_R+SF&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.4</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">5.3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
        <span class="s2">&quot;CEM_III/B_42.5&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;wc_eqv&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="C_eqv_to_C_S_0"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.C_eqv_to_C_S_0">[docs]</a><span class="k">def</span> <span class="nf">C_eqv_to_C_S_0</span><span class="p">(</span><span class="n">C_eqv</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Convert aqueous solution chloride content to saturated chloride content in concrete</span>
<span class="sd">    interpolate function for 300kg cement w/c=0.5 OPC. Other empirical function should be used if available</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    C_eqv : float</span>
<span class="sd">            chloride content of the solution at the surface[g/L]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        saturated chloride content in concrete[wt-%/cement]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#  chloride content of the solution at the surface[g/L]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">,</span> <span class="mf">2.62</span><span class="p">,</span> <span class="mf">6.14</span><span class="p">,</span> <span class="mf">9.12</span><span class="p">,</span> <span class="mf">13.10</span><span class="p">,</span> <span class="mf">20.18</span><span class="p">,</span> <span class="mf">25.03</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">])</span>
    <span class="c1"># saturated chloride content in concrete[wt-%/cement]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.74</span><span class="p">,</span> <span class="mf">1.13</span><span class="p">,</span> <span class="mf">1.39</span><span class="p">,</span> <span class="mf">1.70</span><span class="p">,</span> <span class="mf">2.19</span><span class="p">,</span> <span class="mf">2.49</span><span class="p">,</span> <span class="mf">2.78</span><span class="p">])</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">C_eqv</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">():</span>
        <span class="n">C_S_0</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">C_eqv</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;warning: C_eqv_to_C_S_0 extrapolation used!&quot;</span><span class="p">)</span>
        <span class="n">C_S_0</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">interp_extrap_f</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">C_eqv</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">C_S_0</span></div>


<span class="c1"># C_S: chloride content at surface = C_S_dx when dx = 0</span>
<span class="c1"># C_S_dx: chloride content at subsurface</span>

<span class="c1"># Environmental param: Potential chloride impact C_eqv</span>
<div class="viewcode-block" id="C_eqv"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.C_eqv">[docs]</a><span class="k">def</span> <span class="nf">C_eqv</span><span class="p">(</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate equivalent chloride solution concentration, C_eqv[g/L] as a measurement of the Potential chloride impact</span>
<span class="sd">    from the source of </span>

<span class="sd">    1. marine or coastal and/or </span>
<span class="sd">    2. de icing salt </span>

<span class="sd">    It is later used to estimate the boundary condition C_S_dx of contineous exposure or non-geometry-sensitive intermittent exposure</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pars : instance of the param object</span>
<span class="sd">        a wrapper of all material and environmental parameters deep-copied from the raw data</span>
<span class="sd">        See Note for details</span>


<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">          C_eqv, equivalent chloride solution concentration [g/L]</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    1. marine or coastal</span>

<span class="sd">    pars.C_0_M : natural chloride content of sea water [g/l]</span>

<span class="sd">    2. de-icing salt</span>

<span class="sd">    pars.C_0_R : average chloride content of the chloride contaminated water [g/l]</span>
<span class="sd">    pars.n     : average number of salting events per year [-]</span>
<span class="sd">    pars.C_R_i : average amount of chloride spread within one spreading event [g/m2]</span>
<span class="sd">    pars.h_S_i : amount of water from rain and melted snow per spreading period [l/m2]</span>

<span class="sd">    C_eqv is used for continuous exposure or non-geometry-sensitive intermittent exposure.</span>
<span class="sd">    For geometry-sensitive conditions (roadside splash), the tested C_max() should be used.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">C_0_M</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_0_M</span>
    <span class="n">C_0_R</span> <span class="o">=</span> <span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">n</span> <span class="o">*</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_R_i</span><span class="p">)</span> <span class="o">/</span> <span class="n">pars</span><span class="o">.</span><span class="n">h_S_i</span>

    <span class="k">if</span> <span class="n">pars</span><span class="o">.</span><span class="n">marine</span><span class="p">:</span>
        <span class="n">C_eqv</span> <span class="o">=</span> <span class="n">C_0_M</span> <span class="o">+</span> <span class="n">C_0_R</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">C_eqv</span> <span class="o">=</span> <span class="n">C_0_R</span>

    <span class="k">return</span> <span class="n">C_eqv</span></div>


<span class="c1"># exposure condition</span>
<div class="viewcode-block" id="C_S_0"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.C_S_0">[docs]</a><span class="k">def</span> <span class="nf">C_S_0</span><span class="p">(</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return (surface) chloride saturation concentration C_S_0 [wt.-%/cement] caused by  C_eqv [g/l].</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pars.C_eqv : float</span>
<span class="sd">                 calculated with by C_eqv(pars) [g/L]</span>
<span class="sd">    pars.C_eqv_to_C_S_0 : global function</span>
<span class="sd">        This function is based experiment with the info of</span>

<span class="sd">        binder-specific chloride-adsorption-isotherms</span>
<span class="sd">        the concrete composition(cement/concrete ratio)</span>
<span class="sd">        potential chloride impact C_eqv [g/L]</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        chloride saturation concentration C_S_0 [wt.-%/cement]</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    The conversion function C_eqv_to_C_S_0(pars.C_eqv) is derived from experiment data of 300kg cement w/c=0.5 OPC. </span>
<span class="sd">    TODO: update to a conversion function dependent on the proportioning and cementitious material</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># -&gt; get the relationship</span>
    <span class="n">pars</span><span class="o">.</span><span class="n">C_eqv</span> <span class="o">=</span> <span class="n">C_eqv</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
    <span class="n">C_S_0</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_eqv_to_C_S_0</span><span class="p">(</span><span class="n">pars</span><span class="o">.</span><span class="n">C_eqv</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">C_S_0</span></div>


<span class="c1"># substitute chloride surface concentration</span>
<div class="viewcode-block" id="C_S_dx"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.C_S_dx">[docs]</a><span class="k">def</span> <span class="nf">C_S_dx</span><span class="p">(</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the substitute chloride surface concentration, i.e. chloride content just below the advection zone.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pars       : object/instance of param class</span>
<span class="sd">                 contains material and environment parameters</span>

<span class="sd">    pars.C_S_0 : float or numpy array</span>
<span class="sd">                chloride saturation concentration C_S_0 [wt.-%/cement]</span>
<span class="sd">                built-in calculation with C_S_0(pars)</span>
<span class="sd">    pars.C_max : float</span>
<span class="sd">                maximum content of chlorides within the chloride profile, [wt.-%/cement]</span>
<span class="sd">                built-in calculation with C_max(pars)</span>
<span class="sd">    pars.exposure_condition : string</span>
<span class="sd">                    continuous/intermittent exposure - &#39;submerged&#39;,&#39;leakage&#39;, &#39;spray&#39;, &#39;splash&#39;</span>

<span class="sd">    pars.exposure_condition_geom_sensitive : bool</span>
<span class="sd">                if True, the C_max is used instead of C_S_0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float or numpy arrays</span>
<span class="sd">          C_S_dx, the substitute chloride surface concentration [wt.-%/cement]</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Fick&#39;s 2nd law applies below the advection zone (depth=dx). No advection effect when dx = 0.</span>
<span class="sd">    Conditions considered: continuous/intermittent exposure - &#39;submerged&#39;, &#39;leakage&#39;, &#39;spray&#39;, &#39;splash&#39; where C_S_dx = C_S_0.</span>
<span class="sd">    The advection depth dx is calculated in the dx() function externally.</span>

<span class="sd">    If exposure_condition_geom_sensitive is True, the observed/empirical highest chloride content in concrete C_max is used.</span>
<span class="sd">    C_max is calculated by C_max().</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pars</span><span class="o">.</span><span class="n">C_S_0</span> <span class="o">=</span> <span class="n">C_S_0</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
    <span class="c1"># transfer functions considering geometry and exposure conditions</span>
    <span class="c1"># C_S_dx considered as time independent for simplification</span>
    <span class="k">if</span> <span class="n">pars</span><span class="o">.</span><span class="n">exposure_condition</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;submerged&quot;</span><span class="p">,</span> <span class="s2">&quot;leakage&quot;</span><span class="p">,</span> <span class="s2">&quot;spray&quot;</span><span class="p">]:</span>
        <span class="c1"># for continuous exposure, such as submerge: use transfer function dx=0</span>
        <span class="n">C_S_dx</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_S_0</span>  <span class="c1"># dx = 0, set in dx()</span>

    <span class="k">elif</span> <span class="n">pars</span><span class="o">.</span><span class="n">exposure_condition</span> <span class="o">==</span> <span class="s2">&quot;splash&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pars</span><span class="o">.</span><span class="n">exposure_condition_geom_sensitive</span><span class="p">:</span>
            <span class="c1"># geometry-sensitive road splash use C_max</span>
            <span class="n">pars</span><span class="o">.</span><span class="n">C_max</span> <span class="o">=</span> <span class="n">C_max</span><span class="p">(</span><span class="n">pars</span><span class="p">)</span>
            <span class="n">C_S_dx_mean</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_max</span>
            <span class="n">C_S_dx_std</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">C_S_dx_mean</span>
            <span class="n">C_S_dx</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">normal_custom</span><span class="p">(</span><span class="n">C_S_dx_mean</span><span class="p">,</span> <span class="n">C_S_dx_std</span><span class="p">,</span> <span class="n">non_negative</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># intermittent exposure, dx &gt;0, set in dx()</span>
            <span class="n">C_S_dx</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_S_0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">C_S_dx</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;C_S_dx calculation failed&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">C_S_dx</span></div>


<span class="c1"># Convection depth</span>
<div class="viewcode-block" id="dx"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.dx">[docs]</a><span class="k">def</span> <span class="nf">dx</span><span class="p">(</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return dx: advection depth [mm] dependent on the exposure conditions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pars : object/instance of param class</span>
<span class="sd">        Contains material and environment parameters.</span>

<span class="sd">    pars.exposure_condition : string</span>
<span class="sd">        Exposure condition - &#39;splash&#39;, &#39;submerged&#39;, &#39;leakage&#39;, &#39;spray&#39;.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        dx, advection depth [mm].</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    The advection depth dx is specific to each exposure condition.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    
    <span class="n">condition</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">exposure_condition</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">condition</span> <span class="o">==</span> <span class="s2">&quot;splash&quot;</span><span class="p">:</span>
        <span class="c1"># - for splash conditions (splash road environment, splash marine environment)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">beta_custom</span><span class="p">(</span><span class="mf">5.6</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">condition</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;submerged&quot;</span><span class="p">,</span> <span class="s2">&quot;leakage&quot;</span><span class="p">,</span> <span class="s2">&quot;spray&quot;</span><span class="p">]:</span>
        <span class="c1"># - for submerged marine structures</span>
        <span class="c1"># - for leakage due to seawater and constant ground water level</span>
        <span class="c1"># - for spray conditions(spray road environment, spray marine environment)</span>
        <span class="c1">#   a height of more than 1.50 m above the road (spray zone) no dx develops</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="n">condition</span> <span class="o">==</span> <span class="s2">&quot;other&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;To be determined&quot;</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">dx</span></div>


<span class="c1">#  Chloride surface content CS resp. substitute chloride surface content C_S_dx</span>
<div class="viewcode-block" id="C_max"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.C_max">[docs]</a><span class="k">def</span> <span class="nf">C_max</span><span class="p">(</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate C_max: maximum content of chlorides within the chloride profile [wt.-%/cement].</span>
<span class="sd">    It is calculated from empirical equations or from test data [wt.-%/concrete].</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pars : object/instance of param class</span>
<span class="sd">    Contains material and environment parameters.</span>

<span class="sd">    pars.cement_concrete_ratio : float</span>
<span class="sd">                      cement/concrete weight ratio, used to convert [wt.-%/concrete] -&gt; [wt.-%/cement]</span>

<span class="sd">    pars.C_max_option : string</span>
<span class="sd">        Option for determining C_max:</span>
<span class="sd">        - &quot;empirical&quot; - use empirical equation.</span>
<span class="sd">        - &quot;user_input&quot; - use user input from test.</span>

<span class="sd">    pars.x_a : float</span>
<span class="sd">        &quot;empirical&quot; option: horizontal distance from the roadside [cm]</span>

<span class="sd">    pars.x_h : float</span>
<span class="sd">        &quot;empirical&quot; option: height above road surface [cm]</span>

<span class="sd">    pars.C_max_user_input : float</span>
<span class="sd">        &quot;user_input&quot; option: Experiment-tested maximum chloride content [wt.-%/concrete]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        C_max, maximum content of chlorides within the chloride profile, [wt.-%/cement]</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    The empirical expression should be determined for structures of different exposure or concrete mix.</span>
<span class="sd">    A typical C_max used by default in this function is from</span>

<span class="sd">    + location: urban and rural areas in Germany</span>
<span class="sd">    + time of exposure of the considered structure: 5-40 years</span>
<span class="sd">    + concrete: CEM I, w/c = 0.45 up to w/c = 0.60,</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">C_max_temp</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_max_option</span> <span class="o">==</span> <span class="s2">&quot;empirical&quot;</span><span class="p">:</span>
        <span class="c1"># empirical eq should be determined for structures of different exposure or concrete mixes????????</span>
        <span class="c1"># A typical C_max</span>
        <span class="c1"># – location: urban and rural areas in Germany</span>
        <span class="c1"># – time of exposure of the considered structure: 5-40 years</span>
        <span class="c1"># – concrete: CEM I, w/c = 0.45 up to w/c = 0.60,</span>
        <span class="n">x_a</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">x_a</span>
        <span class="n">x_h</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">x_h</span>
        <span class="n">C_max_temp</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">0.465</span> <span class="o">-</span> <span class="mf">0.051</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x_a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.00065</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="o">-</span><span class="mf">0.187</span><span class="p">)</span> <span class="o">*</span> <span class="n">x_h</span>
        <span class="p">)</span>  <span class="c1"># wt.%/concrete</span>

    <span class="k">if</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_max_option</span> <span class="o">==</span> <span class="s2">&quot;user_input&quot;</span><span class="p">:</span>
        <span class="n">C_max_temp</span> <span class="o">=</span> <span class="n">pars</span><span class="o">.</span><span class="n">C_max_user_input</span>  <span class="c1"># wt-% concrete</span>

    <span class="c1"># wt.%/concrete -&gt; wt.%cement</span>
    <span class="n">C_max_final</span> <span class="o">=</span> <span class="n">C_max_temp</span> <span class="o">/</span> <span class="n">pars</span><span class="o">.</span><span class="n">cement_concrete_ratio</span>
    <span class="k">return</span> <span class="n">C_max_final</span></div>


<span class="c1"># critical chloride content</span>
<div class="viewcode-block" id="C_crit_param"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.C_crit_param">[docs]</a><span class="k">def</span> <span class="nf">C_crit_param</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return the beta distribution parameters for the critical chloride content(total chloride), C_crit [wt.-%/cement]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">         parameters of general beta distribution (mean, std, lower_bound, upper_bound)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">C_crit_param</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">C_crit_param</span></div>


<span class="c1"># calibration function</span>
<div class="viewcode-block" id="calibrate_chloride_f"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.calibrate_chloride_f">[docs]</a><span class="k">def</span> <span class="nf">calibrate_chloride_f</span><span class="p">(</span>
    <span class="n">model_raw</span><span class="p">,</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">t</span><span class="p">,</span>
    <span class="n">chloride_content</span><span class="p">,</span>
    <span class="n">tol</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span>
    <span class="n">max_count</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">print_out</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">print_proc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calibrate the chloride model with field chloride test data (at one depth and at one time) and return the new calibrated model object/instance</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model_raw : object/instance of Chloride_model class (to be calibrated)</span>
<span class="sd">    x         : float</span>
<span class="sd">                depth [mm]</span>
<span class="sd">    t:        : int or float</span>
<span class="sd">                time [year]</span>
<span class="sd">    chloride_content : float or int</span>
<span class="sd">                       field chloride_content[wt.-%/cement] at time t, depth x,</span>

<span class="sd">    tol: float</span>
<span class="sd">         D_RCM_0 optimization absolute tolerance 1e-15 [m^2/s]</span>

<span class="sd">    max_count : int</span>
<span class="sd">                maximum number of searching iteration, default is 50</span>
<span class="sd">    print_out : bool</span>
<span class="sd">                if true, print model and field chloride content</span>
<span class="sd">    print_proc: bool</span>
<span class="sd">                if turn, print optimization process. (debug message in the logger)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    instance of Chloride_Model object</span>
<span class="sd">          new calibrated model</span>

<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Optimization method:  Field chloride content at depth x and time t -&gt; find corresponding D_RCM_test </span>
<span class="sd">    and then update D_RCM_0(repaid chloride migration diffusivity[m^2/s]) in the model.run()</span>

<span class="sd">    calibrate model to field data at three depths in calibrate_chloride_f_group()</span>
<span class="sd">    chloride_content_field[wt.-%/cement] at time t</span>

<span class="sd">        + optimizing corresponding D_RCM_test,</span>
<span class="sd">        + fixed C_S_dx (exposure type dependent)</span>
<span class="sd">        + fixed dx (determined by the original model)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">model_raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># target chloride content at depth x</span>
    <span class="n">cl</span> <span class="o">=</span> <span class="n">chloride_content</span>

    <span class="c1"># DCM test</span>
    <span class="c1"># cap</span>
    <span class="n">D_RCM_test_min</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># [m/s] unrealistically large safe ceiling corresponding to a D_RCM_0= [94] [mm/year]</span>
    <span class="n">D_RCM_test_max</span> <span class="o">=</span> <span class="mf">3e-12</span>

    <span class="c1"># optimization</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">D_RCM_test_max</span> <span class="o">-</span> <span class="n">D_RCM_test_min</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
        <span class="c1"># update guess</span>
        <span class="n">D_RCM_test_guess</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">D_RCM_test_min</span> <span class="o">+</span> <span class="n">D_RCM_test_max</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">D_RCM_test</span> <span class="o">=</span> <span class="n">D_RCM_test_guess</span>
        <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">chloride_mean</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">get_mean</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">C_x_t</span><span class="p">)</span>

        <span class="c1"># compare</span>
        <span class="k">if</span> <span class="n">chloride_mean</span> <span class="o">&lt;</span> <span class="n">cl</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
            <span class="c1"># narrow the cap</span>
            <span class="n">D_RCM_test_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">D_RCM_test_guess</span><span class="p">,</span> <span class="n">D_RCM_test_min</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">D_RCM_test_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">D_RCM_test_guess</span><span class="p">,</span> <span class="n">D_RCM_test_max</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">print_proc</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;chloride_mean&quot;</span><span class="p">,</span> <span class="n">chloride_mean</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;D_RCM_test&quot;</span><span class="p">,</span> <span class="n">D_RCM_test_guess</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cap&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">D_RCM_test_min</span><span class="p">,</span> <span class="n">D_RCM_test_max</span><span class="p">))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">max_count</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;iteration exceeded max number of iteration: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">))</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">print_out</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;chloride_content:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;model: </span><span class="se">\n</span><span class="s2">mean:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">std:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">mh</span><span class="o">.</span><span class="n">get_mean</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">C_x_t</span><span class="p">),</span> <span class="n">mh</span><span class="o">.</span><span class="n">get_std</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">C_x_t</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;field: </span><span class="se">\n</span><span class="s2">mean:</span><span class="si">{}</span><span class="se">\n</span><span class="s2">std:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cl</span><span class="o">.</span><span class="n">std</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">model</span>  <span class="c1"># new calibrated obj</span></div>


<div class="viewcode-block" id="calibrate_chloride_f_group"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.calibrate_chloride_f_group">[docs]</a><span class="k">def</span> <span class="nf">calibrate_chloride_f_group</span><span class="p">(</span>
    <span class="n">model_raw</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">chloride_content_field</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_proc</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use calibrate_chloride_f() to calibrate model to field chloride content at three or more depths, and return the new calibrated model with the averaged D_RCM_0</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model_raw : object/instance of Chloride_Model class </span>
<span class="sd">                model object to be calibrated), model_raw.copy() will be used</span>
<span class="sd">    chloride_content_field: pandas.DataFrame</span>
<span class="sd">                contains field chloride contents at various depths [wt.-%/cement]</span>
<span class="sd">    t: int or float</span>
<span class="sd">        time [year]</span>

<span class="sd">    returns</span>
<span class="sd">    -------</span>
<span class="sd">    object/instance of Chloride_model class</span>
<span class="sd">        a new calibrated model with the averaged calibrated D_RCM_test, and corresponding D_RCM_0 normal distribution array. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">M_cal_lis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">M_cal_new</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chloride_content_field</span><span class="p">)):</span>
        <span class="n">M_cal</span> <span class="o">=</span> <span class="n">calibrate_chloride_f</span><span class="p">(</span>
            <span class="n">model_raw</span><span class="p">,</span>
            <span class="n">chloride_content_field</span><span class="o">.</span><span class="n">depth</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">t</span><span class="p">,</span>
            <span class="n">chloride_content_field</span><span class="o">.</span><span class="n">cl</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">print_proc</span><span class="o">=</span><span class="n">print_proc</span><span class="p">,</span>
            <span class="n">print_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">M_cal_lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_cal</span><span class="p">)</span>  <span class="c1"># M_cal is a new obj</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">M_cal</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">D_RCM_test</span><span class="p">)</span>

        <span class="n">M_cal_new</span> <span class="o">=</span> <span class="n">model_raw</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">M_cal_new</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">D_RCM_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">M_cal</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">D_RCM_test</span> <span class="k">for</span> <span class="n">M_cal</span> <span class="ow">in</span> <span class="n">M_cal_lis</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="c1"># update the corresponding pars.D_RCM_0 and pars.D_app in the M_cal_new</span>
        <span class="n">M_cal_new</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">D_app</span> <span class="o">=</span> <span class="n">D_app</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">M_cal_new</span><span class="o">.</span><span class="n">pars</span><span class="p">)</span> 

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">Cl_model</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">mh</span><span class="o">.</span><span class="n">get_mean</span><span class="p">(</span><span class="n">M_cal_new</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="n">chloride_content_field</span><span class="o">.</span><span class="n">depth</span>
        <span class="p">]</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">chloride_content_field</span><span class="p">[</span><span class="s2">&quot;depth&quot;</span><span class="p">],</span>
            <span class="n">chloride_content_field</span><span class="p">[</span><span class="s2">&quot;cl&quot;</span><span class="p">],</span>
            <span class="s2">&quot;--.&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;field&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">chloride_content_field</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="n">Cl_model</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;calibrated&quot;</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">M_cal_new</span></div>


<div class="viewcode-block" id="chloride_year"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.chloride_year">[docs]</a><span class="k">def</span> <span class="nf">chloride_year</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">year_lis</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">amplify</span><span class="o">=</span><span class="mi">80</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run the model over a list of time steps.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model : instance of ChlorideModel class</span>
<span class="sd">        The chloride model to run.</span>
<span class="sd">    depth : float</span>
<span class="sd">        Depth [mm].</span>
<span class="sd">    year_list : list of int or float</span>
<span class="sd">        List of time steps [years].</span>
<span class="sd">    plot : bool, optional</span>
<span class="sd">        If True, plot the results, by default True.</span>
<span class="sd">    amplify : float, optional</span>
<span class="sd">        Amplification factor for the plot, by default 80.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        Probability of failure (Pf) for each time step.</span>
<span class="sd">    list</span>
<span class="sd">        Reliability factor (beta) for each time step.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t_lis</span> <span class="o">=</span> <span class="n">year_lis</span>
    <span class="n">M_cal</span> <span class="o">=</span> <span class="n">model</span>

    <span class="n">M_lis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">t_lis</span><span class="p">:</span>
        <span class="n">M_cal</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">M_cal</span><span class="o">.</span><span class="n">postproc</span><span class="p">()</span>
        <span class="n">M_lis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_cal</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">[</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;height_ratios&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]},</span>
        <span class="p">)</span>
        <span class="c1"># plot a few distribution</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_lis</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_lis</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)[</span>
            <span class="mi">1</span><span class="p">:</span>
        <span class="p">]</span>
        <span class="n">M_sel</span> <span class="o">=</span> <span class="p">[</span><span class="n">M_lis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indx</span><span class="p">]</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">this_M</span><span class="o">.</span><span class="n">t</span> <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_lis</span><span class="p">],</span> <span class="p">[</span><span class="n">this_M</span><span class="o">.</span><span class="n">pf</span> <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_lis</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">this_M</span><span class="o">.</span><span class="n">t</span> <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_sel</span><span class="p">],</span>
            <span class="p">[</span><span class="n">this_M</span><span class="o">.</span><span class="n">pf</span> <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_sel</span><span class="p">],</span>
            <span class="s2">&quot;k|&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of failure $P_f$&quot;</span><span class="p">)</span>

        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">this_M</span><span class="o">.</span><span class="n">t</span> <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_lis</span><span class="p">],</span>
            <span class="p">[</span><span class="n">this_M</span><span class="o">.</span><span class="n">beta_factor</span> <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_lis</span><span class="p">],</span>
            <span class="s2">&quot;k--&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">this_M</span><span class="o">.</span><span class="n">t</span> <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_sel</span><span class="p">],</span>
            <span class="p">[</span><span class="n">this_M</span><span class="o">.</span><span class="n">beta_factor</span> <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_sel</span><span class="p">],</span>
            <span class="s2">&quot;k|&quot;</span><span class="p">,</span>
            <span class="n">markersize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Reliability factor $\beta$&quot;</span><span class="p">)</span>

        <span class="c1"># plot mean results</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_lis</span><span class="p">,</span> <span class="p">[</span><span class="n">M</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">C_crit_distrib_param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="n">M_lis</span><span class="p">],</span> <span class="s2">&quot;--C0&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t_lis</span><span class="p">,</span> <span class="p">[</span><span class="n">mh</span><span class="o">.</span><span class="n">get_mean</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">C_x_t</span><span class="p">)</span> <span class="k">for</span> <span class="n">M</span> <span class="ow">in</span> <span class="n">M_lis</span><span class="p">],</span> <span class="s2">&quot;--C1&quot;</span><span class="p">)</span>
        <span class="c1"># plot distribution</span>
        <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_sel</span><span class="p">:</span>
            <span class="n">mh</span><span class="o">.</span><span class="n">plot_RS</span><span class="p">(</span><span class="n">this_M</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span> <span class="n">t_offset</span><span class="o">=</span><span class="n">this_M</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">amplify</span><span class="o">=</span><span class="n">amplify</span><span class="p">)</span>

        <span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>

        <span class="n">R_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;R: critical chloride content&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span>
        <span class="p">)</span>
        <span class="n">S_patch</span> <span class="o">=</span> <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;S: chloride content at rebar depth&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span>
        <span class="p">)</span>

        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time[year]&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Chloride content[wt-</span><span class="si">% c</span><span class="s2">ement]&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">R_patch</span><span class="p">,</span> <span class="n">S_patch</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">this_M</span><span class="o">.</span><span class="n">pf</span> <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_lis</span><span class="p">],</span> <span class="p">[</span><span class="n">this_M</span><span class="o">.</span><span class="n">beta_factor</span> <span class="k">for</span> <span class="n">this_M</span> <span class="ow">in</span> <span class="n">M_lis</span><span class="p">]</span></div>


<div class="viewcode-block" id="ChlorideModel"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.ChlorideModel">[docs]</a><span class="k">class</span> <span class="nc">ChlorideModel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pars_raw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the model object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pars_raw : Param object</span>
<span class="sd">            Material and environment parameters.</span>
<span class="sd">            A deep copy of `pars_raw` is attached and then updated with derived parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pars</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">pars_raw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">C_S_dx</span> <span class="o">=</span> <span class="n">C_S_dx</span><span class="p">(</span><span class="n">pars_raw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span><span class="p">(</span><span class="n">pars_raw</span><span class="p">)</span>

<div class="viewcode-block" id="ChlorideModel.run"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.ChlorideModel.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; solve the chloride content at depth x and time t</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : int, float</span>
<span class="sd">            Depth x[mm]</span>
<span class="sd">        t : float</span>
<span class="sd">            Time[year]</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy array</span>
<span class="sd">            Chloride content at depth x and time t.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C_x_t</span> <span class="o">=</span> <span class="n">chloride_content</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_x_t</span></div>

<div class="viewcode-block" id="ChlorideModel.postproc"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.ChlorideModel.postproc">[docs]</a>    <span class="k">def</span> <span class="nf">postproc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Postprocess the solved model and attach Pf and beta to the model object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        plot : bool, optional</span>
<span class="sd">            If True, plot the R-S curve, by default False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="n">mh</span><span class="o">.</span><span class="n">pf_RS</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pars</span><span class="o">.</span><span class="n">C_crit_distrib_param</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_x_t</span><span class="p">,</span> <span class="n">R_distrib_type</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pf</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta_factor</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R_distrib</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S_kde_fit</span> <span class="o">=</span> <span class="n">sol</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C_x_t</span></div>

<div class="viewcode-block" id="ChlorideModel.calibrate"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.ChlorideModel.calibrate">[docs]</a>    <span class="k">def</span> <span class="nf">calibrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">chloride_content_field</span><span class="p">,</span> <span class="n">print_proc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a calibrated model with `calibrate_chloride_f_group()` function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        t : int or float</span>
<span class="sd">            Time [year].</span>
<span class="sd">        chloride_content_field : pandas DataFrame</span>
<span class="sd">            Field chloride contents at various depths [wt.-%/cement].</span>
<span class="sd">        print_proc : bool, optional</span>
<span class="sd">            If True, print the optimization process, by default False.</span>
<span class="sd">        plot : bool, optional</span>
<span class="sd">            If True, plot the field vs model comparison, by default True.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ChlorideModel</span>
<span class="sd">            A new calibrated model with the averaged calibrated D_RCM_0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_cal</span> <span class="o">=</span> <span class="n">calibrate_chloride_f_group</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">chloride_content_field</span><span class="p">,</span> <span class="n">print_proc</span><span class="o">=</span><span class="n">print_proc</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">model_cal</span></div>

<div class="viewcode-block" id="ChlorideModel.copy"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.ChlorideModel.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;create a deepcopy of the instance, to preserve the mutable object             </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="ChlorideModel.chloride_with_year"><a class="viewcode-back" href="../api/modules/chloride.html#chloride.ChlorideModel.chloride_with_year">[docs]</a>    <span class="k">def</span> <span class="nf">chloride_with_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">year_lis</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">amplify</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the model for a list of time steps.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        depth : float</span>
<span class="sd">            Depth at which the chloride concrete is calculated, x [mm].</span>
<span class="sd">        year_list : list of int or float</span>
<span class="sd">            A list of time steps [year].</span>
<span class="sd">        plot : bool, optional</span>
<span class="sd">            If True, plot the R-S curve, pf, beta with time axis, by default True.</span>
<span class="sd">        amplify : int, optional</span>
<span class="sd">            A scale parameter adjusting the height of the distribution curve, by default 1.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        numpy array</span>
<span class="sd">            Probability of failure (Pf) for each time step.</span>
<span class="sd">        numpy array</span>
<span class="sd">            Reliability factor (beta) for each time step.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pf_lis</span><span class="p">,</span> <span class="n">beta_lis</span> <span class="o">=</span> <span class="n">chloride_year</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">year_lis</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">amplify</span><span class="o">=</span><span class="n">amplify</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pf_lis</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beta_lis</span><span class="p">)</span></div></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Gang Li.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>