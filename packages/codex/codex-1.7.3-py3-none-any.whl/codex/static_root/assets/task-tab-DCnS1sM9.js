import{_ as f,E as v,B as p,A as _,k,n as s,q as i,z as o,F as l,y as n,l as e,x as b,v as d,w as y,s as g}from"./main-DCaPxp2h.js";import{C}from"./confirm-dialog-B_Y3KKiL.js";import{useAdminStore as x}from"./admin-CHuFhx_t.js";import{V as R}from"./forwardRefs-D1ZDjzWx.js";import"./VDialog-CQXjBvDZ.js";const S=[{title:"Libraries",tasks:[{value:"poll",title:"Poll All Libraries",desc:"Update Libraries if changes detected"},{value:"poll_force",title:"Force Update All Libraries",desc:"Forcibly update all comics in all libraries",confirm:"This can take a long time"},{value:"force_update_all_failed_imports",title:"Update All Failed Imports",desc:"Forcibly update all failed imports in all libraries",confirm:"This can take a long time"},{value:"watchdog_sync",title:"Sync Watchdog with DB",desc:"Ensure the Watchdog file watcher is enabled per database preferences for each library"}]},{title:"Covers",tasks:[{value:"purge_comic_covers",title:"Remove Comic Covers",desc:"from every library",confirm:"Are you sure?"},{value:"create_all_comic_covers",title:"Create All Comic Covers",desc:"Pre-generate covers for every comic in every library and all custom covers",confirm:"Are you sure?"},{value:"force_update_groups",title:"Update Group Timestamps",desc:"Force the update of group timestamps. Will bust the browser cache for browser views and covers."}]},{title:"Search Index",tasks:[{value:"search_index_update",title:"Update Search Index",desc:"with recently changed comics"},{value:"search_index_optimize",title:"Optimize Search Index",desc:"Merge Search Index for optimal lookup time. Runs nightly."},{value:"search_index_rebuild",title:"Rebuild Search Index",desc:"Delete and rebuild the search index from scratch",confirm:"This can take a long time"},{value:"search_index_remove_stale",title:"Remove Stale Index Entries",desc:"Remove search index entries that are no longer in the library."},{value:"search_index_abort",title:"Abort Search Indexing",desc:"Aborts search index update and remove tasks."},{value:"search_index_clear",title:"Clear Search Index",desc:"of all entries"},{value:"db_fts_integrity_check",title:"Integrity Check Search Index",desc:"Repairs Search Index on failure. Runs nightly"},{value:"db_fts_rebuild",title:"Repair Search Index",desc:"Probably faster than Rebuild if integrity check fails."}]},{title:"Database",tasks:[{value:"db_vacuum",title:"Optimize & Compact Database",desc:"Run the sqlite3 OPTIMIZE and VACUUM pragmas. Runs nightly"},{value:"db_backup",title:"Backup Database",desc:"Runs nightly"},{value:"db_foreign_key_check",title:"Remove Illegal Foreign Keys",desc:"Check for and remove illegal foreign keys. Mark affected comics for update. Runs nightly."},{value:"db_integrity_check",title:"Check Database Integrity",desc:"Check logs for results. Runs nightly.",confirm:"Can take a while on large databases, Are you sure?"}]},{title:"Codex Software",tasks:[{value:"codex_latest_version",title:"Check for Codex Latest Version",desc:"Check PyPi for the latest version of Codex"},{value:"codex_update",title:"Update Codex",desc:"If Codex updates to a new version, it will restart",confirm:"Are you sure?"},{value:"codex_restart",title:"Restart Codex Server",desc:"Immediately",confirm:"Are you sure?"},{value:"codex_shutdown",title:"Shutdown Codex Server",desc:"Immediately",confirm:"Are you sure?"}]},{title:"Notify",tasks:[{value:"notify_library_changed",title:"Notify Library Changed ",desc:"Signal all clients that the libraries have changed and the browser should fetch new data."},{value:"notify_librarian_status",title:"Notify Librarian Status",desc:"Signal Admin clients to fetch librarian status."}]},{title:"Cleanup",tasks:[{value:"cleanup_fks",title:"Remove Orphan Tags",desc:"After deleting comics, unused linked objects remain in case new comics use them. Runs nightly."},{value:"cleanup_db_custom_covers",title:"Remove Orphan Database Custom Covers",desc:"Remove Custom Covers from the db that no longer represent custom cover images on disk. Runs nightly."},{value:"cleanup_sessions",title:"Cleanup Sessions",desc:"Remove corrupt and expired sessions. Runs nightly."},{value:"cleanup_covers",title:"Remove Orphan Cover Thumbnails",desc:"no longer have source comics or custom images. Runs nightly."},{value:"cleanup_bookmarks",title:"Remove Orphan Bookmarks",desc:"Owned by no session or user. Runs nightly."},{value:"adopt_folders",title:"Adopt Orphan Folders",desc:"Move orphaned folders from the top of the folder tree to under their correct parent. Runs nightly and at startup."},{value:"librarian_clear_status",title:"Clear Librarian Statuses",desc:"Mark all Librarian tasks finished."},{value:"janitor_nightly",title:"Run Nightly Maintenance",desc:"Runs several tasks above that also run nightly.",confirm:"Launches several tasks that run nightly anyway."}]}],w={name:"AdminTasksTab",components:{ConfirmDialog:C},data(){return{tasks:S}},computed:{...v(p,{formSuccess:t=>t.form.success,formErrors:t=>t.form.errors})},methods:{..._(x,["librarianTask"])}},I={id:"tasks"},A={key:0,id:"success"},T={key:1,id:"error"},L={key:2,id:"noRecentTask"},D={class:"taskBox"},B={class:"taskDesc"};function E(t,c,F,O,u,U){const h=k("ConfirmDialog");return e(),s("div",I,[i("div",null,[c[0]||(c[0]=i("span",{id:"lastTaskLabel"},"Last Task Queued:",-1)),i("span",null,[t.formSuccess?(e(),s("span",A,o(t.formSuccess),1)):t.formErrors&&t.formErrors.length>0?(e(),s("span",T,[(e(!0),s(l,null,n(t.formErrors,r=>(e(),s("span",{key:r},o(r),1))),128))])):(e(),s("span",L,"No recent task"))])]),(e(!0),s(l,null,n(u.tasks,r=>(e(),s("div",{key:r.title,"fixed-header":"",class:"taskGroup"},[i("h3",null,o(r.title),1),(e(!0),s(l,null,n(r.tasks,a=>(e(),s("div",{key:a.value,class:b(["trow",{selected:!1}])},[i("div",D,[a.confirm?(e(),d(h,{key:0,"button-text":a.title,"title-text":a.title,text:a.confirm,block:!0,"confirm-text":"Confirm",onConfirm:m=>t.librarianTask(a.value,a.title)},null,8,["button-text","title-text","text","onConfirm"])):(e(),d(R,{key:1,block:"",onClick:m=>t.librarianTask(a.value,a.title)},{default:y(()=>[g(o(a.title),1)]),_:2},1032,["onClick"])),i("div",B,o(a.desc),1)])]))),128))]))),128))])}const $=f(w,[["render",E],["__scopeId","data-v-c5281d1b"]]);export{$ as default};
