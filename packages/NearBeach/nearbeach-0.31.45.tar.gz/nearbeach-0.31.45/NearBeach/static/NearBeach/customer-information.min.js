"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[814],{7529:(e,t,s)=>{s.r(t),s.d(t,{default:()=>P});var r=s(641),o=s(3751);const a={class:"card"},i={class:"card-body"},l=["href"],n={class:"row"},u={class:"col-md-8"},c={class:"row customer-profile-image"},d=["src"],m={class:"row"},h={class:"form-group col-sm-3"},p={class:"form-group col-sm-4"},g=["disabled"],f={class:"form-group col-sm-5"},k=["disabled"],v={key:1,class:"mt-4"},L={key:2,class:"row submit-row"},A={class:"col-md-12"};var b=s(2601),_=s(1080),y=s(2819),I=s(3388),$=s(9639),w=s(3855),M=s(404),S=s(9827),U=s(4247);const N={name:"CustomerInformation",setup:()=>({v$:(0,$.Ay)()}),components:{NButton:b.Ay,NSelect:_.A,NUpload:y.A,StakeholderInformation:I.A,ValidationRendering:M.A},props:{customerResults:{type:Array,default:()=>[]},defaultStakeholderImage:{type:String,default:""},organisationResults:{type:Array,default:()=>[]},rootUrl:{type:String,default:"/"},staticUrl:{type:String,default:"/"},theme:{type:String,default:""},titleList:{type:Array,default:()=>[]},userLevel:{type:Number,default:0}},data(){return{customerEmailModel:this.customerResults[0].fields.customer_email,customerFirstNameModel:this.customerResults[0].fields.customer_first_name,customerLastNameModel:this.customerResults[0].fields.customer_last_name,customerTitleModel:this.customerResults[0].fields.customer_title,profilePicture:`${this.staticUrl}/NearBeach/images/placeholder/product_tour.svg`,titleFixList:[]}},mixins:[S.A,U.A],validations:{customerEmailModel:{required:w.mw,email:w.Rp},customerFirstNameModel:{required:w.mw},customerLastNameModel:{required:w.mw},customerTitleModel:{required:w.mw}},methods:{showErrorToast(){this.$store.dispatch("newToast",{header:"Error uploading profile picture",message:"Sorry, we had an issue uploading the profile image.",extra_classes:"bg-danger",delay:0})},setProfilePicture(){const e=this.customerResults[0].fields.customer_profile_picture;this.profilePicture=null!=e&&""!==e?`/private${this.rootUrl}${this.customerResults[0].fields.customer_profile_picture}`:`${this.staticUrl}/NearBeach/images/placeholder/product_tour.svg`},async updateCustomer(){if(!await this.v$.$validate()||this.displayGroupPermissionIssue)return void this.$store.dispatch("newToast",{header:"Please correct issues",message:"Not all fields are correctly validated. Please correct.",extra_classes:"bg-danger"});const e=new FormData;e.set("customer_email",this.customerEmailModel),e.set("customer_first_name",this.customerFirstNameModel),e.set("customer_last_name",this.customerLastNameModel),e.set("customer_title",this.customerTitleModel),this.$store.dispatch("newToast",{header:"Updating Customer",message:"Please wait whilst we update customer",extra_classes:"bg-warning text-dark",delay:0,unique_type:"save"}),this.axios.post(`${this.rootUrl}customer_information/${this.customerResults[0].pk}/save/`,e).then((()=>{this.$store.dispatch("newToast",{header:"Customer Updated",message:"The Customer has updated",extra_classes:"bg-success",unique_type:"save"}),this.updateProfilePicture()})).catch((e=>{this.$store.dispatch("newToast",{header:"Failed to Update Customer",message:`Sorry. We have encounted an error. Error -> ${e}`,extra_classes:"bg-danger",delay:0,unique_type:"save"})}))},updateProfilePicture(){this.axios.post(`${this.rootUrl}customer_information/${this.customerResults[0].pk}/get_profile_picture/`,{}).then((e=>{this.profilePicture=e.data})).catch((()=>{this.profilePicture=`${this.staticUrl}/NearBeach/images/placeholder/product_tour.svg`}))}},mounted(){this.$store.commit({type:"updateUrl",rootUrl:this.rootUrl,staticUrl:this.staticUrl}),this.$store.commit({type:"updateDestination",destination:"customer",locationId:this.customerResults[0].pk}),this.titleFixList=this.titleList.map((e=>({value:e.pk,label:e.fields.title}))),this.setProfilePicture()}},P=(0,s(6262).A)(N,[["render",function(e,t,s,b,_,y){const I=(0,r.g2)("n-button"),$=(0,r.g2)("n-upload"),w=(0,r.g2)("validation-rendering"),M=(0,r.g2)("n-select"),S=(0,r.g2)("stakeholder-information"),U=(0,r.g2)("n-config-provider");return(0,r.uX)(),(0,r.Wv)(U,{theme:e.getTheme(s.theme)},{default:(0,r.k6)((()=>[(0,r.Lk)("div",a,[(0,r.Lk)("div",i,[(0,r.Q3)(" TITLE "),t[10]||(t[10]=(0,r.Lk)("h1",{class:"mb-4"},"Customer Information",-1)),(0,r.Lk)("a",{href:`${s.rootUrl}search/customer/`},"Go back to customer search",8,l),t[11]||(t[11]=(0,r.Lk)("hr",null,null,-1)),(0,r.Q3)(" FIELDS SECTION "),(0,r.Lk)("div",n,[t[9]||(t[9]=(0,r.Lk)("div",{class:"col-md-4"},[(0,r.Lk)("strong",null,"Please Note"),(0,r.Lk)("p",{class:"text-instructions"}," Please fill out the following details. If the customer is not assigned an organisation, NearBeach will treat this customer as a freelancer. ")],-1)),(0,r.Lk)("div",u,[(0,r.Lk)("div",c,[(0,r.Q3)(" PROFILE IMAGE "),(0,r.Lk)("img",{src:_.profilePicture,alt:"User Profile Picture",class:"customer-profile-image"},null,8,d),s.userLevel>1?((0,r.uX)(),(0,r.Wv)($,{key:0,action:`${s.rootUrl}customer_information/${s.customerResults[0].pk}/update_profile/`,headers:{"X-CSRFTOKEN":e.getToken("csrftoken")},data:{},onFinish:y.updateProfilePicture,onError:y.showErrorToast},{default:(0,r.k6)((()=>[(0,r.bF)(I,null,{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)("Update Profile Picture")]))),_:1})])),_:1},8,["action","headers","onFinish","onError"])):(0,r.Q3)("v-if",!0)]),t[8]||(t[8]=(0,r.Lk)("div",{class:"spacer-extra"},null,-1)),(0,r.Q3)(" CUSTOMER INFORMATION "),(0,r.Lk)("div",m,[(0,r.Lk)("div",h,[(0,r.Lk)("label",null,[t[5]||(t[5]=(0,r.eW)(" Title: ")),(0,r.bF)(w,{"error-list":b.v$.customerTitleModel.$errors},null,8,["error-list"])]),(0,r.bF)(M,{options:_.titleFixList,disabled:s.userLevel<=1,value:_.customerTitleModel,"onUpdate:value":t[0]||(t[0]=e=>_.customerTitleModel=e)},null,8,["options","disabled","value"])]),(0,r.Lk)("div",p,[(0,r.Lk)("label",null,[t[6]||(t[6]=(0,r.eW)(" First Name: ")),(0,r.bF)(w,{"error-list":b.v$.customerFirstNameModel.$errors},null,8,["error-list"])]),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=e=>_.customerFirstNameModel=e),disabled:s.userLevel<=1},null,8,g),[[o.vModelText,_.customerFirstNameModel]])]),(0,r.Lk)("div",f,[(0,r.Lk)("label",null,[t[7]||(t[7]=(0,r.eW)(" Last Name: ")),(0,r.bF)(w,{"error-list":b.v$.customerLastNameModel.$errors},null,8,["error-list"])]),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=e=>_.customerLastNameModel=e),disabled:s.userLevel<=1},null,8,k),[[o.vModelText,_.customerLastNameModel]])])])])]),(0,r.Q3)(" STAKEHOLDER ORGANISATION "),t[12]||(t[12]=(0,r.Lk)("hr",null,null,-1)),s.organisationResults.length>0?((0,r.uX)(),(0,r.Wv)(S,{key:0,"organisation-results":s.organisationResults,"default-stakeholder-image":s.defaultStakeholderImage},null,8,["organisation-results","default-stakeholder-image"])):(0,r.Q3)("v-if",!0),(0,r.Q3)(" NEED TO APPLY PERMISSIONS "),(0,r.Q3)(" Submit Button "),s.userLevel>1?((0,r.uX)(),(0,r.CE)("hr",v)):(0,r.Q3)("v-if",!0),s.userLevel>1?((0,r.uX)(),(0,r.CE)("div",L,[(0,r.Lk)("div",A,[(0,r.Lk)("a",{href:"javascript:void(0)",class:"btn btn-primary save-changes",onClick:t[3]||(t[3]=(...e)=>y.updateCustomer&&y.updateCustomer(...e))},"Update Customer")])])):(0,r.Q3)("v-if",!0)])])])),_:1},8,["theme"])}]])},3388:(e,t,s)=>{s.d(t,{A:()=>v});var r=s(641),o=s(33);const a={class:"row"},i={class:"col-md-8 organisation-details"},l=["src"],n={class:"organisation-name"},u=["href"],c={class:"organisation-link"},d=["href"],m={class:"organisation-email"},h=["href"];var p=s(2321),g=s(2243),f=s(2124);const k={name:"StakeholderInformation",components:{Icon:p.In},props:{defaultStakeholderImage:{type:String,default:""},organisationResults:{type:Array,default:()=>[]}},data(){return{stakeholderModel:this.organisationResults[0].fields}},mixins:[g.A],computed:{...(0,f.L8)({rootUrl:"getRootUrl",staticUrl:"getStaticUrl"}),getStakeholderImage(){const e=this.stakeholderModel.organisation_profile_picture;return""===e||null===e?this.defaultStakeholderImage:`${this.rootUrl}private/${e}`}}},v=(0,s(6262).A)(k,[["render",function(e,t,s,p,g,f){const k=(0,r.g2)("Icon");return(0,r.uX)(),(0,r.CE)("div",a,[(0,r.Q3)(" Description "),t[2]||(t[2]=(0,r.Lk)("div",{class:"col-md-4"},[(0,r.Lk)("h2",null,"Stakeholder")],-1)),(0,r.Lk)("div",i,[(0,r.Lk)("img",{src:f.getStakeholderImage,alt:"Stakeholder Logo",class:"organisation-image"},null,8,l),(0,r.Lk)("div",n,[(0,r.Lk)("a",{href:`${e.rootUrl}organisation_information/${s.organisationResults[0].pk}/`},(0,o.toDisplayString)(g.stakeholderModel.organisation_name),9,u)]),(0,r.Lk)("div",c,[(0,r.bF)(k,{icon:e.icons.linkOut},null,8,["icon"]),t[0]||(t[0]=(0,r.eW)(" Website: ")),(0,r.Lk)("a",{href:g.stakeholderModel.organisation_website,target:"_blank",rel:"noopener noreferrer"},(0,o.toDisplayString)(g.stakeholderModel.organisation_website),9,d)]),(0,r.Lk)("div",m,[(0,r.bF)(k,{icon:e.icons.mailIcon},null,8,["icon"]),t[1]||(t[1]=(0,r.eW)(" Email: ")),(0,r.Lk)("a",{href:`mailto:${g.stakeholderModel.organisation_email}`},(0,o.toDisplayString)(g.stakeholderModel.organisation_email),9,h)])])])}]])},404:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(641),o=s(33);const a={name:"ValidationRendering",props:{errorList:{type:Array,default:()=>[]}}},i=(0,s(6262).A)(a,[["render",function(e,t,s,a,i,l){return(0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.errorList,(e=>((0,r.uX)(),(0,r.CE)("span",{class:"error",key:e.$uid},(0,o.toDisplayString)(e.$message),1)))),128)}]])},9827:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(7413);const o={data:()=>({darkTheme:r.a}),methods:{getTheme:e=>"dark"===e?r.a:null}}},4247:(e,t,s)=>{s.d(t,{A:()=>r});const r={methods:{getToken(e){const t=new RegExp(`${e}=([^;]+)`).exec(document.cookie);return null!==t?encodeURIComponent(t[1]):null}}}},2243:(e,t,s)=>{s.d(t,{A:()=>S});var r=s(8998),o=s(102),a=s(9394),i=s(2438),l=s(9605),n=s(3438),u=s(5666),c=s(6375),d=s(1647),m=s(7066),h=s(4397),p=s(4603),g=s(7432),f=s(1758),k=s(8959),v=s(9587),L=s(9675),A=s(386),b=s(6120),_=s(8086),y=s(5617),I=s(6325),$=s(6500),w=s(5707),M=s(1511);const S={data:()=>({icons:{arrowUp:r.A,bugIcon:o.A,bxBriefcase:a.A,cardChecklist:i.A,clipboardIcon:l.A,documentPdf:n.A,documentText:u.A,folderIcon:c.A,groupPresentation:d.A,imageIcon:m.A,infoCircle:h.A,linkIcon:p.A,linkIcon2:g.A,linkOut:f.A,mailIcon:k.A,microsoftExcel:v.A,microsoftPowerpoint:L.A,microsoftWord:A.A,noteAdd:b.A,objectStorage:_.A,passwordIcon:y.A,trashCan:I.A,userIcon:$.A,usersIcon:w.A,xCircle:M.A}})}}}]);