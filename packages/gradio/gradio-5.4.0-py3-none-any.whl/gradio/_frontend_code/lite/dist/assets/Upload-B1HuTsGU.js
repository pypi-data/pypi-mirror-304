import{a as te,i as ie,s as le,f as y,p as W,k as O,x as G,q as p,r as w,l as I,v as A,n as H,w as x,o as M,A as ne,a3 as Te,a8 as Ue,$ as j,N as se,y as re,b as L,z as ae,t as T,av as Ce,G as U,H as De,e as oe,E as z,aw as C,a1 as D,u as ue,h as fe,j as de,M as Le,c as Ne,m as Oe,d as Ie,F as Me}from"../lite.js";/* empty css                                             */function $(t){let e,l,i,s,d=S(t[2])+"",a,u,r,o,b=t[2].orig_name+"",_;return{c(){e=W("div"),l=W("span"),i=W("div"),s=W("progress"),a=O(d),r=G(),o=W("span"),_=O(b),j(s,"visibility","hidden"),j(s,"height","0"),j(s,"width","0"),s.value=u=S(t[2]),p(s,"max","100"),p(s,"class","svelte-1vsfomn"),p(i,"class","progress-bar svelte-1vsfomn"),p(o,"class","file-name svelte-1vsfomn"),p(e,"class","file svelte-1vsfomn")},m(h,c){I(h,e,c),A(e,l),A(l,i),A(i,s),A(s,a),A(e,r),A(e,o),A(o,_)},p(h,c){c&4&&d!==(d=S(h[2])+"")&&H(a,d),c&4&&u!==(u=S(h[2]))&&(s.value=u),c&4&&b!==(b=h[2].orig_name+"")&&H(_,b)},d(h){h&&M(e)}}}function Se(t){let e,l,i,s=t[0].length+"",d,a,u=t[0].length>1?"files":"file",r,o,b,_=t[2]&&$(t);return{c(){e=W("div"),l=W("span"),i=O("Uploading "),d=O(s),a=G(),r=O(u),o=O("..."),b=G(),_&&_.c(),p(l,"class","uploading svelte-1vsfomn"),p(e,"class","wrap svelte-1vsfomn"),w(e,"progress",t[1])},m(h,c){I(h,e,c),A(e,l),A(l,i),A(l,d),A(l,a),A(l,r),A(l,o),A(e,b),_&&_.m(e,null)},p(h,[c]){c&1&&s!==(s=h[0].length+"")&&H(d,s),c&1&&u!==(u=h[0].length>1?"files":"file")&&H(r,u),h[2]?_?_.p(h,c):(_=$(h),_.c(),_.m(e,null)):_&&(_.d(1),_=null),c&2&&w(e,"progress",h[1])},i:x,o:x,d(h){h&&M(e),_&&_.d()}}}function S(t){return t.progress*100/(t.size||0)||0}function je(t){let e=0;return t.forEach(l=>{e+=S(l)}),document.documentElement.style.setProperty("--upload-progress-width",(e/t.length).toFixed(2)+"%"),e/t.length}function qe(t,e,l){let{upload_id:i}=e,{root:s}=e,{files:d}=e,{stream_handler:a}=e,u,r=!1,o,b,_=d.map(f=>({...f,progress:0}));const h=ne();function c(f,g){l(0,_=_.map(F=>(F.orig_name===f&&(F.progress+=g),F)))}return Te(async()=>{if(u=await a(new URL(`${s}/gradio_api/upload_progress?upload_id=${i}`)),u==null)throw new Error("Event source is not defined");u.onmessage=async function(f){const g=JSON.parse(f.data);r||l(1,r=!0),g.msg==="done"?(u?.close(),h("done")):(l(7,o=g),c(g.orig_name,g.chunk_size))}}),Ue(()=>{(u!=null||u!=null)&&u.close()}),t.$$set=f=>{"upload_id"in f&&l(3,i=f.upload_id),"root"in f&&l(4,s=f.root),"files"in f&&l(5,d=f.files),"stream_handler"in f&&l(6,a=f.stream_handler)},t.$$.update=()=>{t.$$.dirty&1&&je(_),t.$$.dirty&129&&l(2,b=o||_[0])},[_,r,b,i,s,d,a,o]}class Ge extends te{constructor(e){super(),ie(this,e,qe,Se,le,{upload_id:3,root:4,files:5,stream_handler:6})}get upload_id(){return this.$$.ctx[3]}set upload_id(e){this.$$set({upload_id:e}),y()}get root(){return this.$$.ctx[4]}set root(e){this.$$set({root:e}),y()}get files(){return this.$$.ctx[5]}set files(e){this.$$set({files:e}),y()}get stream_handler(){return this.$$.ctx[6]}set stream_handler(e){this.$$set({stream_handler:e}),y()}}function He(t){let e,l,i,s,d,a,u,r,o,b,_;const h=t[27].default,c=oe(h,t,t[26],null);return{c(){e=W("button"),c&&c.c(),l=G(),i=W("input"),p(i,"aria-label","file upload"),p(i,"data-testid","file-upload"),p(i,"type","file"),p(i,"accept",s=t[16]||void 0),i.multiple=d=t[6]==="multiple"||void 0,p(i,"webkitdirectory",a=t[6]==="directory"||void 0),p(i,"mozdirectory",u=t[6]==="directory"||void 0),p(i,"class","svelte-1xyfx7i"),p(e,"tabindex",r=t[9]?-1:0),p(e,"class","svelte-1xyfx7i"),w(e,"hidden",t[9]),w(e,"center",t[4]),w(e,"boundedheight",t[3]),w(e,"flex",t[5]),w(e,"disable_click",t[7]),j(e,"height","100%")},m(f,g){I(f,e,g),c&&c.m(e,null),A(e,l),A(e,i),t[35](i),o=!0,b||(_=[z(i,"change",t[18]),z(e,"drag",C(D(t[28]))),z(e,"dragstart",C(D(t[29]))),z(e,"dragend",C(D(t[30]))),z(e,"dragover",C(D(t[31]))),z(e,"dragenter",C(D(t[32]))),z(e,"dragleave",C(D(t[33]))),z(e,"drop",C(D(t[34]))),z(e,"click",t[13]),z(e,"drop",t[19]),z(e,"dragenter",t[17]),z(e,"dragleave",t[17])],b=!0)},p(f,g){c&&c.p&&(!o||g[0]&67108864)&&ue(c,h,f,f[26],o?de(h,f[26],g,null):fe(f[26]),null),(!o||g[0]&65536&&s!==(s=f[16]||void 0))&&p(i,"accept",s),(!o||g[0]&64&&d!==(d=f[6]==="multiple"||void 0))&&(i.multiple=d),(!o||g[0]&64&&a!==(a=f[6]==="directory"||void 0))&&p(i,"webkitdirectory",a),(!o||g[0]&64&&u!==(u=f[6]==="directory"||void 0))&&p(i,"mozdirectory",u),(!o||g[0]&512&&r!==(r=f[9]?-1:0))&&p(e,"tabindex",r),(!o||g[0]&512)&&w(e,"hidden",f[9]),(!o||g[0]&16)&&w(e,"center",f[4]),(!o||g[0]&8)&&w(e,"boundedheight",f[3]),(!o||g[0]&32)&&w(e,"flex",f[5]),(!o||g[0]&128)&&w(e,"disable_click",f[7])},i(f){o||(T(c,f),o=!0)},o(f){L(c,f),o=!1},d(f){f&&M(e),c&&c.d(f),t[35](null),b=!1,Le(_)}}}function Je(t){let e,l,i=!t[9]&&ee(t);return{c(){i&&i.c(),e=se()},m(s,d){i&&i.m(s,d),I(s,e,d),l=!0},p(s,d){s[9]?i&&(re(),L(i,1,1,()=>{i=null}),ae()):i?(i.p(s,d),d[0]&512&&T(i,1)):(i=ee(s),i.c(),T(i,1),i.m(e.parentNode,e))},i(s){l||(T(i),l=!0)},o(s){L(i),l=!1},d(s){s&&M(e),i&&i.d(s)}}}function Re(t){let e,l,i,s,d;const a=t[27].default,u=oe(a,t,t[26],null);return{c(){e=W("button"),u&&u.c(),p(e,"tabindex",l=t[9]?-1:0),p(e,"class","svelte-1xyfx7i"),w(e,"hidden",t[9]),w(e,"center",t[4]),w(e,"boundedheight",t[3]),w(e,"flex",t[5]),j(e,"height","100%")},m(r,o){I(r,e,o),u&&u.m(e,null),i=!0,s||(d=z(e,"click",t[12]),s=!0)},p(r,o){u&&u.p&&(!i||o[0]&67108864)&&ue(u,a,r,r[26],i?de(a,r[26],o,null):fe(r[26]),null),(!i||o[0]&512&&l!==(l=r[9]?-1:0))&&p(e,"tabindex",l),(!i||o[0]&512)&&w(e,"hidden",r[9]),(!i||o[0]&16)&&w(e,"center",r[4]),(!i||o[0]&8)&&w(e,"boundedheight",r[3]),(!i||o[0]&32)&&w(e,"flex",r[5])},i(r){i||(T(u,r),i=!0)},o(r){L(u,r),i=!1},d(r){r&&M(e),u&&u.d(r),s=!1,d()}}}function ee(t){let e,l;return e=new Ge({props:{root:t[8],upload_id:t[14],files:t[15],stream_handler:t[11]}}),{c(){Ne(e.$$.fragment)},m(i,s){Oe(e,i,s),l=!0},p(i,s){const d={};s[0]&256&&(d.root=i[8]),s[0]&16384&&(d.upload_id=i[14]),s[0]&32768&&(d.files=i[15]),s[0]&2048&&(d.stream_handler=i[11]),e.$set(d)},i(i){l||(T(e.$$.fragment,i),l=!0)},o(i){L(e.$$.fragment,i),l=!1},d(i){Ie(e,i)}}}function Be(t){let e,l,i,s;const d=[Re,Je,He],a=[];function u(r,o){return r[0]==="clipboard"?0:r[1]&&r[10]?1:2}return e=u(t),l=a[e]=d[e](t),{c(){l.c(),i=se()},m(r,o){a[e].m(r,o),I(r,i,o),s=!0},p(r,o){let b=e;e=u(r),e===b?a[e].p(r,o):(re(),L(a[b],1,1,()=>{a[b]=null}),ae(),l=a[e],l?l.p(r,o):(l=a[e]=d[e](r),l.c()),T(l,1),l.m(i.parentNode,i))},i(r){s||(T(l),s=!0)},o(r){L(l),s=!1},d(r){r&&M(i),a[e].d(r)}}}function Ke(t,e,l){if(!t||t==="*"||t==="file/*"||Array.isArray(t)&&t.some(s=>s==="*"||s==="file/*"))return!0;let i;if(typeof t=="string")i=t.split(",").map(s=>s.trim());else if(Array.isArray(t))i=t;else return!1;return i.includes(e)||i.some(s=>{const[d]=s.split("/").map(a=>a.trim());return s.endsWith("/*")&&l.startsWith(d+"/")})}function Qe(t,e,l){let i,{$$slots:s={},$$scope:d}=e,{filetype:a=null}=e,{dragging:u=!1}=e,{boundedheight:r=!0}=e,{center:o=!0}=e,{flex:b=!0}=e,{file_count:_="single"}=e,{disable_click:h=!1}=e,{root:c}=e,{hidden:f=!1}=e,{format:g="file"}=e,{uploading:F=!1}=e,{hidden_upload:E=null}=e,{show_progress:X=!0}=e,{max_file_size:J=null}=e,{upload:R}=e,{stream_handler:Y}=e,B,K,N,Z=null;const _e=()=>{if(typeof navigator<"u"){const n=navigator.userAgent.toLowerCase();return n.indexOf("iphone")>-1||n.indexOf("ipad")>-1}return!1},P=ne(),ce=["image","video","audio","text","file"],Q=n=>i&&n.startsWith(".")?(Z=!0,n):i&&n.includes("file/*")?"*":n.startsWith(".")||n.endsWith("/*")?n:ce.includes(n)?n+"/*":"."+n;function he(){l(20,u=!u)}function ge(){navigator.clipboard.read().then(async n=>{for(let m=0;m<n.length;m++){const k=n[m].types.find(v=>v.startsWith("image/"));if(k){n[m].getType(k).then(async v=>{const V=new File([v],`clipboard.${k.replace("image/","")}`);await q([V])});break}}})}function me(){h||E&&(l(2,E.value="",E),E.click())}async function pe(n){await Me(),l(14,B=Math.random().toString(36).substring(2,15)),l(1,F=!0);try{const m=await R(n,c,B,J??1/0);return P("load",_==="single"?m?.[0]:m),l(1,F=!1),m||[]}catch(m){return P("error",m.message),l(1,F=!1),[]}}async function q(n){if(!n.length)return;let m=n.map(k=>new File([k],k instanceof File?k.name:"file",{type:k.type}));return i&&Z&&(m=m.filter(k=>be(k)?!0:(P("error",`Invalid file type: ${k.name}. Only ${a} allowed.`),!1)),m.length===0)?[]:(l(15,K=await Ce(m)),await pe(K))}function be(n){return a?(Array.isArray(a)?a:[a]).some(k=>{const v=Q(k);if(v.startsWith("."))return n.name.toLowerCase().endsWith(v.toLowerCase());if(v==="*")return!0;if(v.endsWith("/*")){const[V]=v.split("/");return n.type.startsWith(V+"/")}return n.type===v}):!0}async function ye(n){const m=n.target;if(m.files)if(g!="blob")await q(Array.from(m.files));else{if(_==="single"){P("load",m.files[0]);return}P("load",m.files)}}async function we(n){if(l(20,u=!1),!n.dataTransfer?.files)return;const m=Array.from(n.dataTransfer.files).filter(k=>{const v="."+k.name.split(".").pop();return v&&Ke(N,v,k.type)||(v&&Array.isArray(a)?a.includes(v):v===a)?!0:(P("error",`Invalid file type only ${a} allowed.`),!1)});if(g!="blob")await q(m);else{if(_==="single"){P("load",m[0]);return}P("load",m)}}function ke(n){U.call(this,t,n)}function ve(n){U.call(this,t,n)}function Ae(n){U.call(this,t,n)}function ze(n){U.call(this,t,n)}function We(n){U.call(this,t,n)}function Fe(n){U.call(this,t,n)}function Ee(n){U.call(this,t,n)}function Pe(n){De[n?"unshift":"push"](()=>{E=n,l(2,E)})}return t.$$set=n=>{"filetype"in n&&l(0,a=n.filetype),"dragging"in n&&l(20,u=n.dragging),"boundedheight"in n&&l(3,r=n.boundedheight),"center"in n&&l(4,o=n.center),"flex"in n&&l(5,b=n.flex),"file_count"in n&&l(6,_=n.file_count),"disable_click"in n&&l(7,h=n.disable_click),"root"in n&&l(8,c=n.root),"hidden"in n&&l(9,f=n.hidden),"format"in n&&l(21,g=n.format),"uploading"in n&&l(1,F=n.uploading),"hidden_upload"in n&&l(2,E=n.hidden_upload),"show_progress"in n&&l(10,X=n.show_progress),"max_file_size"in n&&l(22,J=n.max_file_size),"upload"in n&&l(23,R=n.upload),"stream_handler"in n&&l(11,Y=n.stream_handler),"$$scope"in n&&l(26,d=n.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&33554433&&(a==null?l(16,N=null):typeof a=="string"?l(16,N=Q(a)):i&&a.includes("file/*")?l(16,N="*"):(l(0,a=a.map(Q)),l(16,N=a.join(", "))))},l(25,i=_e()),[a,F,E,r,o,b,_,h,c,f,X,Y,ge,me,B,K,N,he,ye,we,u,g,J,R,q,i,d,s,ke,ve,Ae,ze,We,Fe,Ee,Pe]}class Ye extends te{constructor(e){super(),ie(this,e,Qe,Be,le,{filetype:0,dragging:20,boundedheight:3,center:4,flex:5,file_count:6,disable_click:7,root:8,hidden:9,format:21,uploading:1,hidden_upload:2,show_progress:10,max_file_size:22,upload:23,stream_handler:11,paste_clipboard:12,open_file_upload:13,load_files:24},null,[-1,-1])}get filetype(){return this.$$.ctx[0]}set filetype(e){this.$$set({filetype:e}),y()}get dragging(){return this.$$.ctx[20]}set dragging(e){this.$$set({dragging:e}),y()}get boundedheight(){return this.$$.ctx[3]}set boundedheight(e){this.$$set({boundedheight:e}),y()}get center(){return this.$$.ctx[4]}set center(e){this.$$set({center:e}),y()}get flex(){return this.$$.ctx[5]}set flex(e){this.$$set({flex:e}),y()}get file_count(){return this.$$.ctx[6]}set file_count(e){this.$$set({file_count:e}),y()}get disable_click(){return this.$$.ctx[7]}set disable_click(e){this.$$set({disable_click:e}),y()}get root(){return this.$$.ctx[8]}set root(e){this.$$set({root:e}),y()}get hidden(){return this.$$.ctx[9]}set hidden(e){this.$$set({hidden:e}),y()}get format(){return this.$$.ctx[21]}set format(e){this.$$set({format:e}),y()}get uploading(){return this.$$.ctx[1]}set uploading(e){this.$$set({uploading:e}),y()}get hidden_upload(){return this.$$.ctx[2]}set hidden_upload(e){this.$$set({hidden_upload:e}),y()}get show_progress(){return this.$$.ctx[10]}set show_progress(e){this.$$set({show_progress:e}),y()}get max_file_size(){return this.$$.ctx[22]}set max_file_size(e){this.$$set({max_file_size:e}),y()}get upload(){return this.$$.ctx[23]}set upload(e){this.$$set({upload:e}),y()}get stream_handler(){return this.$$.ctx[11]}set stream_handler(e){this.$$set({stream_handler:e}),y()}get paste_clipboard(){return this.$$.ctx[12]}get open_file_upload(){return this.$$.ctx[13]}get load_files(){return this.$$.ctx[24]}}export{Ye as U};
//# sourceMappingURL=Upload-B1HuTsGU.js.map
