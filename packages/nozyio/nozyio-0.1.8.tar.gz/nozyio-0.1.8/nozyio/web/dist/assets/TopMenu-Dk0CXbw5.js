const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TopMenuNodes-DVv3UqcX.js","assets/reactflow-vendor-BDofclgK.js","assets/react-vendor-4ldeB94U.js","assets/Stack-DBbsVXXo.js","assets/index-DZ7fLz5e.js","assets/index-BqS5Knfd.css","assets/TopMenuCodePreviewButton-DPZ9fc3C.js"])))=>i.map(i=>d[i]);
import{c,f as g,a as z,u as M,b as x,d as v,g as j,s as w,_ as I}from"./index-DZ7fLz5e.js";import{j as e}from"./reactflow-vendor-BDofclgK.js";import{c as h,B as d,S as C,a as y,I as T,F as S}from"./Stack-DBbsVXXo.js";import{r as i,a as O}from"./react-vendor-4ldeB94U.js";/**
 * @license @tabler/icons-react v3.18.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var E=h("outline","device-floppy","IconDeviceFloppy",[["path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14 4l0 4l-6 0l0 -4",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.18.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var F=h("outline","download","IconDownload",[["path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M7 11l5 5l5 -5",key:"svg-1"}],["path",{d:"M12 4l0 12",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.18.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var P=h("outline","folder-open","IconFolderOpen",[["path",{d:"M5 19l2.757 -7.351a1 1 0 0 1 .936 -.649h12.307a1 1 0 0 1 .986 1.164l-.996 5.211a2 2 0 0 1 -1.964 1.625h-14.026a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v2",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.18.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var R=h("outline","pencil","IconPencil",[["path",{d:"M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4",key:"svg-0"}],["path",{d:"M13.5 6.5l4 4",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.18.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var D=h("outline","plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.18.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var L=h("filled","player-play-filled","IconPlayerPlayFilled",[["path",{d:"M6 4v16a1 1 0 0 0 1.524 .852l13 -8a1 1 0 0 0 0 -1.704l-13 -8a1 1 0 0 0 -1.524 .852z",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.18.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var _=h("filled","triangle-inverted-filled","IconTriangleInvertedFilled",[["path",{d:"M20.118 3h-16.225a2.914 2.914 0 0 0 -2.503 4.371l8.116 13.549a2.917 2.917 0 0 0 4.987 .005l8.11 -13.539a2.914 2.914 0 0 0 -2.486 -4.386z",key:"svg-0"}]]);function W(){const[l,t]=i.useState(!1),o=z("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",12);return e.jsx(d,{left:e.jsx(L,{size:15}),isLoading:l,onClick:()=>{const n={job_id:o(),nodes:c.graph.nodes,edges:c.graph.edges,values:c.graph.values};console.log("graph",n),t(!0),g("/run_job",{method:"POST",body:JSON.stringify(n)}).finally(()=>{t(!1)})},children:"Run"})}function G(){const[l,t]=i.useState(!1),{toast:o}=M(),{onSaveGraph:n}=x(v(a=>({onSaveGraph:a.onSaveGraph})));return e.jsx(d,{variant:"ghost",size:"sm",title:"Save workflow",isLoading:l,onClick:()=>{const a={nodes:c.graph.nodes,edges:c.graph.edges,values:c.graph.values};console.log("graph",a);let r=j();r||(r=prompt("Enter workflow name")),r&&(t(!0),g("/workflow/save",{method:"POST",body:JSON.stringify({graph:a,path:r.endsWith(".json")?r:`${r}.json`,new:j()==null})}).then(s=>s.json()).then(s=>{if(console.log("json",s),typeof s.path!="string")throw new Error(s.error);w(s.path),n(),o({title:"✅ Workflow saved to",description:s.root_rel})}).catch(s=>{o({title:"Error saving workflow",variant:"destructive",description:s.message}),console.error(s)}).finally(()=>{t(!1)}))},children:e.jsx(E,{size:18})})}function B({onClose:l,children:t,className:o="",backdrop:n="rgba(0, 0, 0, 0.5)",position:a="left"}){const r=i.useRef(null);return i.useEffect(()=>{const s=p=>{r.current&&!r.current.contains(p.target)&&l()};return document.addEventListener("mousedown",s,!0),()=>{document.removeEventListener("mousedown",s,!0)}},[]),O.createPortal(e.jsxs(e.Fragment,{children:[n&&e.jsx("div",{onClick:l,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:n}}),e.jsx("div",{style:{height:"100vh",position:"fixed",top:0,left:a==="right"?"auto":0,right:a==="right"?0:"auto"},ref:r,className:`bg-zinc-800 ${o}`,children:t})]}),document.body)}function b({path:l,onClickWorkflow:t}){const[o,n]=i.useState([]),[a,r]=i.useState(!1);return i.useEffect(()=>{r(!0),g("/workflow/list?path="+encodeURIComponent(l)).then(s=>s.json()).then(s=>{n(s)}).finally(()=>{r(!1)})},[]),e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex flex-col",children:[a&&e.jsx(C,{}),o.map(s=>s.type==="folder"?e.jsx($,{node:s,onClickWorkflow:t},s.path):e.jsx(y,{children:e.jsx(d,{variant:"ghost",className:"justify-start text-lg",onClick:()=>{typeof s.rel_path=="string"&&t(s.rel_path)},children:e.jsx("p",{className:"",children:s.name})})},s.type+"_"+s.name))]})})}function $({node:l,onClickWorkflow:t}){const[o,n]=i.useState(!1);return e.jsxs(y,{className:"",children:[e.jsxs("div",{className:"flex flex-row items-center cursor-pointer",onClick:()=>n(!o),children:[e.jsx(_,{size:8,className:o?"mr-1":"-rotate-90 mr-1"}),e.jsx(T,{className:"mr-1"}),l.name]}),o&&e.jsx("div",{className:"ml-3",children:e.jsx(b,{path:l.path,onClickWorkflow:t})})]})}function A(){const[l,t]=i.useState(!1),{name:o,isDirty:n}=x(v(a=>({name:a.name,isDirty:a.isDirty})));return e.jsxs(e.Fragment,{children:[e.jsx(d,{onClick:()=>t(!0),className:"px-[8px] bg-zinc-800 hover:bg-zinc-500",children:e.jsxs(S,{className:"gap-[4px]",children:[n&&e.jsx("span",{children:" * "}),e.jsx("span",{className:"mr-1",children:o??"Untitled"}),e.jsx(_,{size:7})]})}),l&&e.jsx(B,{onClose:()=>t(!1),backdrop:null,children:e.jsxs(y,{className:"w-[400px] py-2 px-2 overflow-y-auto h-[100vh]",children:[e.jsx("h2",{className:"text-xl font-bold p-2",children:"Workflows"}),e.jsx(b,{path:"",onClickWorkflow:a=>{w(a),t(!1)}})]})})]})}function U(){const{setName:l}=x(v(t=>({setName:t.setName})));return e.jsx(d,{className:"text-sm",size:"sm",title:"Rename workflow",variant:"ghost",onClick:()=>{const t=j(),o=prompt("Enter a name for this workflow",(t==null?void 0:t.slice(0,-5))??"");o&&(t?g("/workflow/rename",{method:"POST",body:JSON.stringify({path:t,new_name:o.endsWith(".json")?o:`${o}.json`})}).then(n=>n.json()).then(n=>{const a=n.path;if(typeof a!="string")throw new Error(n.error);w(a)}).catch(n=>{alert(`❌Failed to rename workflow: ${n.message}`)}):l(o))},children:e.jsx(R,{size:18})})}const J=i.lazy(()=>I(()=>import("./TopMenuNodes-DVv3UqcX.js"),__vite__mapDeps([0,1,2,3,4,5]))),V=i.lazy(()=>I(()=>import("./TopMenuCodePreviewButton-DPZ9fc3C.js"),__vite__mapDeps([6,1,2,3,4,5])));function q(){const{name:l,loadGraph:t,clearGraph:o}=x(v(s=>({name:s.name,loadGraph:s.loadGraph,clearGraph:s.clearGraph}))),n=()=>{var m;(m=document.getElementById("workflow-download"))==null||m.click();const s=JSON.stringify(c.graph,null,2);console.log("common_app.graph",c.graph);const p=new Blob([s],{type:"application/json"}),f=URL.createObjectURL(p),u=document.createElement("a");u.href=f,u.download=`${l??"nozy_workflow"}.json`,u.click()},a=i.useRef(null),r=s=>{var u;const p=(u=s.target.files)==null?void 0:u[0],f=new FileReader;p&&(f.readAsText(p,"UTF-8"),f.onload=m=>{var N;const k=JSON.parse((N=m.target)==null?void 0:N.result);k.name=p.name.replace(/\.json$/,""),t(k)})};return e.jsxs("div",{className:"flex items-center justify-between absolute top-0 left-0 right-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{}),e.jsx(d,{size:"sm",className:"px-1",variant:"ghost",title:"New workflow",onClick:()=>{o()},children:e.jsx(D,{size:18})}),e.jsx(A,{}),e.jsxs(S,{className:"gap-0",children:[e.jsx(G,{}),e.jsx(U,{}),e.jsx(d,{size:"sm",variant:"ghost",title:"Download workflow",onClick:n,children:e.jsx(F,{size:18})}),e.jsx(d,{size:"sm",variant:"ghost",title:"Open workflow",onClick:()=>{var s;(s=a.current)==null||s.click()},children:e.jsx(P,{size:18})}),e.jsx("input",{type:"file",accept:".json",id:"workflow-upload",ref:a,style:{display:"none"},onChange:r})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{}),e.jsx(W,{})]})]})}const Y=Object.freeze(Object.defineProperty({__proto__:null,default:q},Symbol.toStringTag,{value:"Module"}));export{B as C,_ as I,Y as T};
