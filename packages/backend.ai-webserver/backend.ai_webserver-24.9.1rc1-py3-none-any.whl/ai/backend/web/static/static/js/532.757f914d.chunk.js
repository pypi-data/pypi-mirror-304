"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[532],{33002:(e,n,s)=>{s.d(n,{A:()=>u});var r=s(2993),t=s(30597),l=s(50868),o=s(60822),i=s(55368),a=s(89608),d=s.n(a),c=(s(43373),s(73689));const u=e=>{let{status:n="default",extraButtonTitle:s,onClickExtraButton:a,extra:u,style:m,...h}=e;const{token:p}=l.A.useToken(),g=u||s&&(0,c.jsx)(o.Ay,{type:"link",icon:"error"===n?(0,c.jsx)(r.A,{twoToneColor:p.colorError}):"warning"===n?(0,c.jsx)(t.A,{twoToneColor:p.colorWarning}):void 0,onClick:a,children:s})||void 0;return(0,c.jsx)(i.A,{className:"error"===n?"bai-card-error":"",style:d().extend(m,{borderColor:"error"===n?p.colorError:"warning"===n?p.colorWarning:"success"===n?p.colorSuccess:null===m||void 0===m?void 0:m.borderColor}),extra:g,...h})}},68786:(e,n,s)=>{s.d(n,{A:()=>u});var r=s(52161),t=s(22987),l=s(12731),o=s.n(l),i=s(89608),a=s.n(i),d=s(43373),c=s(73689);const u=d.forwardRef(((e,n)=>{let{value:s,onChange:l,localFormat:i,...d}=e;const[,u]=(0,r.A)({value:s,onChange:l});return(0,c.jsx)(t.A,{ref:n,value:s?o()(s):void 0,onChange:e=>{var n,s,r;a().isArray(e)&&(e=e[0]);const t=i?null===(n=e)||void 0===n?void 0:n.format():null===(s=e)||void 0===s||null===(r=s.tz())||void 0===r?void 0:r.toISOString();u(t)},...d})}))},69144:(e,n,s)=>{s.d(n,{A:()=>o});var r=s(23702),t=s(43373),l=s(73689);const o=e=>{let{value:n,...s}=e;const o=r.A.useFormInstance();return(0,t.useEffect)((()=>{o.setFieldValue(s.name,n)}),[n,o,s.name]),(0,l.jsx)(r.A.Item,{...s,hidden:!0})}},69715:(e,n,s)=>{s.d(n,{Ay:()=>x,Kk:()=>p,p3:()=>g,sT:()=>m,vB:()=>u});var r=s(51593),t=s(98401),l=s(89130),o=s(6597),i=s(15934),a=s(43373),d=s(73689);const c=e=>{let{image:n,...s}=e;n=n||"";const[,{getImageAliasName:l,getBaseVersion:o,tagAlias:i}]=(0,r.Gj)();return(0,d.jsx)(t.A,{values:[{label:i(l(n)),color:"blue"},{label:o(n),color:"green"}],...s})},u=e=>{let{image:n,...s}=e;n=n||"";const[,{getBaseVersion:t,tagAlias:l}]=(0,r.Gj)();return(0,d.jsx)(i.A,{color:"green",...s,children:l(t(n))})},m=e=>{let{image:n,...s}=e;n=n||"";const[,{getBaseImage:t,tagAlias:l}]=(0,r.Gj)();return(0,d.jsx)(i.A,{color:"green",...s,children:l(t(n))})},h=e=>{let{image:n,...s}=e;n=n||"";const[,{getArchitecture:t,tagAlias:l}]=(0,r.Gj)();return(0,d.jsx)(i.A,{color:"green",...s,children:l(t(n))})},p=e=>{let{image:n,...s}=e;n=n||"";const[,{getImageLang:t,tagAlias:l}]=(0,r.Gj)();return(0,d.jsx)(i.A,{color:"green",...s,children:l(t(n))})},g=e=>{let{tag:n,labels:s,highlightKeyword:a,...c}=e;s=s||[];const[,{getConstraints:u}]=(0,r.Gj)(),m=u(n,s);return(0,d.jsxs)(l.A,{direction:"row",align:"start",children:[m[0]?(0,d.jsx)(i.A,{color:"blue",...c,children:(0,d.jsx)(o.A,{keyword:a,children:m[0]})}):null,m[1]?(0,d.jsx)(t.A,{color:"cyan",values:[{label:(0,d.jsx)(o.A,{keyword:a,children:"Customized"}),color:"cyan"},{label:(0,d.jsx)(o.A,{keyword:a,children:m[1]}),color:"cyan"}],...c}):null]})},v=(e,n)=>{let{image:s,style:r={}}=e;return s=s||"",(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(c,{image:s}),(0,d.jsx)(m,{image:s}),(0,d.jsx)(h,{image:s})]})},x=a.memo(v)},62798:(e,n,s)=>{s.r(n),s.d(n,{default:()=>t});const r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"}],n=[{kind:"Variable",name:"email",variableName:"email"}],s={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},l={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},t],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[r,l],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s,t],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[r,l,t],storageKey:null}]},params:{cacheID:"a8de553c14d6730a6825cba2f409be0d",id:null,metadata:{},name:"SessionOwnerSetterCardQuery",operationKind:"query",text:"query SessionOwnerSetterCardQuery(\n  $email: String!\n) {\n  keypairs(email: $email) {\n    access_key\n    id\n  }\n  user(email: $email) {\n    domain_name\n    groups {\n      name\n      id\n    }\n    id\n  }\n}\n"}}}();r.hash="ba086835ea654ab889e0e6aaefa0abfe";const t=r},10532:(e,n,s)=>{s.r(n),s.d(n,{ResourceNumbersOfSession:()=>ze,default:()=>Le});var r=s(33002),t=s(94016),l=s(68786),o=s(98401),i=s(32461),a=s(89130),d=s(98957),c=s(16272),u=s(69715),m=s(4060),h=s(51593),p=s(23702),g=s(69056),v=s(15934),x=s(89608),y=s.n(x),A=s(43373),j=s(56762),b=s(73689);const w=1024,f=65535,F=e=>{let{inValid:n,value:s,...r}=e;return(0,b.jsx)(v.A,{color:!n&&S(s)?void 0:"red",...r})},S=e=>{if(k(e)){const n=e.split(":"),[s,r]=n.map((e=>parseInt(e)));return s>=w&&r<=f}return e===parseInt(e).toString()&&parseInt(e)>=w&&parseInt(e)<=f},k=e=>{const n=e.split(":");if(2===n.length){const[e,s]=n.map((e=>parseInt(e)));return e<=s}return!1},T=e=>y().flatten(y().map(e,(e=>k(e)?(e=>{const[n,s]=e.split(":").map((e=>parseInt(e)));return y().range(n,s+1)})(e):parseInt(e)))),E=e=>{let{name:n="ports",...s}=e;const{t:r}=(0,j.Bd)(),t=(0,h.CX)(),l=p.A.useFormInstance();return(0,b.jsx)(p.A.Item,{label:r("session.launcher.PreOpenPortTitle"),name:n,tooltip:(0,b.jsx)(j.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:r("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,n)=>T(n).length<=t._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(r("session.launcher.PreOpenPortMaxCountLimit",{count:t._config.maxCountForPreopenPorts})))}),()=>({validator:(e,n)=>y().every(n,(e=>parseInt(e).toString()===e||k(e)))?Promise.resolve():Promise.reject(new Error(r("session.launcher.InvalidPortFormat")))}),()=>({validator(e,n){const s=T(n);return y().every(s,(e=>e>=w&&e<=f))?Promise.resolve():Promise.reject(new Error(r("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,n){const s=T(n);return y().uniq(s).length===s.length?Promise.resolve():Promise.reject(new Error(r("session.launcher.DuplicatedPort")))}})],...s,children:(0,b.jsx)(g.A,{mode:"tags",tagRender:e=>{const s=y().filter(T(l.getFieldValue(n)),(n=>n===parseInt(e.value))).length>1;return(0,b.jsx)(F,{inValid:s,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})};var I=s(39428),V=s(76604),N=s(22960),C=s(58278);const P=e=>{let{open:n,onClose:s,...r}=e;const{t:t}=(0,j.Bd)(),[l,o]=(0,N.q)("has_opened_tour_neo_session_validation"),i=[{title:t("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:t("tourguide.NeoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:t("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:t("tourguide.NeoSessionLauncher.FixErrorFieldbyModifyButton"),target:()=>{var e,n;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e||null===(n=e[0])||void 0===n?void 0:n.querySelector(".ant-card-extra")}},{title:t("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:t("tourguide.NeoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,b.jsx)(C.A,{steps:i,onClose:e=>{null===s||void 0===s||s(e),o(!0)},open:!l&&n,...r})};var _=s(67378);const O=e=>{let{...n}=e;const{t:s}=(0,j.Bd)();return(0,b.jsx)(p.A.Item,{label:s("session.launcher.SessionName"),name:"sessionName",rules:[{min:4,message:s("session.Validation.SessionNameTooShort")},{max:64,message:s("session.Validation.SessionNameTooLong64")},{validator:(e,n)=>y().isEmpty(n)?Promise.resolve():/^\w/.test(n)?/^[\w.-]*$/.test(n)?!/\w$/.test(n)&&n.length>=4?Promise.reject(s("session.Validation.SessionNameShouldEndWith")):Promise.resolve():Promise.reject(s("session.Validation.SessionNameInvalidCharacter")):Promise.reject(s("session.Validation.SessionNameShouldStartWith"))}],...n,children:(0,b.jsx)(_.A,{allowClear:!0,autoComplete:"off"})})};var D=s(11899),M=s(60881);const B=e=>{let{autoSelectOption:n,...s}=e;const{value:r,options:t,onChange:l}=s;return(0,A.useLayoutEffect)((()=>{n&&y().isEmpty(r)&&null!==t&&void 0!==t&&t[0]&&(y().isBoolean(n)?null===l||void 0===l||l((null===t||void 0===t?void 0:t[0].value)||(null===t||void 0===t?void 0:t[0]),null===t||void 0===t?void 0:t[0]):y().isFunction(n)&&(null===l||void 0===l||l(n(t),t[0])))}),[r,t,l,n]),(0,b.jsx)(g.A,{...s})};var z=s(69144),R=s(58879),L=s(7194),q=s(6597);const G=e=>{let{projectName:n,autoSelectDefault:s,filter:r,searchValue:t,onSearch:l,loading:o,...i}=e;const a=(0,R.QE)(),[d]=(0,h.Tw)("first"),[c,u]=(0,L.A)({value:t,onChange:l}),[m,p]=(0,L.A)(i),{data:v}=(0,M.nj)({queryKey:["ResourceGroupSelectQuery",n],queryFn:()=>{const e=new URLSearchParams;return e.set("group",n),Promise.all([a({method:"GET",url:`/scaling-groups?${e.toString()}`}),a({method:"GET",url:"/folders/_/hosts"})])},staleTime:0,fetchKey:d}),x=y().flatMap(null===v||void 0===v?void 0:v[1].volume_info,(e=>{var n;return null!==(n=null===e||void 0===e?void 0:e.sftp_scaling_groups)&&void 0!==n?n:[]})),j=y().filter(null===v||void 0===v?void 0:v[0].scaling_groups,(e=>!y().includes(x,e.name)&&(!r||r(e.name))));(0,A.useEffect)((()=>{m&&!y().some(j,(e=>e.name===m))&&p(void 0)}),[j,m,p]);const w=y().find(j,(e=>"default"===e.name))||j[0],f=w?{label:w.name,value:w.name}:void 0;(0,A.useEffect)((()=>{s&&f&&f.value!==i.value&&p(f.value,f)}),[s]);const F=i.showSearch?{onSearch:u,searchValue:c,showSearch:!0}:{};return(0,b.jsx)(g.A,{defaultActiveFirstOption:!0,...F,defaultValue:s?f:void 0,onDropdownVisibleChange:e=>{},loading:o,options:y().map(j,(e=>({value:e.name,label:e.name}))),optionRender:e=>{var n;return(0,b.jsx)(q.A,{keyword:c,children:null===(n=e.data.value)||void 0===n?void 0:n.toString()})},...i,value:m,onChange:p})};var K,U=s(50868),W=s(55368),$=s(15480),H=s(60822),Q=s(98038),J=s(52932),X=s(45679),Y=s(24914),Z=s(88522);const ee=e=>{const{t:n}=(0,j.Bd)(),s=p.A.useFormInstance(),t=p.A.useWatch(["owner","enabled"],s),l=(0,D.Am)();return("admin"===l||"superadmin"===l)&&t&&(0,b.jsx)(r.A,{title:n("session.launcher.SetSessionOwner"),size:"small",status:s.getFieldError(["owner","email"]).length>0||s.getFieldError(["owner","accesskey"]).length>0||s.getFieldError(["owner","project"]).length>0||s.getFieldError(["owner","resourceGroup"]).length>0?"error":void 0,extraButtonTitle:n("button.Edit"),...e,children:(0,b.jsxs)(X.A,{size:"small",column:1,children:[(0,b.jsx)(X.A.Item,{label:n("session.launcher.OwnerEmail"),children:s.getFieldValue(["owner","email"])}),(0,b.jsx)(X.A.Item,{label:n("session.launcher.OwnerAccessKey"),children:s.getFieldValue(["owner","accesskey"])}),(0,b.jsx)(X.A.Item,{label:n("session.launcher.OwnerGroup"),children:s.getFieldValue(["owner","project"])}),(0,b.jsx)(X.A.Item,{label:n("session.launcher.OwnerResourceGroup"),children:s.getFieldValue(["owner","resourceGroup"])})]})})},ne=e=>{const{t:n}=(0,j.Bd)(),{token:r}=U.A.useToken(),t=p.A.useFormInstance(),l=p.A.useWatch(["owner","enabled"],t),[o,i]=(0,A.useState)(),d=(0,Z.useRelayEnvironment)(),{data:c,isFetching:u}=(0,M.nN)({queryKey:["SessionOwnerSetterCard","ownerInfo",o],queryFn:()=>{const e=t.getFieldValue(["owner","email"]);if(!e)return;const n=void 0!==K?K:K=s(62798);return(0,Z.fetchQuery)(d,n,{email:e}).toPromise()},enabled:!!o}),m=t.getFieldValue(["owner","email"])?null===c||void 0===c?void 0:c.keypairs:void 0,h=t.getFieldValue(["owner","email"])?null===c||void 0===c?void 0:c.user:void 0,v=!u&&o&&!h;return(0,b.jsxs)(W.A,{title:n("session.launcher.SetSessionOwner"),extra:(0,b.jsx)(p.A.Item,{name:["owner","enabled"],valuePropName:"checked",noStyle:!0,children:(0,b.jsx)($.A,{})}),styles:l?void 0:{header:{borderBottom:"none"},body:{display:l?"block":"none"}},...e,children:[(0,b.jsx)(z.A,{name:["owner","domainName"],value:null===h||void 0===h?void 0:h.domain_name}),(0,b.jsx)(p.A.Item,{dependencies:[["owner","enabled"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(a.A,{children:(0,b.jsx)(p.A.Item,{name:["owner","email"],label:n("session.launcher.OwnerEmail"),rules:[{required:l},{type:"email",message:n("credential.validation.InvalidEmailAddress")}],style:{flex:1},validateStatus:v?"error":void 0,help:v?n("credential.NoUserToDisplay"):void 0,children:(0,b.jsx)(_.A.Search,{onSearch:e=>{t.validateFields([["owner","email"]]).then((()=>{i(e)})).catch((()=>{}))},onChange:()=>{i(""),t.setFieldsValue({owner:{accesskey:"",project:void 0,resourceGroup:void 0}})},loading:u,enterButton:!u&&h?(0,b.jsx)(H.Ay,{icon:(0,b.jsx)(Y.A,{})}):void 0})})}),(0,b.jsx)(p.A.Item,{name:["owner","accesskey"],label:n("session.launcher.OwnerAccessKey"),rules:[{required:s(["owner","enabled"])}],children:(0,b.jsx)(B,{options:y().map(m,(e=>({label:null===e||void 0===e?void 0:e.access_key,value:null===e||void 0===e?void 0:e.access_key}))),autoSelectOption:!0,disabled:y().isEmpty(o)||u})}),(0,b.jsxs)(Q.A,{gutter:r.marginSM,children:[(0,b.jsx)(J.A,{span:12,children:(0,b.jsx)(p.A.Item,{name:["owner","project"],label:n("session.launcher.OwnerGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,b.jsx)(B,{options:y().map(null===h||void 0===h?void 0:h.groups,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name}))),autoSelectOption:!0,disabled:y().isEmpty(o)||u})})}),(0,b.jsx)(J.A,{span:12,children:(0,b.jsx)(p.A.Item,{dependencies:[["owner","project"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,b.jsx)(A.Suspense,{fallback:(0,b.jsx)(p.A.Item,{label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,b.jsx)(g.A,{loading:!0})}),children:(0,b.jsx)(p.A.Item,{name:["owner","resourceGroup"],label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:s(["owner","project"])?(0,b.jsx)(G,{projectName:s(["owner","project"]),disabled:y().isEmpty(o)||u,autoSelectDefault:!0}):(0,b.jsx)(g.A,{disabled:!0})})})}})})]})]})}})]})};var se=s(60266);const re=()=>{const[e,n]=(0,N.q)("recentSessionHistory"),s=(0,se.E)((s=>{let{id:r,params:t,createdAt:l}=s;const o=[{id:null!==r&&void 0!==r?r:(0,R.kX)(8),params:t,createdAt:null!==l&&void 0!==l?l:(new Date).toISOString()},...e||[]].slice(0,5);n(o)})),r=(0,se.E)((()=>n([]))),t=(0,se.E)((s=>{const r=(e||[]).filter((e=>e.id!==s));n(r)}));return[e,{push:s,clear:r,remove:t}]};var te=s(94126),le=s(96799),oe=s(77731),ie=s(85690),ae=s(12731),de=s.n(ae);const ce=e=>{let{...n}=e;const{t:s}=(0,j.Bd)(),[r]=re(),[,{getImageAliasName:t,getBaseVersion:l}]=(0,h.Gj)(),[o,i]=(0,A.useState)(),d=(0,A.useMemo)((()=>y().map(r,(e=>{const n=new URLSearchParams(e.params),s=JSON.parse(n.get("formValues")||"{}");return{...e,...s}}))),[r]);return(0,b.jsxs)(te.A,{width:800,title:s("session.launcher.RecentHistory"),okButtonProps:{disabled:!o},okText:s("button.Apply"),...n,onOk:e=>{var s,t;const l=null===(s=y().find(r,{id:o}))||void 0===s?void 0:s.params;null===(t=n.onRequestClose)||void 0===t||t.call(n,JSON.parse(new URLSearchParams(l).get("formValues")||"{}"))},onCancel:()=>{i(void 0),n.onRequestClose()},children:[(0,b.jsx)(le.A,{style:{margin:0}}),(0,b.jsx)(oe.A,{showHeader:!1,scroll:{x:"max-content"},dataSource:d,pagination:!1,rowSelection:{type:"radio",selectedRowKeys:o?[o]:[],onSelect:e=>{i(e.id)}},onRow:e=>({onClick:()=>{i(e.id)}}),rowKey:e=>e.id,columns:[{title:s("general.Image"),dataIndex:["environments","version"],render:(e,n)=>{const s=n.environments.version||n.environments.manual;return!!s&&(0,b.jsxs)(a.A,{gap:"xs",children:[(0,b.jsx)(c.A,{image:s}),(0,b.jsx)(ie.A.Text,{children:t(s)}),(0,b.jsx)(ie.A.Text,{children:l(s)}),(0,b.jsx)(ie.A.Text,{children:n.sessionName?`(${n.sessionName})`:null})]})}},{title:s("session.launcher.ResourceAllocation"),dataIndex:"resource",render:e=>(0,b.jsx)(a.A,{children:(0,b.jsx)(ze,{resource:e})})},{title:s("session.launcher.CreatedAt"),dataIndex:"createdAt",render:e=>de()(e).fromNow()}]})]})};var ue=s(30566),me=s(71786),he=s(3643),pe=s(15634),ge=s(84553);var ve=s(61810),xe=s(65666),ye=s(85681),Ae=s(33772),je=s(96530),be=s(44582),we=s(55731),fe=s(13460),Fe=s(44733),Se=s(42042),ke=s(2293),Te=s(9833),Ee=s(86917),Ie=s(39464),Ve=s(51548),Ne=s(33789),Ce=s(10939),Pe=s(27658),_e=s(40766),Oe=s(18150),De=s(80427),Me=s(82020),Be=s(12121);const ze=e=>{let{resource:n,containerCount:s=1}=e;return(0,b.jsxs)(b.Fragment,{children:[y().map(y().omit(n,"shmem","accelerator","acceleratorType"),((e,r)=>{var t,l;return(0,b.jsx)(V.A,{type:r,value:"mem"===r?((null===(t=(0,R.Js)(e.toString(),"b"))||void 0===t?void 0:t.number)||0)*s+"":y().toNumber(e)*s+"",opts:{shmem:n.shmem?((null===(l=(0,R.Js)(n.shmem,"b"))||void 0===l?void 0:l.number)||0)*s:void 0}},r)})),n&&n.accelerator&&n.acceleratorType&&y().isNumber(n.accelerator)?(0,b.jsx)(V.A,{type:n.acceleratorType,value:y().toString(n.accelerator*s)}):null]})},Re=()=>{let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<8;s++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},Le=()=>{var e,n,s,x,w,f,S,k,V,N,C,M,B,z,L,q,G;const K=Fe.A.useApp();let Y="normal";const Z=(0,Pe.md)(m.i7),se=(0,h.CX)(),te=(0,D.Am)(),[le,ae]=(0,A.useState)(!1),Le=(0,A.useMemo)((()=>{var e,n;return{sessionType:"interactive",allocationPreset:"auto-preset",hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"},batch:{enabled:!1,command:void 0,scheduleDate:void 0},envvars:[],...(null===(e=se._config)||void 0===e?void 0:e.default_session_environment)&&{environments:{environment:null===(n=se._config)||void 0===n?void 0:n.default_session_environment}},...I.jh}}),[null===(e=se._config)||void 0===e?void 0:e.default_session_environment]),qe=(0,Be.withDefault)(Be.NumberParam,0),Ge=(0,Be.withDefault)(Be.JsonParam,Le),Ke=(0,Be.withDefault)(Be.JsonParam,{}),[{step:Ue,formValues:We,redirectTo:$e,appOption:He},Qe]=(0,Be.useQueryParams)({step:qe,formValues:Ge,redirectTo:Be.StringParam,appOption:Ke}),{search:Je}=(0,Oe.zy)(),{isDarkMode:Xe}=(0,ge.e)(),Ye=(0,h.f0)(),Ze=(0,pe.hd)(),[en,{toggle:nn}]=(0,we.A)(),{upsertNotification:sn}=(0,he.js)(),[,{push:rn}]=re(),{run:tn}=(0,fe.A)((()=>{const e=cn.getFieldsValue();Qe({formValues:y().extend(y().omit(cn.getFieldsValue(),["environments.image"],["environments.customizedTag"],["autoMountedFolderNames"],["owner"],["envvars"]),{envvars:(0,i.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),ln=e=>{Qe({step:e},"pushIn")},{token:on}=U.A.useToken(),{t:an}=(0,j.Bd)(),dn=Se.Ay.useBreakpoint(),[cn]=p.A.useForm();(0,A.useEffect)((()=>{y().isEmpty(We)||cn.validateFields().catch((e=>{}))}),[]);const un=(0,A.useMemo)((()=>y().merge({},Le,We)),[Le,We]);(0,A.useEffect)((()=>{var e;null===(e=Z.current)||void 0===e||e.scrollTo(0,0)}),[Ue]);const mn=p.A.useWatch("sessionType",{form:cn,preserve:!0})||cn.getFieldValue("sessionType")||We.sessionType,hn=y().filter([{title:an("session.launcher.SessionType"),key:"sessionType"},{title:`${an("session.launcher.Environments")} & ${an("session.launcher.ResourceAllocation")} `,key:"environment"},"inference"!==mn&&{title:an("webui.menu.Data&Storage"),key:"storage"},{title:an("session.launcher.Network"),key:"network"},{title:an("session.launcher.ConfirmAndLaunch"),icon:(0,b.jsx)(ve.A,{}),key:"review"}],(e=>!!e)),pn=null===(n=hn[Ue])||void 0===n?void 0:n.key,gn=y().some(cn.getFieldsError(),(e=>e.errors.length>0)),[vn,xn]=(0,h.Tw)("first");(0,A.useEffect)((()=>{Ue===hn.length-1&&cn.validateFields().catch((e=>{})).finally((()=>xn()))}),[Ue,cn,xn,hn.length]),(0,A.useEffect)((()=>{"first"!==vn&&An(!!gn)}),[vn,gn]);const[yn,An]=(0,A.useState)(!1);return(0,b.jsxs)(a.A,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,b.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,b.jsxs)(a.A,{direction:"row",gap:"md",align:"start",children:[(0,b.jsxs)(a.A,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,b.jsxs)(a.A,{direction:"row",justify:"between",children:[(0,b.jsx)(ie.A.Title,{level:4,style:{marginTop:0},children:an("session.launcher.StartNewSession")}),(0,b.jsx)(a.A,{direction:"row",gap:"sm",children:(0,b.jsx)(H.Ay,{type:"link",style:{paddingRight:0,paddingLeft:0},onClick:()=>nn(),children:an("session.launcher.RecentHistory")})})]}),(0,b.jsx)(p.A.Provider,{onFormChange:(e,n)=>{tn()},children:(0,b.jsx)(p.A,{form:cn,layout:"vertical",requiredMark:"optional",initialValues:un,children:(0,b.jsxs)(a.A,{direction:"column",align:"stretch",gap:"md",children:[(0,b.jsxs)(W.A,{title:an("session.launcher.SessionType"),style:{display:"sessionType"===pn?"block":"none"},children:[(0,b.jsx)(p.A.Item,{name:"sessionType",children:(0,b.jsx)(ke.Ay.Group,{options:[{label:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ie.A.Text,{code:!0,children:an("session.launcher.InteractiveMode")})," ",(0,b.jsx)(ie.A.Text,{type:"secondary",children:an("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ie.A.Text,{code:!0,children:an("session.launcher.BatchMode")})," ",(0,b.jsx)(ie.A.Text,{type:"secondary",children:an("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,b.jsx)(O,{}),(0,b.jsx)(p.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,b.jsx)(_.A,{})})]}),"batch"===mn&&(0,b.jsxs)(W.A,{title:an("session.launcher.BatchModeConfig"),style:{display:"sessionType"===pn?"block":"none"},children:[(0,b.jsx)(p.A.Item,{label:an("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,b.jsx)(_.A.TextArea,{autoSize:!0})}),(0,b.jsx)(p.A.Item,{label:an("session.launcher.SessionStartTime"),extra:(0,b.jsx)(p.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.batch.scheduleDate!==n.batch.scheduleDate,children:()=>{const e=cn.getFieldValue(["batch","scheduleDate"]);return(0,b.jsx)(t.A,{delay:1e3,callback:()=>{const e=cn.getFieldValue(["batch","scheduleDate"]);return e?de()(e).isBefore(de()())?void(0===cn.getFieldError(["batch","scheduleDate"]).length&&cn.validateFields([["batch","scheduleDate"]])):de()(e).fromNow():void 0},triggerKey:e||"none"})}}),children:(0,b.jsxs)(a.A,{direction:"row",gap:"xs",children:[(0,b.jsx)(p.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,b.jsx)(Te.A,{onChange:e=>{e.target.checked&&y().isEmpty(cn.getFieldValue(["batch","scheduleDate"]))?cn.setFieldValue(["batch","scheduleDate"],de()().add(2,"minutes").toISOString()):!1===e.target.checked&&cn.setFieldValue(["batch","scheduleDate"],void 0),cn.validateFields([["batch","scheduleDate"]])},children:an("session.launcher.Enable")})}),(0,b.jsx)(p.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,r;return(null===(s=e.batch)||void 0===s?void 0:s.enabled)!==(null===(r=n.batch)||void 0===r?void 0:r.enabled)},children:()=>{var e;const n=!0!==(null===(e=cn.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(p.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,n)=>n&&de()(n).isBefore(de()())?Promise.reject(an("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,b.jsx)(l.A,{disabled:n,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(de()().startOf("day"))})})})}})]})})]}),("admin"===te||"superadmin"===te)&&(0,b.jsx)(ne,{style:{display:"sessionType"===pn?"block":"none"}}),"inference"===mn&&(0,b.jsx)(W.A,{title:"Inference Mode Configuration",children:(0,b.jsx)(p.A.Item,{name:["inference","vFolderName"],label:an("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,b.jsx)(g.A,{})})}),(0,b.jsxs)(W.A,{title:an("session.launcher.Environments"),style:{display:"environment"===pn?"block":"none"},children:[(0,b.jsx)(_e.tH,{fallbackRender:e=>(console.log(e),null),children:(0,b.jsx)(d.A,{})}),(0,b.jsx)(p.A.Item,{label:an("session.launcher.EnvironmentVariable"),children:(0,b.jsx)(i.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,b.jsx)(W.A,{title:an("session.launcher.ResourceAllocation"),style:{display:"environment"===pn?"block":"none"},children:(0,b.jsx)(I.Ay,{enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,b.jsxs)(W.A,{title:an("session.launcher.HPCOptimization"),style:{display:"environment"===pn?"block":"none"},children:[(0,b.jsx)(p.A.Item,{noStyle:!0,children:(0,b.jsxs)(a.A,{direction:"row",gap:"sm",children:[(0,b.jsx)(ie.A.Text,{children:an("session.launcher.SwitchOpenMPoptimization")}),(0,b.jsx)(p.A.Item,{label:an("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,b.jsx)($.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e&&cn.setFieldsValue(y().pick(Le,["hpcOptimization"]))}})})]})}),(0,b.jsx)(p.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,r;return(null===(s=e.hpcOptimization)||void 0===s?void 0:s.autoEnabled)!==(null===(r=n.hpcOptimization)||void 0===r?void 0:r.autoEnabled)},children:()=>{const e=cn.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,b.jsxs)(Q.A,{gutter:on.marginMD,style:{display:e?"none":void 0,marginTop:on.marginMD},children:[(0,b.jsx)(J.A,{xs:24,sm:12,children:(0,b.jsx)(p.A.Item,{style:{flex:1},label:an("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,b.jsxs)(b.Fragment,{children:[an("session.launcher.OpenMPOptimization"),(0,b.jsx)(j.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,b.jsx)(Ee.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,b.jsx)(J.A,{xs:24,sm:12,children:(0,b.jsx)(p.A.Item,{style:{flex:1},label:an("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,b.jsxs)(b.Fragment,{children:[an("session.launcher.OpenMPOptimization"),(0,b.jsx)(j.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,b.jsx)(Ee.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,b.jsx)(W.A,{title:an("webui.menu.Data&Storage"),style:{display:"storage"===pn?"block":"none"},children:(0,b.jsx)(me.A,{filter:e=>{var n;return"ready"===e.status&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))}})}),(0,b.jsx)(W.A,{title:an("session.launcher.Network"),style:{display:"network"===pn?"block":"none"},children:(0,b.jsx)(E,{})}),"review"===pn&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(r.A,{title:an("session.launcher.SessionType"),size:"small",status:cn.getFieldError("sessionName").length>0||cn.getFieldError(["batch","command"]).length>0||cn.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:an("button.Edit"),onClickExtraButton:()=>{ln(hn.findIndex((e=>"sessionType"===e.key)))},children:(0,b.jsxs)(X.A,{size:"small",column:1,children:[(0,b.jsx)(X.A.Item,{label:an("session.SessionType"),children:cn.getFieldValue("sessionType")}),!y().isEmpty(cn.getFieldValue("sessionName"))&&(0,b.jsx)(X.A.Item,{label:an("session.launcher.SessionName"),children:cn.getFieldValue("sessionName")}),"batch"===mn&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(X.A.Item,{label:an("session.launcher.StartUpCommand"),labelStyle:{whiteSpace:"nowrap"},contentStyle:{overflow:"auto"},children:cn.getFieldValue(["batch","command"])?(0,b.jsx)(ue.A,{language:"shell",children:cn.getFieldValue(["batch","command"])}):(0,b.jsx)(ie.A.Text,{type:"secondary",children:an("general.None")})}),(0,b.jsx)(X.A.Item,{label:an("session.launcher.ScheduleTimeSimple"),children:cn.getFieldValue(["batch","scheduleDate"])?de()(cn.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,b.jsx)(ie.A.Text,{type:"secondary",children:an("general.None")})})]})]})}),(0,b.jsx)(ee,{onClickExtraButton:()=>{ln(hn.findIndex((e=>"sessionType"===e.key)))}}),(0,b.jsx)(r.A,{title:an("session.launcher.Environments"),size:"small",status:y().some(cn.getFieldValue("envvars"),((e,n)=>cn.getFieldError(["envvars",n,"variable"]).length>0||cn.getFieldError(["envvars",n,"value"]).length>0))?"error":void 0,extraButtonTitle:an("button.Edit"),onClickExtraButton:()=>{ln(hn.findIndex((e=>"environment"===e.key)))},children:(0,b.jsxs)(X.A,{size:"small",column:1,children:[(0,b.jsx)(X.A.Item,{label:an("session.launcher.Project"),children:Ze.name}),(0,b.jsx)(X.A.Item,{label:an("general.Image"),children:(0,b.jsxs)(Q.A,{style:{flexFlow:"nowrap",gap:on.sizeXS},children:[(0,b.jsx)(J.A,{children:(0,b.jsx)(c.A,{image:(null===(s=cn.getFieldValue("environments"))||void 0===s?void 0:s.version)||(null===(x=cn.getFieldValue("environments"))||void 0===x?void 0:x.manual)})}),(0,b.jsx)(J.A,{children:(0,b.jsx)(a.A,{direction:"row",children:null!==(w=cn.getFieldValue("environments"))&&void 0!==w&&w.manual?(0,b.jsx)(ie.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(f=cn.getFieldValue("environments"))||void 0===f?void 0:f.manual},children:null===(S=cn.getFieldValue("environments"))||void 0===S?void 0:S.manual}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.Ay,{image:null===(k=cn.getFieldValue("environments"))||void 0===k?void 0:k.version}),null!==(V=cn.getFieldValue("environments"))&&void 0!==V&&V.customizedTag?(0,b.jsx)(o.A,{values:[{label:"Customized",color:"cyan"},{label:null===(N=cn.getFieldValue("environments"))||void 0===N?void 0:N.customizedTag,color:"cyan"}]}):null,(0,b.jsx)(ie.A.Text,{copyable:{text:null===(C=cn.getFieldValue("environments"))||void 0===C?void 0:C.version}})]})})})]})}),(null===(M=cn.getFieldValue("envvars"))||void 0===M?void 0:M.length)>0&&(0,b.jsx)(X.A.Item,{label:an("session.launcher.EnvironmentVariable"),children:null!==(B=cn.getFieldValue("envvars"))&&void 0!==B&&B.length?(0,b.jsx)(De.A,{style:Xe?Me.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:y().map(cn.getFieldValue("envvars"),(e=>`${(null===e||void 0===e?void 0:e.variable)||""}="${(null===e||void 0===e?void 0:e.value)||""}"`)).join("\n")}):(0,b.jsx)(ie.A.Text,{type:"secondary",children:"-"})})]})}),(0,b.jsx)(r.A,{title:an("session.launcher.ResourceAllocation"),status:y().some(cn.getFieldValue("resource"),((e,n)=>cn.getFieldError(["resource",n]).length>0))||cn.getFieldError(["num_of_sessions"]).length>0||cn.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:an("button.Edit"),onClickExtraButton:()=>{ln(hn.findIndex((e=>"environment"===e.key)))},children:(0,b.jsxs)(a.A,{direction:"column",align:"stretch",children:[y().some(null===(z=cn.getFieldValue("resource"))||void 0===z?void 0:z.resource,((e,n)=>cn.getFieldWarning(["resource",n]).length>0))&&(0,b.jsx)(Ie.A,{type:"warning",showIcon:!0,message:an("session.launcher.EnqueueComputeSessionWarning")}),(0,b.jsxs)(X.A,{column:2,children:[(0,b.jsx)(X.A.Item,{label:an("general.ResourceGroup"),span:2,children:cn.getFieldValue("resourceGroup")||(0,b.jsx)(ie.A.Text,{type:"secondary",children:an("general.None")})}),(0,b.jsx)(X.A.Item,{label:an("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,b.jsxs)(a.A,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===cn.getFieldValue("allocationPreset")?"":(0,b.jsx)(v.A,{children:cn.getFieldValue("allocationPreset")}),(0,b.jsx)(ze,{resource:cn.getFieldValue("resource")})]})}),(0,b.jsx)(X.A.Item,{label:an("session.launcher.NumberOfContainer"),children:1===cn.getFieldValue("cluster_size")?cn.getFieldValue("num_of_sessions"):cn.getFieldValue("cluster_size")}),(0,b.jsx)(X.A.Item,{label:an("session.launcher.ClusterMode"),children:"single-node"===cn.getFieldValue("cluster_mode")?an("session.launcher.SingleNode"):an("session.launcher.MultiNode")})]}),(0,b.jsx)(W.A,{size:"small",type:"inner",title:an("session.launcher.TotalAllocation"),children:(0,b.jsx)(a.A,{direction:"row",gap:"xxs",children:(0,b.jsx)(ze,{resource:cn.getFieldValue("resource"),containerCount:1===cn.getFieldValue("cluster_size")?cn.getFieldValue("num_of_sessions"):cn.getFieldValue("cluster_size")})})})]})}),(0,b.jsx)(r.A,{title:an("webui.menu.Data&Storage"),size:"small",status:cn.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:an("button.Edit"),onClickExtraButton:()=>{ln(hn.findIndex((e=>"storage"===e.key)))},children:(0,b.jsxs)(a.A,{direction:"column",align:"stretch",gap:"xs",children:[(null===(L=cn.getFieldValue("mounts"))||void 0===L?void 0:L.length)>0?(0,b.jsx)(oe.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:an("data.folders.Name")},{dataIndex:"alias",title:an("session.launcher.FolderAlias"),render:(e,n)=>y().isEmpty(e)?(0,b.jsx)(ie.A.Text,{type:"secondary",style:{opacity:.7},children:`/home/work/${n.name}`}):e}],dataSource:y().map(cn.getFieldValue("mounts"),(e=>{var n;return{name:e,alias:null===(n=cn.getFieldValue("vfoldersAliasMap"))||void 0===n?void 0:n[e]}}))}):(0,b.jsx)(Ie.A,{type:"warning",showIcon:!0,message:an("session.launcher.NoFolderMounted")}),(null===(q=cn.getFieldValue("autoMountedFolderNames"))||void 0===q?void 0:q.length)>0?(0,b.jsx)(X.A,{size:"small",children:(0,b.jsx)(X.A.Item,{label:an("data.AutomountFolders"),children:y().map(cn.getFieldValue("autoMountedFolderNames"),(e=>(0,b.jsx)(v.A,{children:e})))})}):null]})}),(0,b.jsx)(r.A,{title:"Network",size:"small",status:cn.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:an("button.Edit"),onClickExtraButton:()=>{ln(hn.findIndex((e=>"network"===e.key)))},children:(0,b.jsx)(X.A,{size:"small",children:(0,b.jsx)(X.A.Item,{label:an("session.launcher.PreOpenPortTitle"),children:(0,b.jsxs)(a.A,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[y().sortBy(cn.getFieldValue("ports"),(e=>parseInt(e))).map((e=>(0,b.jsx)(F,{value:e,style:{margin:0},children:e}))),y().isArray(cn.getFieldValue("ports"))&&0!==(null===(G=cn.getFieldValue("ports"))||void 0===G?void 0:G.length)?null:(0,b.jsx)(ie.A.Text,{type:"secondary",children:an("general.None")})]})})})})]}),(0,b.jsxs)(a.A,{direction:"row",justify:"between",children:[(0,b.jsx)(a.A,{gap:"sm",children:(0,b.jsx)(Ve.A,{title:an("button.Reset"),description:an("session.launcher.ResetFormConfirm"),onConfirm:()=>{Ye("/session/start"),cn.resetFields()},icon:(0,b.jsx)(xe.A,{style:{color:on.colorError}}),okText:an("button.Reset"),okButtonProps:{danger:!0},children:(0,b.jsx)(H.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:an("button.Reset")})})}),(0,b.jsxs)(a.A,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[Ue>0&&(0,b.jsx)(H.Ay,{onClick:()=>{ln(Ue-1)},icon:(0,b.jsx)(ye.A,{}),disabled:le,children:an("button.Previous")}),Ue===hn.length-1?(0,b.jsx)(Ne.A,{title:gn?an("session.launcher.PleaseCompleteForm"):void 0,children:(0,b.jsx)(H.Ay,{type:"primary",icon:(0,b.jsx)(Ae.A,{}),disabled:gn,onClick:()=>{ae(!0);const e=Je;cn.validateFields().then((async n=>{var s;if(y().isEmpty(n.mounts)||0===n.mounts.length){if(!await new Promise((e=>{K.modal.confirm({title:an("session.launcher.NoFolderMounted"),content:(0,b.jsxs)(b.Fragment,{children:[an("session.launcher.HomeDirectoryDeletionDialog"),(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),an("session.launcher.LaunchConfirmationDialog"),(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),an("dialog.ask.DoYouWantToProceed")]}),onOk:()=>{e(!0)},okText:an("session.launcher.Start"),onCancel:()=>{e(!1)},closable:!0})})))return}const r=n.environments.manual||n.environments.version;let[t,l]=r?r.split("@"):["",""];const o=y().isEmpty(n.sessionName)?Re():n.sessionName,i={kernelName:t,architecture:l,sessionName:o,config:{type:n.sessionType,...y().isEmpty(n.bootstrap_script)?{}:{bootstrap_script:n.bootstrap_script},..."batch"===n.sessionType?{startsAt:n.batch.enabled?n.batch.scheduleDate:void 0,startupCommand:n.batch.command}:{},...null!==(s=n.owner)&&void 0!==s&&s.enabled?{group_name:n.owner.project,domain:n.owner.domainName,scaling_group:n.owner.project,owner_access_key:n.owner.accesskey}:{group_name:Ze.name,domain:se._config.domainName,scaling_group:n.resourceGroup},cluster_mode:n.cluster_mode,cluster_size:n.cluster_size,maxWaitSeconds:15,cpu:n.resource.cpu,mem:n.resource.mem,shmem:(0,R.Mh)(n.resource.mem,"4g")>0&&(0,R.Mh)(n.resource.shmem,"1g")<0?"1g":n.resource.shmem,...n.resource.accelerator>0?{[n.resource.acceleratorType]:n.resource.accelerator}:void 0,mounts:n.mounts,mount_map:n.vfoldersAliasMap,env:{...y().fromPairs(n.envvars.map((e=>[e.variable,e.value]))),...y().omit(n.hpcOptimization,"autoEnabled")},preopen_ports:T(n.ports)}},a=y().map(y().range(n.num_of_sessions||1),(e=>{const s=(n.num_of_sessions||1)>1?`${i.sessionName}-${(0,R.kX)()}-${e}`:i.sessionName;return se.createIfNotExists(i.kernelName,s,i.config,2e4,i.architecture).then((e=>{if(null===e||void 0===e||!e.created)throw new Error(an("session.launcher.SessionAlreadyExists"));if("CANCELLED"===(null===e||void 0===e?void 0:e.status))throw new Error(an("session.launcher.FailedToStartNewSession"));return e})).catch((e=>{var n;throw null!==e&&void 0!==e&&null!==(n=e.message)&&void 0!==n&&n.includes("The session already exists")?new Error(an("session.launcher.SessionAlreadyExists")):e}))})),d=window.location.pathname+window.location.search;Ye($e||"/job"),sn({key:"session-launcher:"+o,backgroundTask:{promise:Promise.all(a),status:"pending",statusDescriptions:{pending:an("session.PreparingSession"),resolved:an("eduapi.ComputeSessionPrepared")}},duration:0,message:an("general.Session")+": "+o,open:!0}),await Promise.all(a).then((s=>{let[r]=s;if(rn({id:r.sessionId,params:e,name:r.sessionName}),1===n.num_of_sessions&&"batch"!==n.sessionType){const e=r;let n=y().cloneDeep(He);n="kernelId"in e?y().extend(n,{"session-name":e.kernelId,"access-key":"",mode:Y}):y().extend(n,{"session-uuid":e.sessionId,"session-name":e.sessionName,"access-key":"",mode:Y});const s=e.servicePorts;!0===Array.isArray(s)?n["app-services"]=s.map((e=>e.name)):n["app-services"]=[],s.length>0&&globalThis.appLauncher.showLauncher(n)}})).catch((()=>{sn({key:"session-launcher:"+o,to:d,toText:"\uc218\uc815"})}))})).catch((e=>{console.log("validation errors",e)})).finally((()=>{ae(!1)}))},loading:le,children:an("session.launcher.Launch")})}):(0,b.jsxs)(H.Ay,{type:"primary",ghost:!0,onClick:()=>{ln(Ue+1)},children:[an("button.Next")," ",(0,b.jsx)(je.A,{})]}),Ue!==hn.length-1&&(0,b.jsxs)(H.Ay,{onClick:()=>{ln(hn.length-1)},children:[an("session.launcher.SkipToConfirmAndLaunch"),(0,b.jsx)(be.A,{})]})]})]})]})})})]}),dn.lg&&(0,b.jsx)(a.A,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,b.jsx)(Ce.A,{size:"small",direction:"vertical",current:Ue,onChange:e=>{ln(e)},items:y().map(hn,((e,n)=>({...e,status:n===Ue?"process":"wait"})))})})]}),(0,b.jsx)(ce,{onRequestClose:e=>{if(e){const n=y().merge({sessionName:"",ports:[],mounts:[],vfoldersAliasMap:{},bootstrap_script:"",num_of_sessions:1,owner:{enabled:!1,accesskey:"",domainName:"",email:void 0,project:"",resourceGroup:""},environments:{manual:""},batch:{enabled:!1,command:void 0,scheduleDate:void 0}},e);y().isEmpty(n.sessionName)||(n.sessionName=n.sessionName+"-"+(0,R.kX)(4)),cn.setFieldsValue(n),ln(hn.length-1),cn.validateFields().catch((()=>{}))}nn()},open:en}),Ue===hn.length-1?(0,b.jsx)(_e.tH,{fallback:null,children:(0,b.jsx)(P,{open:yn,onClose:()=>{An(!1)},scrollIntoViewOptions:!0})}):void 0]})}}}]);
//# sourceMappingURL=532.757f914d.chunk.js.map